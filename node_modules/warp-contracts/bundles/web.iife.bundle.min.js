var warp=(()=>{var Lh=Object.create;var Un=Object.defineProperty;var kh=Object.getOwnPropertyDescriptor;var Rh=Object.getOwnPropertyNames;var Oh=Object.getPrototypeOf,Bh=Object.prototype.hasOwnProperty;var Ph=(n,t,e)=>t in n?Un(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Nh=(n,t)=>()=>(n&&(t=n(n=0)),t);var it=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Uh=(n,t)=>{for(var e in t)Un(n,e,{get:t[e],enumerable:!0})},Xc=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Rh(t))!Bh.call(n,i)&&i!==e&&Un(n,i,{get:()=>t[i],enumerable:!(r=kh(t,i))||r.enumerable});return n};var Gt=(n,t,e)=>(e=n!=null?Lh(Oh(n)):{},Xc(t||!n||!n.__esModule?Un(e,"default",{value:n,enumerable:!0}):e,n)),Wh=n=>Xc(Un({},"__esModule",{value:!0}),n);var $e=(n,t,e)=>(Ph(n,typeof t!="symbol"?t+"":t,e),e);var wa=it(Yi=>{"use strict";_();Yi.byteLength=Mh;Yi.toByteArray=$h;Yi.fromByteArray=Gh;var Le=[],pe=[],Dh=typeof Uint8Array<"u"?Uint8Array:Array,ya="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Ar=0,Zc=ya.length;Ar<Zc;++Ar)Le[Ar]=ya[Ar],pe[ya.charCodeAt(Ar)]=Ar;var Ar,Zc;pe["-".charCodeAt(0)]=62;pe["_".charCodeAt(0)]=63;function tu(n){var t=n.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var e=n.indexOf("=");e===-1&&(e=t);var r=e===t?0:4-e%4;return[e,r]}function Mh(n){var t=tu(n),e=t[0],r=t[1];return(e+r)*3/4-r}function Fh(n,t,e){return(t+e)*3/4-e}function $h(n){var t,e=tu(n),r=e[0],i=e[1],o=new Dh(Fh(n,r,i)),a=0,c=i>0?r-4:r,l;for(l=0;l<c;l+=4)t=pe[n.charCodeAt(l)]<<18|pe[n.charCodeAt(l+1)]<<12|pe[n.charCodeAt(l+2)]<<6|pe[n.charCodeAt(l+3)],o[a++]=t>>16&255,o[a++]=t>>8&255,o[a++]=t&255;return i===2&&(t=pe[n.charCodeAt(l)]<<2|pe[n.charCodeAt(l+1)]>>4,o[a++]=t&255),i===1&&(t=pe[n.charCodeAt(l)]<<10|pe[n.charCodeAt(l+1)]<<4|pe[n.charCodeAt(l+2)]>>2,o[a++]=t>>8&255,o[a++]=t&255),o}function Kh(n){return Le[n>>18&63]+Le[n>>12&63]+Le[n>>6&63]+Le[n&63]}function Vh(n,t,e){for(var r,i=[],o=t;o<e;o+=3)r=(n[o]<<16&16711680)+(n[o+1]<<8&65280)+(n[o+2]&255),i.push(Kh(r));return i.join("")}function Gh(n){for(var t,e=n.length,r=e%3,i=[],o=16383,a=0,c=e-r;a<c;a+=o)i.push(Vh(n,a,a+o>c?c:a+o));return r===1?(t=n[e-1],i.push(Le[t>>2]+Le[t<<4&63]+"==")):r===2&&(t=(n[e-2]<<8)+n[e-1],i.push(Le[t>>10]+Le[t>>4&63]+Le[t<<2&63]+"=")),i.join("")}});var eu=it(va=>{_();va.read=function(n,t,e,r,i){var o,a,c=i*8-r-1,l=(1<<c)-1,h=l>>1,w=-7,v=e?i-1:0,T=e?-1:1,d=n[t+v];for(v+=T,o=d&(1<<-w)-1,d>>=-w,w+=c;w>0;o=o*256+n[t+v],v+=T,w-=8);for(a=o&(1<<-w)-1,o>>=-w,w+=r;w>0;a=a*256+n[t+v],v+=T,w-=8);if(o===0)o=1-h;else{if(o===l)return a?NaN:(d?-1:1)*(1/0);a=a+Math.pow(2,r),o=o-h}return(d?-1:1)*a*Math.pow(2,o-r)};va.write=function(n,t,e,r,i,o){var a,c,l,h=o*8-i-1,w=(1<<h)-1,v=w>>1,T=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,y=r?1:-1,x=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,a=w):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+v>=1?t+=T/l:t+=T*Math.pow(2,1-v),t*l>=2&&(a++,l/=2),a+v>=w?(c=0,a=w):a+v>=1?(c=(t*l-1)*Math.pow(2,i),a=a+v):(c=t*Math.pow(2,v-1)*Math.pow(2,i),a=0));i>=8;n[e+d]=c&255,d+=y,c/=256,i-=8);for(a=a<<i|c,h+=i;h>0;n[e+d]=a&255,d+=y,a/=256,h-=8);n[e+d-y]|=x*128}});var kr=it(un=>{"use strict";_();var ba=wa(),cn=eu(),ru=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;un.Buffer=q;un.SlowBuffer=Yh;un.INSPECT_MAX_BYTES=50;var Ji=2147483647;un.kMaxLength=Ji;q.TYPED_ARRAY_SUPPORT=qh();!q.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function qh(){try{var n=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(n,t),n.foo()===42}catch{return!1}}Object.defineProperty(q.prototype,"parent",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.buffer}});Object.defineProperty(q.prototype,"offset",{enumerable:!0,get:function(){if(q.isBuffer(this))return this.byteOffset}});function Ke(n){if(n>Ji)throw new RangeError('The value "'+n+'" is invalid for option "size"');var t=new Uint8Array(n);return Object.setPrototypeOf(t,q.prototype),t}function q(n,t,e){if(typeof n=="number"){if(typeof t=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Ta(n)}return ou(n,t,e)}q.poolSize=8192;function ou(n,t,e){if(typeof n=="string")return Hh(n,t);if(ArrayBuffer.isView(n))return Qh(n);if(n==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n);if(ke(n,ArrayBuffer)||n&&ke(n.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(ke(n,SharedArrayBuffer)||n&&ke(n.buffer,SharedArrayBuffer)))return Sa(n,t,e);if(typeof n=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var r=n.valueOf&&n.valueOf();if(r!=null&&r!==n)return q.from(r,t,e);var i=zh(n);if(i)return i;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof n[Symbol.toPrimitive]=="function")return q.from(n[Symbol.toPrimitive]("string"),t,e);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof n)}q.from=function(n,t,e){return ou(n,t,e)};Object.setPrototypeOf(q.prototype,Uint8Array.prototype);Object.setPrototypeOf(q,Uint8Array);function au(n){if(typeof n!="number")throw new TypeError('"size" argument must be of type number');if(n<0)throw new RangeError('The value "'+n+'" is invalid for option "size"')}function jh(n,t,e){return au(n),n<=0?Ke(n):t!==void 0?typeof e=="string"?Ke(n).fill(t,e):Ke(n).fill(t):Ke(n)}q.alloc=function(n,t,e){return jh(n,t,e)};function Ta(n){return au(n),Ke(n<0?0:xa(n)|0)}q.allocUnsafe=function(n){return Ta(n)};q.allocUnsafeSlow=function(n){return Ta(n)};function Hh(n,t){if((typeof t!="string"||t==="")&&(t="utf8"),!q.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var e=su(n,t)|0,r=Ke(e),i=r.write(n,t);return i!==e&&(r=r.slice(0,i)),r}function _a(n){for(var t=n.length<0?0:xa(n.length)|0,e=Ke(t),r=0;r<t;r+=1)e[r]=n[r]&255;return e}function Qh(n){if(ke(n,Uint8Array)){var t=new Uint8Array(n);return Sa(t.buffer,t.byteOffset,t.byteLength)}return _a(n)}function Sa(n,t,e){if(t<0||n.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(n.byteLength<t+(e||0))throw new RangeError('"length" is outside of buffer bounds');var r;return t===void 0&&e===void 0?r=new Uint8Array(n):e===void 0?r=new Uint8Array(n,t):r=new Uint8Array(n,t,e),Object.setPrototypeOf(r,q.prototype),r}function zh(n){if(q.isBuffer(n)){var t=xa(n.length)|0,e=Ke(t);return e.length===0||n.copy(e,0,0,t),e}if(n.length!==void 0)return typeof n.length!="number"||Ca(n.length)?Ke(0):_a(n);if(n.type==="Buffer"&&Array.isArray(n.data))return _a(n.data)}function xa(n){if(n>=Ji)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Ji.toString(16)+" bytes");return n|0}function Yh(n){return+n!=n&&(n=0),q.alloc(+n)}q.isBuffer=function(t){return t!=null&&t._isBuffer===!0&&t!==q.prototype};q.compare=function(t,e){if(ke(t,Uint8Array)&&(t=q.from(t,t.offset,t.byteLength)),ke(e,Uint8Array)&&(e=q.from(e,e.offset,e.byteLength)),!q.isBuffer(t)||!q.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,i=e.length,o=0,a=Math.min(r,i);o<a;++o)if(t[o]!==e[o]){r=t[o],i=e[o];break}return r<i?-1:i<r?1:0};q.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};q.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(t.length===0)return q.alloc(0);var r;if(e===void 0)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=q.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var a=t[r];if(ke(a,Uint8Array))o+a.length>i.length?q.from(a).copy(i,o):Uint8Array.prototype.set.call(i,a,o);else if(q.isBuffer(a))a.copy(i,o);else throw new TypeError('"list" argument must be an Array of Buffers');o+=a.length}return i};function su(n,t){if(q.isBuffer(n))return n.length;if(ArrayBuffer.isView(n)||ke(n,ArrayBuffer))return n.byteLength;if(typeof n!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof n);var e=n.length,r=arguments.length>2&&arguments[2]===!0;if(!r&&e===0)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":return Ea(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return e*2;case"hex":return e>>>1;case"base64":return gu(n).length;default:if(i)return r?-1:Ea(n).length;t=(""+t).toLowerCase(),i=!0}}q.byteLength=su;function Jh(n,t,e){var r=!1;if((t===void 0||t<0)&&(t=0),t>this.length||((e===void 0||e>this.length)&&(e=this.length),e<=0)||(e>>>=0,t>>>=0,e<=t))return"";for(n||(n="utf8");;)switch(n){case"hex":return sg(this,t,e);case"utf8":case"utf-8":return uu(this,t,e);case"ascii":return og(this,t,e);case"latin1":case"binary":return ag(this,t,e);case"base64":return ng(this,t,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return cg(this,t,e);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}q.prototype._isBuffer=!0;function Lr(n,t,e){var r=n[t];n[t]=n[e],n[e]=r}q.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)Lr(this,e,e+1);return this};q.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)Lr(this,e,e+3),Lr(this,e+1,e+2);return this};q.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)Lr(this,e,e+7),Lr(this,e+1,e+6),Lr(this,e+2,e+5),Lr(this,e+3,e+4);return this};q.prototype.toString=function(){var t=this.length;return t===0?"":arguments.length===0?uu(this,0,t):Jh.apply(this,arguments)};q.prototype.toLocaleString=q.prototype.toString;q.prototype.equals=function(t){if(!q.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t?!0:q.compare(this,t)===0};q.prototype.inspect=function(){var t="",e=un.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"};ru&&(q.prototype[ru]=q.prototype.inspect);q.prototype.compare=function(t,e,r,i,o){if(ke(t,Uint8Array)&&(t=q.from(t,t.offset,t.byteLength)),!q.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(e===void 0&&(e=0),r===void 0&&(r=t?t.length:0),i===void 0&&(i=0),o===void 0&&(o=this.length),e<0||r>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&e>=r)return 0;if(i>=o)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,i>>>=0,o>>>=0,this===t)return 0;for(var a=o-i,c=r-e,l=Math.min(a,c),h=this.slice(i,o),w=t.slice(e,r),v=0;v<l;++v)if(h[v]!==w[v]){a=h[v],c=w[v];break}return a<c?-1:c<a?1:0};function cu(n,t,e,r,i){if(n.length===0)return-1;if(typeof e=="string"?(r=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,Ca(e)&&(e=i?0:n.length-1),e<0&&(e=n.length+e),e>=n.length){if(i)return-1;e=n.length-1}else if(e<0)if(i)e=0;else return-1;if(typeof t=="string"&&(t=q.from(t,r)),q.isBuffer(t))return t.length===0?-1:nu(n,t,e,r,i);if(typeof t=="number")return t=t&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(n,t,e):Uint8Array.prototype.lastIndexOf.call(n,t,e):nu(n,[t],e,r,i);throw new TypeError("val must be string, number or Buffer")}function nu(n,t,e,r,i){var o=1,a=n.length,c=t.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||t.length<2)return-1;o=2,a/=2,c/=2,e/=2}function l(d,y){return o===1?d[y]:d.readUInt16BE(y*o)}var h;if(i){var w=-1;for(h=e;h<a;h++)if(l(n,h)===l(t,w===-1?0:h-w)){if(w===-1&&(w=h),h-w+1===c)return w*o}else w!==-1&&(h-=h-w),w=-1}else for(e+c>a&&(e=a-c),h=e;h>=0;h--){for(var v=!0,T=0;T<c;T++)if(l(n,h+T)!==l(t,T)){v=!1;break}if(v)return h}return-1}q.prototype.includes=function(t,e,r){return this.indexOf(t,e,r)!==-1};q.prototype.indexOf=function(t,e,r){return cu(this,t,e,r,!0)};q.prototype.lastIndexOf=function(t,e,r){return cu(this,t,e,r,!1)};function Xh(n,t,e,r){e=Number(e)||0;var i=n.length-e;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;r>o/2&&(r=o/2);for(var a=0;a<r;++a){var c=parseInt(t.substr(a*2,2),16);if(Ca(c))return a;n[e+a]=c}return a}function Zh(n,t,e,r){return Xi(Ea(t,n.length-e),n,e,r)}function tg(n,t,e,r){return Xi(fg(t),n,e,r)}function eg(n,t,e,r){return Xi(gu(t),n,e,r)}function rg(n,t,e,r){return Xi(hg(t,n.length-e),n,e,r)}q.prototype.write=function(t,e,r,i){if(e===void 0)i="utf8",r=this.length,e=0;else if(r===void 0&&typeof e=="string")i=e,r=this.length,e=0;else if(isFinite(e))e=e>>>0,isFinite(r)?(r=r>>>0,i===void 0&&(i="utf8")):(i=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o=this.length-e;if((r===void 0||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return Xh(this,t,e,r);case"utf8":case"utf-8":return Zh(this,t,e,r);case"ascii":case"latin1":case"binary":return tg(this,t,e,r);case"base64":return eg(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return rg(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}};q.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ng(n,t,e){return t===0&&e===n.length?ba.fromByteArray(n):ba.fromByteArray(n.slice(t,e))}function uu(n,t,e){e=Math.min(n.length,e);for(var r=[],i=t;i<e;){var o=n[i],a=null,c=o>239?4:o>223?3:o>191?2:1;if(i+c<=e){var l,h,w,v;switch(c){case 1:o<128&&(a=o);break;case 2:l=n[i+1],(l&192)===128&&(v=(o&31)<<6|l&63,v>127&&(a=v));break;case 3:l=n[i+1],h=n[i+2],(l&192)===128&&(h&192)===128&&(v=(o&15)<<12|(l&63)<<6|h&63,v>2047&&(v<55296||v>57343)&&(a=v));break;case 4:l=n[i+1],h=n[i+2],w=n[i+3],(l&192)===128&&(h&192)===128&&(w&192)===128&&(v=(o&15)<<18|(l&63)<<12|(h&63)<<6|w&63,v>65535&&v<1114112&&(a=v))}}a===null?(a=65533,c=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|a&1023),r.push(a),i+=c}return ig(r)}var iu=4096;function ig(n){var t=n.length;if(t<=iu)return String.fromCharCode.apply(String,n);for(var e="",r=0;r<t;)e+=String.fromCharCode.apply(String,n.slice(r,r+=iu));return e}function og(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]&127);return r}function ag(n,t,e){var r="";e=Math.min(n.length,e);for(var i=t;i<e;++i)r+=String.fromCharCode(n[i]);return r}function sg(n,t,e){var r=n.length;(!t||t<0)&&(t=0),(!e||e<0||e>r)&&(e=r);for(var i="",o=t;o<e;++o)i+=gg[n[o]];return i}function cg(n,t,e){for(var r=n.slice(t,e),i="",o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+r[o+1]*256);return i}q.prototype.slice=function(t,e){var r=this.length;t=~~t,e=e===void 0?r:~~e,t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),e<t&&(e=t);var i=this.subarray(t,e);return Object.setPrototypeOf(i,q.prototype),i};function Ft(n,t,e){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+t>e)throw new RangeError("Trying to access beyond buffer length")}q.prototype.readUintLE=q.prototype.readUIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ft(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return i};q.prototype.readUintBE=q.prototype.readUIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ft(t,e,this.length);for(var i=this[t+--e],o=1;e>0&&(o*=256);)i+=this[t+--e]*o;return i};q.prototype.readUint8=q.prototype.readUInt8=function(t,e){return t=t>>>0,e||Ft(t,1,this.length),this[t]};q.prototype.readUint16LE=q.prototype.readUInt16LE=function(t,e){return t=t>>>0,e||Ft(t,2,this.length),this[t]|this[t+1]<<8};q.prototype.readUint16BE=q.prototype.readUInt16BE=function(t,e){return t=t>>>0,e||Ft(t,2,this.length),this[t]<<8|this[t+1]};q.prototype.readUint32LE=q.prototype.readUInt32LE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+this[t+3]*16777216};q.prototype.readUint32BE=q.prototype.readUInt32BE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),this[t]*16777216+(this[t+1]<<16|this[t+2]<<8|this[t+3])};q.prototype.readIntLE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ft(t,e,this.length);for(var i=this[t],o=1,a=0;++a<e&&(o*=256);)i+=this[t+a]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i};q.prototype.readIntBE=function(t,e,r){t=t>>>0,e=e>>>0,r||Ft(t,e,this.length);for(var i=e,o=1,a=this[t+--i];i>0&&(o*=256);)a+=this[t+--i]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*e)),a};q.prototype.readInt8=function(t,e){return t=t>>>0,e||Ft(t,1,this.length),this[t]&128?(255-this[t]+1)*-1:this[t]};q.prototype.readInt16LE=function(t,e){t=t>>>0,e||Ft(t,2,this.length);var r=this[t]|this[t+1]<<8;return r&32768?r|4294901760:r};q.prototype.readInt16BE=function(t,e){t=t>>>0,e||Ft(t,2,this.length);var r=this[t+1]|this[t]<<8;return r&32768?r|4294901760:r};q.prototype.readInt32LE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24};q.prototype.readInt32BE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]};q.prototype.readFloatLE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),cn.read(this,t,!0,23,4)};q.prototype.readFloatBE=function(t,e){return t=t>>>0,e||Ft(t,4,this.length),cn.read(this,t,!1,23,4)};q.prototype.readDoubleLE=function(t,e){return t=t>>>0,e||Ft(t,8,this.length),cn.read(this,t,!0,52,8)};q.prototype.readDoubleBE=function(t,e){return t=t>>>0,e||Ft(t,8,this.length),cn.read(this,t,!1,52,8)};function re(n,t,e,r,i,o){if(!q.isBuffer(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(e+r>n.length)throw new RangeError("Index out of range")}q.prototype.writeUintLE=q.prototype.writeUIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;re(this,t,e,r,o,0)}var a=1,c=0;for(this[e]=t&255;++c<r&&(a*=256);)this[e+c]=t/a&255;return e+r};q.prototype.writeUintBE=q.prototype.writeUIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,r=r>>>0,!i){var o=Math.pow(2,8*r)-1;re(this,t,e,r,o,0)}var a=r-1,c=1;for(this[e+a]=t&255;--a>=0&&(c*=256);)this[e+a]=t/c&255;return e+r};q.prototype.writeUint8=q.prototype.writeUInt8=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,1,255,0),this[e]=t&255,e+1};q.prototype.writeUint16LE=q.prototype.writeUInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,65535,0),this[e]=t&255,this[e+1]=t>>>8,e+2};q.prototype.writeUint16BE=q.prototype.writeUInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=t&255,e+2};q.prototype.writeUint32LE=q.prototype.writeUInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=t&255,e+4};q.prototype.writeUint32BE=q.prototype.writeUInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};q.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);re(this,t,e,r,o-1,-o)}var a=0,c=1,l=0;for(this[e]=t&255;++a<r&&(c*=256);)t<0&&l===0&&this[e+a-1]!==0&&(l=1),this[e+a]=(t/c>>0)-l&255;return e+r};q.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e=e>>>0,!i){var o=Math.pow(2,8*r-1);re(this,t,e,r,o-1,-o)}var a=r-1,c=1,l=0;for(this[e+a]=t&255;--a>=0&&(c*=256);)t<0&&l===0&&this[e+a+1]!==0&&(l=1),this[e+a]=(t/c>>0)-l&255;return e+r};q.prototype.writeInt8=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=t&255,e+1};q.prototype.writeInt16LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,32767,-32768),this[e]=t&255,this[e+1]=t>>>8,e+2};q.prototype.writeInt16BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=t&255,e+2};q.prototype.writeInt32LE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,2147483647,-2147483648),this[e]=t&255,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4};q.prototype.writeInt32BE=function(t,e,r){return t=+t,e=e>>>0,r||re(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=t&255,e+4};function lu(n,t,e,r,i,o){if(e+r>n.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function fu(n,t,e,r,i){return t=+t,e=e>>>0,i||lu(n,t,e,4,34028234663852886e22,-34028234663852886e22),cn.write(n,t,e,r,23,4),e+4}q.prototype.writeFloatLE=function(t,e,r){return fu(this,t,e,!0,r)};q.prototype.writeFloatBE=function(t,e,r){return fu(this,t,e,!1,r)};function hu(n,t,e,r,i){return t=+t,e=e>>>0,i||lu(n,t,e,8,17976931348623157e292,-17976931348623157e292),cn.write(n,t,e,r,52,8),e+8}q.prototype.writeDoubleLE=function(t,e,r){return hu(this,t,e,!0,r)};q.prototype.writeDoubleBE=function(t,e,r){return hu(this,t,e,!1,r)};q.prototype.copy=function(t,e,r,i){if(!q.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),!i&&i!==0&&(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r||t.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var o=i-r;return this===t&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),o};q.prototype.fill=function(t,e,r,i){if(typeof t=="string"){if(typeof e=="string"?(i=e,e=0,r=this.length):typeof r=="string"&&(i=r,r=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!q.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(t.length===1){var o=t.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(t=o)}}else typeof t=="number"?t=t&255:typeof t=="boolean"&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;e=e>>>0,r=r===void 0?this.length:r>>>0,t||(t=0);var a;if(typeof t=="number")for(a=e;a<r;++a)this[a]=t;else{var c=q.isBuffer(t)?t:q.from(t,i),l=c.length;if(l===0)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<r-e;++a)this[a+e]=c[a%l]}return this};var ug=/[^+/0-9A-Za-z-_]/g;function lg(n){if(n=n.split("=")[0],n=n.trim().replace(ug,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function Ea(n,t){t=t||1/0;for(var e,r=n.length,i=null,o=[],a=0;a<r;++a){if(e=n.charCodeAt(a),e>55295&&e<57344){if(!i){if(e>56319){(t-=3)>-1&&o.push(239,191,189);continue}else if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=e;continue}if(e<56320){(t-=3)>-1&&o.push(239,191,189),i=e;continue}e=(i-55296<<10|e-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((t-=1)<0)break;o.push(e)}else if(e<2048){if((t-=2)<0)break;o.push(e>>6|192,e&63|128)}else if(e<65536){if((t-=3)<0)break;o.push(e>>12|224,e>>6&63|128,e&63|128)}else if(e<1114112){if((t-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,e&63|128)}else throw new Error("Invalid code point")}return o}function fg(n){for(var t=[],e=0;e<n.length;++e)t.push(n.charCodeAt(e)&255);return t}function hg(n,t){for(var e,r,i,o=[],a=0;a<n.length&&!((t-=2)<0);++a)e=n.charCodeAt(a),r=e>>8,i=e%256,o.push(i),o.push(r);return o}function gu(n){return ba.toByteArray(lg(n))}function Xi(n,t,e,r){for(var i=0;i<r&&!(i+e>=t.length||i>=n.length);++i)t[i+e]=n[i];return i}function ke(n,t){return n instanceof t||n!=null&&n.constructor!=null&&n.constructor.name!=null&&n.constructor.name===t.name}function Ca(n){return n!==n}var gg=function(){for(var n="0123456789abcdef",t=new Array(256),e=0;e<16;++e)for(var r=e*16,i=0;i<16;++i)t[r+i]=n[e]+n[i];return t}()});var wu=it((Cy,yu)=>{_();var Ot=yu.exports={},Re,Oe;function Ia(){throw new Error("setTimeout has not been defined")}function Aa(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Re=setTimeout:Re=Ia}catch{Re=Ia}try{typeof clearTimeout=="function"?Oe=clearTimeout:Oe=Aa}catch{Oe=Aa}})();function du(n){if(Re===setTimeout)return setTimeout(n,0);if((Re===Ia||!Re)&&setTimeout)return Re=setTimeout,setTimeout(n,0);try{return Re(n,0)}catch{try{return Re.call(null,n,0)}catch{return Re.call(this,n,0)}}}function dg(n){if(Oe===clearTimeout)return clearTimeout(n);if((Oe===Aa||!Oe)&&clearTimeout)return Oe=clearTimeout,clearTimeout(n);try{return Oe(n)}catch{try{return Oe.call(null,n)}catch{return Oe.call(this,n)}}}var Ve=[],ln=!1,Rr,Zi=-1;function pg(){!ln||!Rr||(ln=!1,Rr.length?Ve=Rr.concat(Ve):Zi=-1,Ve.length&&pu())}function pu(){if(!ln){var n=du(pg);ln=!0;for(var t=Ve.length;t;){for(Rr=Ve,Ve=[];++Zi<t;)Rr&&Rr[Zi].run();Zi=-1,t=Ve.length}Rr=null,ln=!1,dg(n)}}Ot.nextTick=function(n){var t=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)t[e-1]=arguments[e];Ve.push(new mu(n,t)),Ve.length===1&&!ln&&du(pu)};function mu(n,t){this.fun=n,this.array=t}mu.prototype.run=function(){this.fun.apply(null,this.array)};Ot.title="browser";Ot.browser=!0;Ot.env={};Ot.argv=[];Ot.version="";Ot.versions={};function Ge(){}Ot.on=Ge;Ot.addListener=Ge;Ot.once=Ge;Ot.off=Ge;Ot.removeListener=Ge;Ot.removeAllListeners=Ge;Ot.emit=Ge;Ot.prependListener=Ge;Ot.prependOnceListener=Ge;Ot.listeners=function(n){return[]};Ot.binding=function(n){throw new Error("process.binding is not supported")};Ot.cwd=function(){return"/"};Ot.chdir=function(n){throw new Error("process.chdir is not supported")};Ot.umask=function(){return 0}});var F,$,mg,K,_=Nh(()=>{F=Gt(kr()),$=Gt(wu()),mg=function(n){function t(){var r=this||self;return delete n.prototype.__magic__,r}if(typeof globalThis=="object")return globalThis;if(this)return t();n.defineProperty(n.prototype,"__magic__",{configurable:!0,get:t});var e=__magic__;return e}(Object),K=mg});var _u=it(bu=>{"use strict";_();bu.supports=function(...t){let e=t.reduce((r,i)=>Object.assign(r,i),{});return Object.assign(e,{snapshots:e.snapshots||!1,permanence:e.permanence||!1,seek:e.seek||!1,clear:e.clear||!1,getMany:e.getMany||!1,keyIterator:e.keyIterator||!1,valueIterator:e.valueIterator||!1,iteratorNextv:e.iteratorNextv||!1,iteratorAll:e.iteratorAll||!1,status:e.status||!1,createIfMissing:e.createIfMissing||!1,errorIfExists:e.errorIfExists||!1,deferredOpen:e.deferredOpen||!1,promises:e.promises||!1,streams:e.streams||!1,encodings:Object.assign({},e.encodings),events:Object.assign({},e.events),additionalMethods:Object.assign({},e.additionalMethods)})}});var me=it((Yy,Su)=>{"use strict";_();Su.exports=class extends Error{constructor(t,e){super(t||""),typeof e=="object"&&e!==null&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}});var ka=it((Xy,Eu)=>{"use strict";_();var La=null;Eu.exports=function(){return La===null&&(La={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),La}});var Ba=it(Tu=>{"use strict";_();var Ra=me(),yg=new Set(["buffer","view","utf8"]),Oa=class{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!yg.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new Ra(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new Ra(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new Ra(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};Tu.Encoding=Oa});var Wa=it(eo=>{"use strict";_();var{Buffer:Na}=kr()||{},{Encoding:Ua}=Ba(),wg=ka(),Mn=class extends Ua{constructor(t){super({...t,format:"buffer"})}createViewTranscoder(){return new Fn({encode:this.encode,decode:t=>this.decode(Na.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},Fn=class extends Ua{constructor(t){super({...t,format:"view"})}createBufferTranscoder(){return new Mn({encode:t=>{let e=this.encode(t);return Na.from(e.buffer,e.byteOffset,e.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},Pa=class extends Ua{constructor(t){super({...t,format:"utf8"})}createBufferTranscoder(){return new Mn({encode:t=>Na.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){let{textEncoder:t,textDecoder:e}=wg();return new Fn({encode:r=>t.encode(this.encode(r)),decode:r=>this.decode(e.decode(r)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};eo.BufferFormat=Mn;eo.ViewFormat=Fn;eo.UTF8Format=Pa});var Au=it(Br=>{"use strict";_();var{Buffer:zt}=kr()||{Buffer:{isBuffer:()=>!1}},{textEncoder:Cu,textDecoder:xu}=ka()(),{BufferFormat:$n,ViewFormat:Da,UTF8Format:Iu}=Wa(),ro=n=>n;Br.utf8=new Iu({encode:function(n){return zt.isBuffer(n)?n.toString("utf8"):ArrayBuffer.isView(n)?xu.decode(n):String(n)},decode:ro,name:"utf8",createViewTranscoder(){return new Da({encode:function(n){return ArrayBuffer.isView(n)?n:Cu.encode(n)},decode:function(n){return xu.decode(n)},name:`${this.name}+view`})},createBufferTranscoder(){return new $n({encode:function(n){return zt.isBuffer(n)?n:ArrayBuffer.isView(n)?zt.from(n.buffer,n.byteOffset,n.byteLength):zt.from(String(n),"utf8")},decode:function(n){return n.toString("utf8")},name:`${this.name}+buffer`})}});Br.json=new Iu({encode:JSON.stringify,decode:JSON.parse,name:"json"});Br.buffer=new $n({encode:function(n){return zt.isBuffer(n)?n:ArrayBuffer.isView(n)?zt.from(n.buffer,n.byteOffset,n.byteLength):zt.from(String(n),"utf8")},decode:ro,name:"buffer",createViewTranscoder(){return new Da({encode:function(n){return ArrayBuffer.isView(n)?n:zt.from(String(n),"utf8")},decode:function(n){return zt.from(n.buffer,n.byteOffset,n.byteLength)},name:`${this.name}+view`})}});Br.view=new Da({encode:function(n){return ArrayBuffer.isView(n)?n:Cu.encode(n)},decode:ro,name:"view",createBufferTranscoder(){return new $n({encode:function(n){return zt.isBuffer(n)?n:ArrayBuffer.isView(n)?zt.from(n.buffer,n.byteOffset,n.byteLength):zt.from(String(n),"utf8")},decode:ro,name:`${this.name}+buffer`})}});Br.hex=new $n({encode:function(n){return zt.isBuffer(n)?n:zt.from(String(n),"hex")},decode:function(n){return n.toString("hex")},name:"hex"});Br.base64=new $n({encode:function(n){return zt.isBuffer(n)?n:zt.from(String(n),"base64")},decode:function(n){return n.toString("base64")},name:"base64"})});var Ru=it(ku=>{"use strict";_();var Lu=me(),io=Au(),{Encoding:vg}=Ba(),{BufferFormat:bg,ViewFormat:_g,UTF8Format:Sg}=Wa(),Kn=Symbol("formats"),no=Symbol("encodings"),Eg=new Set(["buffer","view","utf8"]),Ma=class{constructor(t){if(Array.isArray(t)){if(!t.every(e=>Eg.has(e)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[no]=new Map,this[Kn]=new Set(t);for(let e in io)try{this.encoding(e)}catch(r){if(r.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw r}}encodings(){return Array.from(new Set(this[no].values()))}encoding(t){let e=this[no].get(t);if(e===void 0){if(typeof t=="string"&&t!==""){if(e=Ig[t],!e)throw new Lu(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof t!="object"||t===null)throw new TypeError("First argument 'encoding' must be a string or object");e=Tg(t)}let{name:r,format:i}=e;if(!this[Kn].has(i))if(this[Kn].has("view"))e=e.createViewTranscoder();else if(this[Kn].has("buffer"))e=e.createBufferTranscoder();else if(this[Kn].has("utf8"))e=e.createUTF8Transcoder();else throw new Lu(`Encoding '${r}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(let o of[t,r,e.name,e.commonName])this[no].set(o,e)}return e}};ku.Transcoder=Ma;function Tg(n){if(n instanceof vg)return n;let t="type"in n&&typeof n.type=="string"?n.type:void 0,e=n.name||t||`anonymous-${Ag++}`;switch(xg(n)){case"view":return new _g({...n,name:e});case"utf8":return new Sg({...n,name:e});case"buffer":return new bg({...n,name:e});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function xg(n){return"format"in n&&n.format!==void 0?n.format:"buffer"in n&&typeof n.buffer=="boolean"?n.buffer?"buffer":"utf8":"code"in n&&Number.isInteger(n.code)?"view":"buffer"}var Cg={binary:io.buffer,"utf-8":io.utf8},Ig={...io,...Cg},Ag=0});var Ku=it((cw,Fa)=>{"use strict";_();var fn=typeof Reflect=="object"?Reflect:null,Ou=fn&&typeof fn.apply=="function"?fn.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)},oo;fn&&typeof fn.ownKeys=="function"?oo=fn.ownKeys:Object.getOwnPropertySymbols?oo=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:oo=function(t){return Object.getOwnPropertyNames(t)};function Lg(n){console&&console.warn&&console.warn(n)}var Pu=Number.isNaN||function(t){return t!==t};function xt(){xt.init.call(this)}Fa.exports=xt;Fa.exports.once=Bg;xt.EventEmitter=xt;xt.prototype._events=void 0;xt.prototype._eventsCount=0;xt.prototype._maxListeners=void 0;var Bu=10;function ao(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(xt,"defaultMaxListeners",{enumerable:!0,get:function(){return Bu},set:function(n){if(typeof n!="number"||n<0||Pu(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");Bu=n}});xt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};xt.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Pu(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Nu(n){return n._maxListeners===void 0?xt.defaultMaxListeners:n._maxListeners}xt.prototype.getMaxListeners=function(){return Nu(this)};xt.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i=t==="error",o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var l=o[t];if(l===void 0)return!1;if(typeof l=="function")Ou(l,this,e);else for(var h=l.length,w=Fu(l,h),r=0;r<h;++r)Ou(w[r],this,e);return!0};function Uu(n,t,e,r){var i,o,a;if(ao(e),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),o=n._events),a=o[t]),a===void 0)a=o[t]=e,++n._eventsCount;else if(typeof a=="function"?a=o[t]=r?[e,a]:[a,e]:r?a.unshift(e):a.push(e),i=Nu(n),i>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=n,c.type=t,c.count=a.length,Lg(c)}return n}xt.prototype.addListener=function(t,e){return Uu(this,t,e,!1)};xt.prototype.on=xt.prototype.addListener;xt.prototype.prependListener=function(t,e){return Uu(this,t,e,!0)};function kg(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wu(n,t,e){var r={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},i=kg.bind(r);return i.listener=e,r.wrapFn=i,i}xt.prototype.once=function(t,e){return ao(e),this.on(t,Wu(this,t,e)),this};xt.prototype.prependOnceListener=function(t,e){return ao(e),this.prependListener(t,Wu(this,t,e)),this};xt.prototype.removeListener=function(t,e){var r,i,o,a,c;if(ao(e),i=this._events,i===void 0)return this;if(r=i[t],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if(typeof r!="function"){for(o=-1,a=r.length-1;a>=0;a--)if(r[a]===e||r[a].listener===e){c=r[a].listener,o=a;break}if(o<0)return this;o===0?r.shift():Rg(r,o),r.length===1&&(i[t]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",t,c||e)}return this};xt.prototype.off=xt.prototype.removeListener;xt.prototype.removeAllListeners=function(t){var e,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[t]),this;if(arguments.length===0){var o=Object.keys(r),a;for(i=0;i<o.length;++i)a=o[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this};function Du(n,t,e){var r=n._events;if(r===void 0)return[];var i=r[t];return i===void 0?[]:typeof i=="function"?e?[i.listener||i]:[i]:e?Og(i):Fu(i,i.length)}xt.prototype.listeners=function(t){return Du(this,t,!0)};xt.prototype.rawListeners=function(t){return Du(this,t,!1)};xt.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Mu.call(n,t)};xt.prototype.listenerCount=Mu;function Mu(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}xt.prototype.eventNames=function(){return this._eventsCount>0?oo(this._events):[]};function Fu(n,t){for(var e=new Array(t),r=0;r<t;++r)e[r]=n[r];return e}function Rg(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Og(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function Bg(n,t){return new Promise(function(e,r){function i(a){n.removeListener(t,o),r(a)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",i),e([].slice.call(arguments))}$u(n,t,o,{once:!0}),t!=="error"&&Pg(n,i,{once:!0})})}function Pg(n,t,e){typeof n.on=="function"&&$u(n,"error",t,e)}function $u(n,t,e,r){if(typeof n.on=="function")r.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function i(o){r.once&&n.removeEventListener(t,i),e(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}});var Gu=it((lw,Vu)=>{_();Vu.exports=typeof queueMicrotask=="function"?queueMicrotask:n=>Promise.resolve().then(n)});var Vn=it($a=>{"use strict";_();var qu=Gu();$a.fromCallback=function(n,t){if(n===void 0){var e=new Promise(function(r,i){n=function(o,a){o?i(o):r(a)}});n[t!==void 0?t:"promise"]=e}else if(typeof n!="function")throw new TypeError("Callback must be a function");return n};$a.fromPromise=function(n,t){if(t===void 0)return n;n.then(function(e){qu(()=>t(null,e))}).catch(function(e){qu(()=>t(e))})}});var so=it(Ka=>{"use strict";_();Ka.getCallback=function(n,t){return typeof n=="function"?n:t};Ka.getOptions=function(n,t){return typeof n=="object"&&n!==null?n:t!==void 0?t:{}}});var dr=it(fo=>{"use strict";_();var{fromCallback:Va}=Vn(),ae=me(),{getOptions:Ga,getCallback:ju}=so(),Pr=Symbol("promise"),hn=Symbol("callback"),Be=Symbol("working"),Nr=Symbol("handleOne"),qe=Symbol("handleMany"),qa=Symbol("autoClose"),hr=Symbol("finishWork"),Pe=Symbol("returnMany"),ur=Symbol("closing"),Gn=Symbol("handleClose"),co=Symbol("closed"),qn=Symbol("closeCallbacks"),fr=Symbol("keyEncoding"),Ur=Symbol("valueEncoding"),ja=Symbol("abortOnClose"),uo=Symbol("legacy"),Ha=Symbol("keys"),Qa=Symbol("values"),lr=Symbol("limit"),ye=Symbol("count"),lo=Object.freeze({}),Ng=()=>{},Hu=!1,jn=class{constructor(t,e,r){if(typeof t!="object"||t===null){let i=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${i}`)}if(typeof e!="object"||e===null)throw new TypeError("The second argument must be an options object");this[co]=!1,this[qn]=[],this[Be]=!1,this[ur]=!1,this[qa]=!1,this[hn]=null,this[Nr]=this[Nr].bind(this),this[qe]=this[qe].bind(this),this[Gn]=this[Gn].bind(this),this[fr]=e[fr],this[Ur]=e[Ur],this[uo]=r,this[lr]=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this[ye]=0,this[ja]=!!e.abortOnClose,this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get count(){return this[ye]}get limit(){return this[lr]}next(t){let e;if(t===void 0)e=new Promise((r,i)=>{t=(o,a,c)=>{o?i(o):this[uo]?a===void 0&&c===void 0?r():r([a,c]):r(a)}});else if(typeof t!="function")throw new TypeError("Callback must be a function");return this[ur]?this.nextTick(t,new ae("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Be]?this.nextTick(t,new ae("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Be]=!0,this[hn]=t,this[ye]>=this[lr]?this.nextTick(this[Nr],null):this._next(this[Nr])),e}_next(t){this.nextTick(t)}nextv(t,e,r){return r=ju(e,r),r=Va(r,Pr),e=Ga(e,lo),Number.isInteger(t)?(this[ur]?this.nextTick(r,new ae("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Be]?this.nextTick(r,new ae("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(t<1&&(t=1),this[lr]<1/0&&(t=Math.min(t,this[lr]-this[ye])),this[Be]=!0,this[hn]=r,t<=0?this.nextTick(this[qe],null,[]):this._nextv(t,e,this[qe])),r[Pr]):(this.nextTick(r,new TypeError("The first argument 'size' must be an integer")),r[Pr])}_nextv(t,e,r){let i=[],o=(a,c,l)=>{if(a)return r(a);if(this[uo]?c===void 0&&l===void 0:c===void 0)return r(null,i);i.push(this[uo]?[c,l]:c),i.length===t?r(null,i):this._next(o)};this._next(o)}all(t,e){return e=ju(t,e),e=Va(e,Pr),t=Ga(t,lo),this[ur]?this.nextTick(e,new ae("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[Be]?this.nextTick(e,new ae("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[Be]=!0,this[hn]=e,this[qa]=!0,this[ye]>=this[lr]?this.nextTick(this[qe],null,[]):this._all(t,this[qe])),e[Pr]}_all(t,e){let r=this[ye],i=[],o=()=>{let c=this[lr]<1/0?Math.min(1e3,this[lr]-r):1e3;c<=0?this.nextTick(e,null,i):this._nextv(c,lo,a)},a=(c,l)=>{c?e(c):l.length===0?e(null,i):(i.push.apply(i,l),r+=l.length,o())};o()}[hr](){let t=this[hn];return this[ja]&&t===null?Ng:(this[Be]=!1,this[hn]=null,this[ur]&&this._close(this[Gn]),t)}[Pe](t,e,r){this[qa]?this.close(t.bind(null,e,r)):t(e,r)}seek(t,e){if(e=Ga(e,lo),!this[ur]){if(this[Be])throw new ae("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{let r=this.db.keyEncoding(e.keyEncoding||this[fr]),i=r.format;e.keyEncoding!==i&&(e={...e,keyEncoding:i});let o=this.db.prefixKey(r.encode(t),i);this._seek(o,e)}}}_seek(t,e){throw new ae("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(t){return t=Va(t,Pr),this[co]?this.nextTick(t):this[ur]?this[qn].push(t):(this[ur]=!0,this[qn].push(t),this[Be]?this[ja]&&this[hr]()(new ae("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[Gn])),t[Pr]}_close(t){this.nextTick(t)}[Gn](){this[co]=!0,this.db.detachResource(this);let t=this[qn];this[qn]=[];for(let e of t)e()}async*[Symbol.asyncIterator](){try{let t;for(;(t=await this.next())!==void 0;)yield t}finally{this[co]||await this.close()}}},gn=class extends jn{constructor(t,e){super(t,e,!0),this[Ha]=e.keys!==!1,this[Qa]=e.values!==!1}[Nr](t,e,r){let i=this[hr]();if(t)return i(t);try{e=this[Ha]&&e!==void 0?this[fr].decode(e):void 0,r=this[Qa]&&r!==void 0?this[Ur].decode(r):void 0}catch(o){return i(new gr("entry",o))}e===void 0&&r===void 0||this[ye]++,i(null,e,r)}[qe](t,e){let r=this[hr]();if(t)return this[Pe](r,t);try{for(let i of e){let o=i[0],a=i[1];i[0]=this[Ha]&&o!==void 0?this[fr].decode(o):void 0,i[1]=this[Qa]&&a!==void 0?this[Ur].decode(a):void 0}}catch(i){return this[Pe](r,new gr("entries",i))}this[ye]+=e.length,this[Pe](r,null,e)}end(t){return!Hu&&typeof console<"u"&&(Hu=!0,console.warn(new ae("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(t)}},za=class extends jn{constructor(t,e){super(t,e,!1)}[Nr](t,e){let r=this[hr]();if(t)return r(t);try{e=e!==void 0?this[fr].decode(e):void 0}catch(i){return r(new gr("key",i))}e!==void 0&&this[ye]++,r(null,e)}[qe](t,e){let r=this[hr]();if(t)return this[Pe](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[fr].decode(o):void 0}}catch(i){return this[Pe](r,new gr("keys",i))}this[ye]+=e.length,this[Pe](r,null,e)}},Ya=class extends jn{constructor(t,e){super(t,e,!1)}[Nr](t,e){let r=this[hr]();if(t)return r(t);try{e=e!==void 0?this[Ur].decode(e):void 0}catch(i){return r(new gr("value",i))}e!==void 0&&this[ye]++,r(null,e)}[qe](t,e){let r=this[hr]();if(t)return this[Pe](r,t);try{for(let i=0;i<e.length;i++){let o=e[i];e[i]=o!==void 0?this[Ur].decode(o):void 0}}catch(i){return this[Pe](r,new gr("values",i))}this[ye]+=e.length,this[Pe](r,null,e)}},gr=class extends ae{constructor(t,e){super(`Iterator could not decode ${t}`,{code:"LEVEL_DECODE_ERROR",cause:e})}};for(let n of["_ended property","_nexting property","_end method"])Object.defineProperty(gn.prototype,n.split(" ")[0],{get(){throw new ae(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ae(`The ${n} has been removed`,{code:"LEVEL_LEGACY"})}});gn.keyEncoding=fr;gn.valueEncoding=Ur;fo.AbstractIterator=gn;fo.AbstractKeyIterator=za;fo.AbstractValueIterator=Ya});var Qu=it(Ja=>{"use strict";_();var{AbstractKeyIterator:Ug,AbstractValueIterator:Wg}=dr(),Wr=Symbol("iterator"),Hn=Symbol("callback"),dn=Symbol("handleOne"),Dr=Symbol("handleMany"),Qn=class extends Ug{constructor(t,e){super(t,e),this[Wr]=t.iterator({...e,keys:!0,values:!1}),this[dn]=this[dn].bind(this),this[Dr]=this[Dr].bind(this)}},ho=class extends Wg{constructor(t,e){super(t,e),this[Wr]=t.iterator({...e,keys:!1,values:!0}),this[dn]=this[dn].bind(this),this[Dr]=this[Dr].bind(this)}};for(let n of[Qn,ho]){let t=n===Qn,e=t?r=>r[0]:r=>r[1];n.prototype._next=function(r){this[Hn]=r,this[Wr].next(this[dn])},n.prototype[dn]=function(r,i,o){let a=this[Hn];r?a(r):a(null,t?i:o)},n.prototype._nextv=function(r,i,o){this[Hn]=o,this[Wr].nextv(r,i,this[Dr])},n.prototype._all=function(r,i){this[Hn]=i,this[Wr].all(r,this[Dr])},n.prototype[Dr]=function(r,i){let o=this[Hn];r?o(r):o(null,i.map(e))},n.prototype._seek=function(r,i){this[Wr].seek(r,i)},n.prototype._close=function(r){this[Wr].close(r)}}Ja.DefaultKeyIterator=Qn;Ja.DefaultValueIterator=ho});var zu=it(vo=>{"use strict";_();var{AbstractIterator:Dg,AbstractKeyIterator:Mg,AbstractValueIterator:Fg}=dr(),Xa=me(),ne=Symbol("nut"),yo=Symbol("undefer"),wo=Symbol("factory"),go=class extends Dg{constructor(t,e){super(t,e),this[ne]=null,this[wo]=()=>t.iterator(e),this.db.defer(()=>this[yo]())}},po=class extends Mg{constructor(t,e){super(t,e),this[ne]=null,this[wo]=()=>t.keys(e),this.db.defer(()=>this[yo]())}},mo=class extends Fg{constructor(t,e){super(t,e),this[ne]=null,this[wo]=()=>t.values(e),this.db.defer(()=>this[yo]())}};for(let n of[go,po,mo])n.prototype[yo]=function(){this.db.status==="open"&&(this[ne]=this[wo]())},n.prototype._next=function(t){this[ne]!==null?this[ne].next(t):this.db.status==="opening"?this.db.defer(()=>this._next(t)):this.nextTick(t,new Xa("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._nextv=function(t,e,r){this[ne]!==null?this[ne].nextv(t,e,r):this.db.status==="opening"?this.db.defer(()=>this._nextv(t,e,r)):this.nextTick(r,new Xa("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._all=function(t,e){this[ne]!==null?this[ne].all(e):this.db.status==="opening"?this.db.defer(()=>this._all(t,e)):this.nextTick(e,new Xa("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},n.prototype._seek=function(t,e){this[ne]!==null?this[ne]._seek(t,e):this.db.status==="opening"&&this.db.defer(()=>this._seek(t,e))},n.prototype._close=function(t){this[ne]!==null?this[ne].close(t):this.db.status==="opening"?this.db.defer(()=>this._close(t)):this.nextTick(t)};vo.DeferredIterator=go;vo.DeferredKeyIterator=po;vo.DeferredValueIterator=mo});var ts=it(Ju=>{"use strict";_();var{fromCallback:Yu}=Vn(),bo=me(),{getCallback:$g,getOptions:Kg}=so(),_o=Symbol("promise"),we=Symbol("status"),pn=Symbol("operations"),zn=Symbol("finishClose"),mn=Symbol("closeCallbacks"),Za=class{constructor(t){if(typeof t!="object"||t===null){let e=t===null?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${e}`)}this[pn]=[],this[mn]=[],this[we]="open",this[zn]=this[zn].bind(this),this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get length(){return this[pn].length}put(t,e,r){if(this[we]!=="open")throw new bo("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let i=this.db._checkKey(t)||this.db._checkValue(e);if(i)throw i;let o=r&&r.sublevel!=null?r.sublevel:this.db,a=r,c=o.keyEncoding(r&&r.keyEncoding),l=o.valueEncoding(r&&r.valueEncoding),h=c.format;r={...r,keyEncoding:h,valueEncoding:l.format},o!==this.db&&(r.sublevel=null);let w=o.prefixKey(c.encode(t),h),v=l.encode(e);return this._put(w,v,r),this[pn].push({...a,type:"put",key:t,value:e}),this}_put(t,e,r){}del(t,e){if(this[we]!=="open")throw new bo("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});let r=this.db._checkKey(t);if(r)throw r;let i=e&&e.sublevel!=null?e.sublevel:this.db,o=e,a=i.keyEncoding(e&&e.keyEncoding),c=a.format;return e={...e,keyEncoding:c},i!==this.db&&(e.sublevel=null),this._del(i.prefixKey(a.encode(t),c),e),this[pn].push({...o,type:"del",key:t}),this}_del(t,e){}clear(){if(this[we]!=="open")throw new bo("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[pn]=[],this}_clear(){}write(t,e){return e=$g(t,e),e=Yu(e,_o),t=Kg(t),this[we]!=="open"?this.nextTick(e,new bo("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(e):(this[we]="writing",this._write(t,r=>{this[we]="closing",this[mn].push(()=>e(r)),r||this.db.emit("batch",this[pn]),this._close(this[zn])})),e[_o]}_write(t,e){}close(t){return t=Yu(t,_o),this[we]==="closing"?this[mn].push(t):this[we]==="closed"?this.nextTick(t):(this[mn].push(t),this[we]!=="writing"&&(this[we]="closing",this._close(this[zn]))),t[_o]}_close(t){this.nextTick(t)}[zn](){this[we]="closed",this.db.detachResource(this);let t=this[mn];this[mn]=[];for(let e of t)e()}};Ju.AbstractChainedBatch=Za});var Zu=it(Xu=>{"use strict";_();var{AbstractChainedBatch:Vg}=ts(),Gg=me(),yn=Symbol("encoded"),es=class extends Vg{constructor(t){super(t),this[yn]=[]}_put(t,e,r){this[yn].push({...r,type:"put",key:t,value:e})}_del(t,e){this[yn].push({...e,type:"del",key:t})}_clear(){this[yn]=[]}_write(t,e){this.db.status==="opening"?this.db.defer(()=>this._write(t,e)):this.db.status==="open"?this[yn].length===0?this.nextTick(e):this.db._batch(this[yn],t,e):this.nextTick(e,new Gg("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};Xu.DefaultChainedBatch=es});var rl=it((Cw,el)=>{"use strict";_();var tl=me(),qg=Object.prototype.hasOwnProperty,jg=new Set(["lt","lte","gt","gte"]);el.exports=function(n,t){let e={};for(let r in n)if(qg.call(n,r)&&!(r==="keyEncoding"||r==="valueEncoding")){if(r==="start"||r==="end")throw new tl(`The legacy range option '${r}' has been removed`,{code:"LEVEL_LEGACY"});if(r==="encoding")throw new tl("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});jg.has(r)?e[r]=t.encode(n[r]):e[r]=n[r]}return e.reverse=!!e.reverse,e.limit=Number.isInteger(e.limit)&&e.limit>=0?e.limit:-1,e}});var rs=it((Aw,il)=>{_();var nl;il.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:K):n=>(nl||(nl=Promise.resolve())).then(n).catch(t=>setTimeout(()=>{throw t},0))});var sl=it((kw,al)=>{"use strict";_();var ol=rs();al.exports=function(n,...t){t.length===0?ol(n):ol(()=>n(...t))}});var cl=it(So=>{"use strict";_();var{AbstractIterator:Hg,AbstractKeyIterator:Qg,AbstractValueIterator:zg}=dr(),wn=Symbol("unfix"),Se=Symbol("iterator"),Mr=Symbol("handleOne"),pr=Symbol("handleMany"),je=Symbol("callback"),Yn=class extends Hg{constructor(t,e,r,i){super(t,e),this[Se]=r,this[wn]=i,this[Mr]=this[Mr].bind(this),this[pr]=this[pr].bind(this),this[je]=null}[Mr](t,e,r){let i=this[je];if(t)return i(t);e!==void 0&&(e=this[wn](e)),i(t,e,r)}[pr](t,e){let r=this[je];if(t)return r(t);for(let i of e){let o=i[0];o!==void 0&&(i[0]=this[wn](o))}r(t,e)}},Jn=class extends Qg{constructor(t,e,r,i){super(t,e),this[Se]=r,this[wn]=i,this[Mr]=this[Mr].bind(this),this[pr]=this[pr].bind(this),this[je]=null}[Mr](t,e){let r=this[je];if(t)return r(t);e!==void 0&&(e=this[wn](e)),r(t,e)}[pr](t,e){let r=this[je];if(t)return r(t);for(let i=0;i<e.length;i++){let o=e[i];o!==void 0&&(e[i]=this[wn](o))}r(t,e)}},Xn=class extends zg{constructor(t,e,r){super(t,e),this[Se]=r}};for(let n of[Yn,Jn])n.prototype._next=function(t){this[je]=t,this[Se].next(this[Mr])},n.prototype._nextv=function(t,e,r){this[je]=r,this[Se].nextv(t,e,this[pr])},n.prototype._all=function(t,e){this[je]=e,this[Se].all(t,this[pr])};for(let n of[Xn])n.prototype._next=function(t){this[Se].next(t)},n.prototype._nextv=function(t,e,r){this[Se].nextv(t,e,r)},n.prototype._all=function(t,e){this[Se].all(t,e)};for(let n of[Yn,Jn,Xn])n.prototype._seek=function(t,e){this[Se].seek(t,e)},n.prototype._close=function(t){this[Se].close(t)};So.AbstractSublevelIterator=Yn;So.AbstractSublevelKeyIterator=Jn;So.AbstractSublevelValueIterator=Xn});var hl=it((Pw,fl)=>{"use strict";_();var ns=me(),{Buffer:as}=kr()||{},{AbstractSublevelIterator:Yg,AbstractSublevelKeyIterator:Jg,AbstractSublevelValueIterator:Xg}=cl(),He=Symbol("prefix"),ul=Symbol("upperBound"),Zn=Symbol("prefixRange"),se=Symbol("parent"),is=Symbol("unfix"),ll=new TextEncoder,Zg={separator:"!"};fl.exports=function({AbstractLevel:n}){class t extends n{static defaults(r){if(typeof r=="string")throw new ns("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(r&&r.open)throw new ns("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return r==null?Zg:r.separator?r:{...r,separator:"!"}}constructor(r,i,o){let{separator:a,manifest:c,...l}=t.defaults(o);i=ed(i,a);let h=a.charCodeAt(0)+1,w=r[se]||r;if(!ll.encode(i).every(d=>d>h&&d<127))throw new ns(`Prefix must use bytes > ${h} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(td(w,c),l);let v=(r.prefix||"")+a+i+a,T=v.slice(0,-1)+String.fromCharCode(h);this[se]=w,this[He]=new Eo(v),this[ul]=new Eo(T),this[is]=new ss,this.nextTick=w.nextTick}prefixKey(r,i){if(i==="utf8")return this[He].utf8+r;if(r.byteLength===0)return this[He][i];if(i==="view"){let o=this[He].view,a=new Uint8Array(o.byteLength+r.byteLength);return a.set(o,0),a.set(r,o.byteLength),a}else{let o=this[He].buffer;return as.concat([o,r],o.byteLength+r.byteLength)}}[Zn](r,i){r.gte!==void 0?r.gte=this.prefixKey(r.gte,i):r.gt!==void 0?r.gt=this.prefixKey(r.gt,i):r.gte=this[He][i],r.lte!==void 0?r.lte=this.prefixKey(r.lte,i):r.lt!==void 0?r.lt=this.prefixKey(r.lt,i):r.lte=this[ul][i]}get prefix(){return this[He].utf8}get db(){return this[se]}_open(r,i){this[se].open({passive:!0},i)}_put(r,i,o,a){this[se].put(r,i,o,a)}_get(r,i,o){this[se].get(r,i,o)}_getMany(r,i,o){this[se].getMany(r,i,o)}_del(r,i,o){this[se].del(r,i,o)}_batch(r,i,o){this[se].batch(r,i,o)}_clear(r,i){this[Zn](r,r.keyEncoding),this[se].clear(r,i)}_iterator(r){this[Zn](r,r.keyEncoding);let i=this[se].iterator(r),o=this[is].get(this[He].utf8.length,r.keyEncoding);return new Yg(this,r,i,o)}_keys(r){this[Zn](r,r.keyEncoding);let i=this[se].keys(r),o=this[is].get(this[He].utf8.length,r.keyEncoding);return new Jg(this,r,i,o)}_values(r){this[Zn](r,r.keyEncoding);let i=this[se].values(r);return new Xg(this,r,i)}}return{AbstractSublevel:t}};var td=function(n,t){return{...n.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:os(n,"utf8"),buffer:os(n,"buffer"),view:os(n,"view")}}},os=function(n,t){return n.supports.encodings[t]?n.keyEncoding(t).name===t:!1},Eo=class{constructor(t){this.utf8=t,this.view=ll.encode(t),this.buffer=as?as.from(this.view.buffer,0,this.view.byteLength):{}}},ss=class{constructor(){this.cache=new Map}get(t,e){let r=this.cache.get(e);return r===void 0&&(e==="view"?r=function(i,o){return o.subarray(i)}.bind(null,t):r=function(i,o){return o.slice(i)}.bind(null,t),this.cache.set(e,r)),r}},ed=function(n,t){let e=0,r=n.length;for(;e<r&&n[e]===t;)e++;for(;r>e&&n[r-1]===t;)r--;return n.slice(e,r)}});var hs=it(fs=>{"use strict";_();var{supports:rd}=_u(),{Transcoder:nd}=Ru(),{EventEmitter:id}=Ku(),{fromCallback:mr}=Vn(),Ee=me(),{AbstractIterator:Fr}=dr(),{DefaultKeyIterator:od,DefaultValueIterator:ad}=Qu(),{DeferredIterator:sd,DeferredKeyIterator:cd,DeferredValueIterator:ud}=zu(),{DefaultChainedBatch:gl}=Zu(),{getCallback:$r,getOptions:yr}=so(),To=rl(),gt=Symbol("promise"),Qe=Symbol("landed"),Kr=Symbol("resources"),cs=Symbol("closeResources"),ti=Symbol("operations"),ei=Symbol("undefer"),xo=Symbol("deferOpen"),dl=Symbol("options"),mt=Symbol("status"),Vr=Symbol("defaultOptions"),vn=Symbol("transcoder"),Co=Symbol("keyEncoding"),us=Symbol("valueEncoding"),ld=()=>{},ri=class extends id{constructor(t,e){if(super(),typeof t!="object"||t===null)throw new TypeError("The first argument 'manifest' must be an object");e=yr(e);let{keyEncoding:r,valueEncoding:i,passive:o,...a}=e;this[Kr]=new Set,this[ti]=[],this[xo]=!0,this[dl]=a,this[mt]="opening",this.supports=rd(t,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:t.snapshots!==!1,permanence:t.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:t.encodings||{},events:Object.assign({},t.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[vn]=new nd(fd(this)),this[Co]=this[vn].encoding(r||"utf8"),this[us]=this[vn].encoding(i||"utf8");for(let c of this[vn].encodings())this.supports.encodings[c.commonName]||(this.supports.encodings[c.commonName]=!0);this[Vr]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[Co].commonName,valueEncoding:this[us].commonName}),key:Object.freeze({keyEncoding:this[Co].commonName})},this.nextTick(()=>{this[xo]&&this.open({passive:!1},ld)})}get status(){return this[mt]}keyEncoding(t){return this[vn].encoding(t??this[Co])}valueEncoding(t){return this[vn].encoding(t??this[us])}open(t,e){e=$r(t,e),e=mr(e,gt),t={...this[dl],...yr(t)},t.createIfMissing=t.createIfMissing!==!1,t.errorIfExists=!!t.errorIfExists;let r=i=>{this[mt]==="closing"||this[mt]==="opening"?this.once(Qe,i?()=>r(i):r):this[mt]!=="open"?e(new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:i})):e()};return t.passive?this[mt]==="opening"?this.once(Qe,r):this.nextTick(r):this[mt]==="closed"||this[xo]?(this[xo]=!1,this[mt]="opening",this.emit("opening"),this._open(t,i=>{if(i){this[mt]="closed",this[cs](()=>{this.emit(Qe),r(i)}),this[ei]();return}this[mt]="open",this[ei](),this.emit(Qe),this[mt]==="open"&&this.emit("open"),this[mt]==="open"&&this.emit("ready"),r()})):this[mt]==="open"?this.nextTick(r):this.once(Qe,()=>this.open(t,e)),e[gt]}_open(t,e){this.nextTick(e)}close(t){t=mr(t,gt);let e=r=>{this[mt]==="opening"||this[mt]==="closing"?this.once(Qe,r?e(r):e):this[mt]!=="closed"?t(new Ee("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:r})):t()};if(this[mt]==="open"){this[mt]="closing",this.emit("closing");let r=i=>{this[mt]="open",this[ei](),this.emit(Qe),e(i)};this[cs](()=>{this._close(i=>{if(i)return r(i);this[mt]="closed",this[ei](),this.emit(Qe),this[mt]==="closed"&&this.emit("closed"),e()})})}else this[mt]==="closed"?this.nextTick(e):this.once(Qe,()=>this.close(t));return t[gt]}[cs](t){if(this[Kr].size===0)return this.nextTick(t);let e=this[Kr].size,r=!0,i=()=>{--e===0&&(r?this.nextTick(t):t())};for(let o of this[Kr])o.close(i);r=!1,this[Kr].clear()}_close(t){this.nextTick(t)}get(t,e,r){if(r=$r(e,r),r=mr(r,gt),e=yr(e,this[Vr].entry),this[mt]==="opening")return this.defer(()=>this.get(t,e,r)),r[gt];if(bn(this,r))return r[gt];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[gt];let o=this.keyEncoding(e.keyEncoding),a=this.valueEncoding(e.valueEncoding),c=o.format,l=a.format;return(e.keyEncoding!==c||e.valueEncoding!==l)&&(e=Object.assign({},e,{keyEncoding:c,valueEncoding:l})),this._get(this.prefixKey(o.encode(t),c),e,(h,w)=>{if(h)return(h.code==="LEVEL_NOT_FOUND"||h.notFound||/NotFound/i.test(h))&&(h.code||(h.code="LEVEL_NOT_FOUND"),h.notFound||(h.notFound=!0),h.status||(h.status=404)),r(h);try{w=a.decode(w)}catch(v){return r(new Ee("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:v}))}r(null,w)}),r[gt]}_get(t,e,r){this.nextTick(r,new Error("NotFound"))}getMany(t,e,r){if(r=$r(e,r),r=mr(r,gt),e=yr(e,this[Vr].entry),this[mt]==="opening")return this.defer(()=>this.getMany(t,e,r)),r[gt];if(bn(this,r))return r[gt];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'keys' must be an array")),r[gt];if(t.length===0)return this.nextTick(r,null,[]),r[gt];let i=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),a=i.format,c=o.format;(e.keyEncoding!==a||e.valueEncoding!==c)&&(e=Object.assign({},e,{keyEncoding:a,valueEncoding:c}));let l=new Array(t.length);for(let h=0;h<t.length;h++){let w=t[h],v=this._checkKey(w);if(v)return this.nextTick(r,v),r[gt];l[h]=this.prefixKey(i.encode(w),a)}return this._getMany(l,e,(h,w)=>{if(h)return r(h);try{for(let v=0;v<w.length;v++)w[v]!==void 0&&(w[v]=o.decode(w[v]))}catch(v){return r(new Ee(`Could not decode one or more of ${w.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:v}))}r(null,w)}),r[gt]}_getMany(t,e,r){this.nextTick(r,null,new Array(t.length).fill(void 0))}put(t,e,r,i){if(i=$r(r,i),i=mr(i,gt),r=yr(r,this[Vr].entry),this[mt]==="opening")return this.defer(()=>this.put(t,e,r,i)),i[gt];if(bn(this,i))return i[gt];let o=this._checkKey(t)||this._checkValue(e);if(o)return this.nextTick(i,o),i[gt];let a=this.keyEncoding(r.keyEncoding),c=this.valueEncoding(r.valueEncoding),l=a.format,h=c.format;(r.keyEncoding!==l||r.valueEncoding!==h)&&(r=Object.assign({},r,{keyEncoding:l,valueEncoding:h}));let w=this.prefixKey(a.encode(t),l),v=c.encode(e);return this._put(w,v,r,T=>{if(T)return i(T);this.emit("put",t,e),i()}),i[gt]}_put(t,e,r,i){this.nextTick(i)}del(t,e,r){if(r=$r(e,r),r=mr(r,gt),e=yr(e,this[Vr].key),this[mt]==="opening")return this.defer(()=>this.del(t,e,r)),r[gt];if(bn(this,r))return r[gt];let i=this._checkKey(t);if(i)return this.nextTick(r,i),r[gt];let o=this.keyEncoding(e.keyEncoding),a=o.format;return e.keyEncoding!==a&&(e=Object.assign({},e,{keyEncoding:a})),this._del(this.prefixKey(o.encode(t),a),e,c=>{if(c)return r(c);this.emit("del",t),r()}),r[gt]}_del(t,e,r){this.nextTick(r)}batch(t,e,r){if(!arguments.length){if(this[mt]==="opening")return new gl(this);if(this[mt]!=="open")throw new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof t=="function"?r=t:r=$r(e,r),r=mr(r,gt),e=yr(e,this[Vr].empty),this[mt]==="opening")return this.defer(()=>this.batch(t,e,r)),r[gt];if(bn(this,r))return r[gt];if(!Array.isArray(t))return this.nextTick(r,new TypeError("The first argument 'operations' must be an array")),r[gt];if(t.length===0)return this.nextTick(r),r[gt];let i=new Array(t.length),{keyEncoding:o,valueEncoding:a,...c}=e;for(let l=0;l<t.length;l++){if(typeof t[l]!="object"||t[l]===null)return this.nextTick(r,new TypeError("A batch operation must be an object")),r[gt];let h=Object.assign({},t[l]);if(h.type!=="put"&&h.type!=="del")return this.nextTick(r,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),r[gt];let w=this._checkKey(h.key);if(w)return this.nextTick(r,w),r[gt];let v=h.sublevel!=null?h.sublevel:this,T=v.keyEncoding(h.keyEncoding||o),d=T.format;if(h.key=v.prefixKey(T.encode(h.key),d),h.keyEncoding=d,h.type==="put"){let y=this._checkValue(h.value);if(y)return this.nextTick(r,y),r[gt];let x=v.valueEncoding(h.valueEncoding||a);h.value=x.encode(h.value),h.valueEncoding=x.format}v!==this&&(h.sublevel=null),i[l]=h}return this._batch(i,c,l=>{if(l)return r(l);this.emit("batch",t),r()}),r[gt]}_batch(t,e,r){this.nextTick(r)}sublevel(t,e){return this._sublevel(t,ls.defaults(e))}_sublevel(t,e){return new ls(this,t,e)}prefixKey(t,e){return t}clear(t,e){if(e=$r(t,e),e=mr(e,gt),t=yr(t,this[Vr].empty),this[mt]==="opening")return this.defer(()=>this.clear(t,e)),e[gt];if(bn(this,e))return e[gt];let r=t,i=this.keyEncoding(t.keyEncoding);return t=To(t,i),t.keyEncoding=i.format,t.limit===0?this.nextTick(e):this._clear(t,o=>{if(o)return e(o);this.emit("clear",r),e()}),e[gt]}_clear(t,e){this.nextTick(e)}iterator(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=To(t,e),t.keys=t.keys!==!1,t.values=t.values!==!1,t[Fr.keyEncoding]=e,t[Fr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[mt]==="opening")return new sd(this,t);if(this[mt]!=="open")throw new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(t)}_iterator(t){return new Fr(this,t)}keys(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=To(t,e),t[Fr.keyEncoding]=e,t[Fr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[mt]==="opening")return new cd(this,t);if(this[mt]!=="open")throw new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(t)}_keys(t){return new od(this,t)}values(t){let e=this.keyEncoding(t&&t.keyEncoding),r=this.valueEncoding(t&&t.valueEncoding);if(t=To(t,e),t[Fr.keyEncoding]=e,t[Fr.valueEncoding]=r,t.keyEncoding=e.format,t.valueEncoding=r.format,this[mt]==="opening")return new ud(this,t);if(this[mt]!=="open")throw new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(t)}_values(t){return new ad(this,t)}defer(t){if(typeof t!="function")throw new TypeError("The first argument must be a function");this[ti].push(t)}[ei](){if(this[ti].length===0)return;let t=this[ti];this[ti]=[];for(let e of t)e()}attachResource(t){if(typeof t!="object"||t===null||typeof t.close!="function")throw new TypeError("The first argument must be a resource object");this[Kr].add(t)}detachResource(t){this[Kr].delete(t)}_chainedBatch(){return new gl(this)}_checkKey(t){if(t==null)return new Ee("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(t){if(t==null)return new Ee("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};ri.prototype.nextTick=sl();var{AbstractSublevel:ls}=hl()({AbstractLevel:ri});fs.AbstractLevel=ri;fs.AbstractSublevel=ls;var bn=function(n,t){return n[mt]!=="open"?(n.nextTick(t,new Ee("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},fd=function(n){return Object.keys(n.supports.encodings).filter(t=>!!n.supports.encodings[t])}});var Io=it(Gr=>{"use strict";_();Gr.AbstractLevel=hs().AbstractLevel;Gr.AbstractSublevel=hs().AbstractSublevel;Gr.AbstractIterator=dr().AbstractIterator;Gr.AbstractKeyIterator=dr().AbstractKeyIterator;Gr.AbstractValueIterator=dr().AbstractValueIterator;Gr.AbstractChainedBatch=ts().AbstractChainedBatch});var ml=it((Fw,pl)=>{_();pl.exports=gd;var hd=rs();function gd(n,t,e){if(typeof t!="number")throw new Error("second argument must be a Number");let r,i,o,a,c,l=!0,h;Array.isArray(n)?(r=[],o=i=n.length):(a=Object.keys(n),r={},o=i=a.length);function w(T){function d(){e&&e(T,r),e=null}l?hd(d):d()}function v(T,d,y){if(r[T]=y,d&&(c=!0),--o===0||d)w(d);else if(!c&&h<i){let x;a?(x=a[h],h+=1,n[x](function(R,N){v(x,R,N)})):(x=h,h+=1,n[x](function(R,N){v(x,R,N)}))}}h=t,o?a?a.some(function(T,d){return n[T](function(y,x){v(T,y,x)}),d===t-1}):n.some(function(T,d){return T(function(y,x){v(d,y,x)}),d===t-1}):w(null),l=!1}});var gs=it((Kw,yl)=>{"use strict";_();yl.exports=function(t){let e=t.gte!==void 0?t.gte:t.gt!==void 0?t.gt:void 0,r=t.lte!==void 0?t.lte:t.lt!==void 0?t.lt:void 0,i=t.gte===void 0,o=t.lte===void 0;return e!==void 0&&r!==void 0?IDBKeyRange.bound(e,r,i,o):e!==void 0?IDBKeyRange.lowerBound(e,i):r!==void 0?IDBKeyRange.upperBound(r,o):null}});var ds=it((Gw,wl)=>{"use strict";_();var dd=new TextEncoder;wl.exports=function(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):dd.encode(n)}});var El=it(Sl=>{"use strict";_();var{AbstractIterator:pd}=Io(),vl=gs(),Ao=ds(),Ne=Symbol("cache"),ze=Symbol("finished"),ce=Symbol("options"),Ye=Symbol("currentOptions"),qr=Symbol("position"),ps=Symbol("location"),_n=Symbol("first"),bl={},ms=class extends pd{constructor(t,e,r){super(t,r),this[Ne]=[],this[ze]=this.limit===0,this[ce]=r,this[Ye]={...r},this[qr]=void 0,this[ps]=e,this[_n]=!0}_nextv(t,e,r){if(this[_n]=!1,this[ze])return this.nextTick(r,null,[]);if(this[Ne].length>0)return t=Math.min(t,this[Ne].length),this.nextTick(r,null,this[Ne].splice(0,t));this[qr]!==void 0&&(this[ce].reverse?(this[Ye].lt=this[qr],this[Ye].lte=void 0):(this[Ye].gt=this[qr],this[Ye].gte=void 0));let i;try{i=vl(this[Ye])}catch{return this[ze]=!0,this.nextTick(r,null,[])}let o=this.db.db.transaction([this[ps]],"readonly"),a=o.objectStore(this[ps]),c=[];if(this[ce].reverse){let l=!this[ce].values&&a.openKeyCursor?"openKeyCursor":"openCursor";a[l](i,"prev").onsuccess=h=>{let w=h.target.result;if(w){let{key:v,value:T}=w;this[qr]=v,c.push([this[ce].keys&&v!==void 0?Ao(v):void 0,this[ce].values&&T!==void 0?Ao(T):void 0]),c.length<t?w.continue():_l(o)}else this[ze]=!0}}else{let l,h,w=()=>{if(l===void 0||h===void 0)return;let v=Math.max(l.length,h.length);v===0||t===1/0?this[ze]=!0:this[qr]=l[v-1],c.length=v;for(let T=0;T<v;T++){let d=l[T],y=h[T];c[T]=[this[ce].keys&&d!==void 0?Ao(d):void 0,this[ce].values&&y!==void 0?Ao(y):void 0]}_l(o)};this[ce].keys||t<1/0?a.getAllKeys(i,t<1/0?t:void 0).onsuccess=v=>{l=v.target.result,w()}:(l=[],this.nextTick(w)),this[ce].values?a.getAll(i,t<1/0?t:void 0).onsuccess=v=>{h=v.target.result,w()}:(h=[],this.nextTick(w))}o.onabort=()=>{r(o.error||new Error("aborted by user")),r=null},o.oncomplete=()=>{r(null,c),r=null}}_next(t){if(this[Ne].length>0){let[e,r]=this[Ne].shift();this.nextTick(t,null,e,r)}else if(this[ze])this.nextTick(t);else{let e=Math.min(100,this.limit-this.count);this[_n]&&(this[_n]=!1,e=1),this._nextv(e,bl,(r,i)=>{if(r)return t(r);this[Ne]=i,this._next(t)})}}_all(t,e){this[_n]=!1;let r=this[Ne].splice(0,this[Ne].length),i=this.limit-this.count-r.length;if(i<=0)return this.nextTick(e,null,r);this._nextv(i,bl,(o,a)=>{if(o)return e(o);r.length>0&&(a=r.concat(a)),e(null,a)})}_seek(t,e){this[_n]=!0,this[Ne]=[],this[ze]=!1,this[qr]=void 0,this[Ye]={...this[ce]};let r;try{r=vl(this[ce])}catch{this[ze]=!0;return}r!==null&&!r.includes(t)?this[ze]=!0:this[ce].reverse?this[Ye].lte=t:this[Ye].gte=t}};Sl.Iterator=ms;function _l(n){typeof n.commit=="function"&&n.commit()}});var xl=it((Qw,Tl)=>{"use strict";_();Tl.exports=function(t,e,r,i,o){if(i.limit===0)return t.nextTick(o);let a=t.db.transaction([e],"readwrite"),c=a.objectStore(e),l=0;a.oncomplete=function(){o()},a.onabort=function(){o(a.error||new Error("aborted by user"))};let h=c.openKeyCursor?"openKeyCursor":"openCursor",w=i.reverse?"prev":"next";c[h](r,w).onsuccess=function(v){let T=v.target.result;T&&(c.delete(T.key).onsuccess=function(){(i.limit<=0||++l<i.limit)&&T.continue()})}}});var Rl=it(kl=>{"use strict";_();var{AbstractLevel:md}=Io(),Cl=me(),yd=ml(),{fromCallback:wd}=Vn(),{Iterator:vd}=El(),Il=ds(),bd=xl(),_d=gs(),Ll="level-js-",ni=Symbol("idb"),ys=Symbol("namePrefix"),Je=Symbol("location"),ws=Symbol("version"),jr=Symbol("store"),ii=Symbol("onComplete"),Al=Symbol("promise"),Lo=class extends md{constructor(t,e,r){if(typeof e=="function"||typeof r=="function")throw new Cl("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{prefix:i,version:o,...a}=e||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},a),typeof t!="string")throw new Error("constructor requires a location string argument");this[Je]=t,this[ys]=i??Ll,this[ws]=parseInt(o||1,10),this[ni]=null}get location(){return this[Je]}get namePrefix(){return this[ys]}get version(){return this[ws]}get db(){return this[ni]}get type(){return"browser-level"}_open(t,e){let r=indexedDB.open(this[ys]+this[Je],this[ws]);r.onerror=function(){e(r.error||new Error("unknown error"))},r.onsuccess=()=>{this[ni]=r.result,e()},r.onupgradeneeded=i=>{let o=i.target.result;o.objectStoreNames.contains(this[Je])||o.createObjectStore(this[Je])}}[jr](t){return this[ni].transaction([this[Je]],t).objectStore(this[Je])}[ii](t,e){let r=t.transaction;r.onabort=function(){e(r.error||new Error("aborted by user"))},r.oncomplete=function(){e(null,t.result)}}_get(t,e,r){let i=this[jr]("readonly"),o;try{o=i.get(t)}catch(a){return this.nextTick(r,a)}this[ii](o,function(a,c){if(a)return r(a);if(c===void 0)return r(new Cl("Entry not found",{code:"LEVEL_NOT_FOUND"}));r(null,Il(c))})}_getMany(t,e,r){let i=this[jr]("readonly"),o=t.map(a=>c=>{let l;try{l=i.get(a)}catch(h){return c(h)}l.onsuccess=()=>{let h=l.result;c(null,h===void 0?h:Il(h))},l.onerror=h=>{h.stopPropagation(),c(l.error)}});yd(o,16,r)}_del(t,e,r){let i=this[jr]("readwrite"),o;try{o=i.delete(t)}catch(a){return this.nextTick(r,a)}this[ii](o,r)}_put(t,e,r,i){let o=this[jr]("readwrite"),a;try{a=o.put(e,t)}catch(c){return this.nextTick(i,c)}this[ii](a,i)}_iterator(t){return new vd(this,this[Je],t)}_batch(t,e,r){let i=this[jr]("readwrite"),o=i.transaction,a=0,c;o.onabort=function(){r(c||o.error||new Error("aborted by user"))},o.oncomplete=function(){r()};function l(){let h=t[a++],w=h.key,v;try{v=h.type==="del"?i.delete(w):i.put(h.value,w)}catch(T){c=T,o.abort();return}a<t.length?v.onsuccess=l:typeof o.commit=="function"&&o.commit()}l()}_clear(t,e){let r,i;try{r=_d(t)}catch{return this.nextTick(e)}if(t.limit>=0)return bd(this,this[Je],r,t,e);try{let o=this[jr]("readwrite");i=r?o.delete(r):o.clear()}catch(o){return this.nextTick(e,o)}this[ii](i,e)}_close(t){this[ni].close(),this.nextTick(t)}};Lo.destroy=function(n,t,e){typeof t=="function"&&(e=t,t=Ll),e=wd(e,Al);let r=indexedDB.deleteDatabase(t+n);return r.onsuccess=function(){e()},r.onerror=function(i){e(i)},e[Al]};kl.BrowserLevel=Lo});var Bl=it(Ol=>{_();Ol.Level=Rl().BrowserLevel});var Ul=it((tv,Nl)=>{"use strict";_();Nl.exports=Td;var It=0,Et=1;function ue(n,t,e,r,i,o){this._color=n,this.key=t,this.value=e,this.left=r,this.right=i,this._count=o}function Ue(n){return new ue(n._color,n.key,n.value,n.left,n.right,n._count)}function wr(n,t){return new ue(n,t.key,t.value,t.left,t.right,t._count)}function kt(n){n._count=1+(n.left?n.left._count:0)+(n.right?n.right._count:0)}function vr(n,t){this._compare=n,this.root=t}var Yt=vr.prototype;Object.defineProperty(Yt,"keys",{get:function(){var n=[];return this.forEach(function(t,e){n.push(t)}),n}});Object.defineProperty(Yt,"values",{get:function(){var n=[];return this.forEach(function(t,e){n.push(e)}),n}});Object.defineProperty(Yt,"length",{get:function(){return this.root?this.root._count:0}});Yt.insert=function(n,t){for(var e=this._compare,r=this.root,i=[],o=[];r;){var a=e(n,r.key);i.push(r),o.push(a),a<=0?r=r.left:r=r.right}i.push(new ue(It,n,t,null,null,1));for(var c=i.length-2;c>=0;--c){var r=i[c];o[c]<=0?i[c]=new ue(r._color,r.key,r.value,i[c+1],r.right,r._count+1):i[c]=new ue(r._color,r.key,r.value,r.left,i[c+1],r._count+1)}for(var c=i.length-1;c>1;--c){var l=i[c-1],r=i[c];if(l._color===Et||r._color===Et)break;var h=i[c-2];if(h.left===l)if(l.left===r){var w=h.right;if(w&&w._color===It)l._color=Et,h.right=wr(Et,w),h._color=It,c-=1;else{if(h._color=It,h.left=l.right,l._color=Et,l.right=h,i[c-2]=l,i[c-1]=r,kt(h),kt(l),c>=3){var v=i[c-3];v.left===h?v.left=l:v.right=l}break}}else{var w=h.right;if(w&&w._color===It)l._color=Et,h.right=wr(Et,w),h._color=It,c-=1;else{if(l.right=r.left,h._color=It,h.left=r.right,r._color=Et,r.left=l,r.right=h,i[c-2]=r,i[c-1]=l,kt(h),kt(l),kt(r),c>=3){var v=i[c-3];v.left===h?v.left=r:v.right=r}break}}else if(l.right===r){var w=h.left;if(w&&w._color===It)l._color=Et,h.left=wr(Et,w),h._color=It,c-=1;else{if(h._color=It,h.right=l.left,l._color=Et,l.left=h,i[c-2]=l,i[c-1]=r,kt(h),kt(l),c>=3){var v=i[c-3];v.right===h?v.right=l:v.left=l}break}}else{var w=h.left;if(w&&w._color===It)l._color=Et,h.left=wr(Et,w),h._color=It,c-=1;else{if(l.left=r.right,h._color=It,h.right=r.left,r._color=Et,r.right=l,r.left=h,i[c-2]=r,i[c-1]=l,kt(h),kt(l),kt(r),c>=3){var v=i[c-3];v.right===h?v.right=r:v.left=r}break}}}return i[0]._color=Et,new vr(e,i[0])};function vs(n,t){if(t.left){var e=vs(n,t.left);if(e)return e}var e=n(t.key,t.value);if(e)return e;if(t.right)return vs(n,t.right)}function bs(n,t,e,r){var i=t(n,r.key);if(i<=0){if(r.left){var o=bs(n,t,e,r.left);if(o)return o}var o=e(r.key,r.value);if(o)return o}if(r.right)return bs(n,t,e,r.right)}function _s(n,t,e,r,i){var o=e(n,i.key),a=e(t,i.key),c;if(o<=0&&(i.left&&(c=_s(n,t,e,r,i.left),c)||a>0&&(c=r(i.key,i.value),c)))return c;if(a>0&&i.right)return _s(n,t,e,r,i.right)}Yt.forEach=function(t,e,r){if(this.root)switch(arguments.length){case 1:return vs(t,this.root);case 2:return bs(e,this._compare,t,this.root);case 3:return this._compare(e,r)>=0?void 0:_s(e,r,this._compare,t,this.root)}};Object.defineProperty(Yt,"begin",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.left;return new le(this,n)}});Object.defineProperty(Yt,"end",{get:function(){for(var n=[],t=this.root;t;)n.push(t),t=t.right;return new le(this,n)}});Yt.at=function(n){if(n<0)return new le(this,[]);for(var t=this.root,e=[];;){if(e.push(t),t.left){if(n<t.left._count){t=t.left;continue}n-=t.left._count}if(!n)return new le(this,e);if(n-=1,t.right){if(n>=t.right._count)break;t=t.right}else break}return new le(this,[])};Yt.ge=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<=0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Yt.gt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o<0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Yt.lt=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>0&&(i=r.length),o<=0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Yt.le=function(n){for(var t=this._compare,e=this.root,r=[],i=0;e;){var o=t(n,e.key);r.push(e),o>=0&&(i=r.length),o<0?e=e.left:e=e.right}return r.length=i,new le(this,r)};Yt.find=function(n){for(var t=this._compare,e=this.root,r=[];e;){var i=t(n,e.key);if(r.push(e),i===0)return new le(this,r);i<=0?e=e.left:e=e.right}return new le(this,[])};Yt.remove=function(n){var t=this.find(n);return t?t.remove():this};Yt.get=function(n){for(var t=this._compare,e=this.root;e;){var r=t(n,e.key);if(r===0)return e.value;r<=0?e=e.left:e=e.right}};function le(n,t){this.tree=n,this._stack=t}var ve=le.prototype;Object.defineProperty(ve,"valid",{get:function(){return this._stack.length>0}});Object.defineProperty(ve,"node",{get:function(){return this._stack.length>0?this._stack[this._stack.length-1]:null},enumerable:!0});ve.clone=function(){return new le(this.tree,this._stack.slice())};function Pl(n,t){n.key=t.key,n.value=t.value,n.left=t.left,n.right=t.right,n._color=t._color,n._count=t._count}function Sd(n){for(var t,e,r,i,o=n.length-1;o>=0;--o){if(t=n[o],o===0){t._color=Et;return}if(e=n[o-1],e.left===t){if(r=e.right,r.right&&r.right._color===It){if(r=e.right=Ue(r),i=r.right=Ue(r.right),e.right=r.left,r.left=e,r.right=i,r._color=e._color,t._color=Et,e._color=Et,i._color=Et,kt(e),kt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r;return}else if(r.left&&r.left._color===It){if(r=e.right=Ue(r),i=r.left=Ue(r.left),e.right=i.left,r.left=i.right,i.left=e,i.right=r,i._color=e._color,e._color=Et,r._color=Et,t._color=Et,kt(e),kt(r),kt(i),o>1){var a=n[o-2];a.left===e?a.left=i:a.right=i}n[o-1]=i;return}if(r._color===Et)if(e._color===It){e._color=Et,e.right=wr(It,r);return}else{e.right=wr(It,r);continue}else{if(r=Ue(r),e.right=r.left,r.left=e,r._color=e._color,e._color=It,kt(e),kt(r),o>1){var a=n[o-2];a.left===e?a.left=r:a.right=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}else{if(r=e.left,r.left&&r.left._color===It){if(r=e.left=Ue(r),i=r.left=Ue(r.left),e.left=r.right,r.right=e,r.left=i,r._color=e._color,t._color=Et,e._color=Et,i._color=Et,kt(e),kt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r;return}else if(r.right&&r.right._color===It){if(r=e.left=Ue(r),i=r.right=Ue(r.right),e.left=i.right,r.right=i.left,i.right=e,i.left=r,i._color=e._color,e._color=Et,r._color=Et,t._color=Et,kt(e),kt(r),kt(i),o>1){var a=n[o-2];a.right===e?a.right=i:a.left=i}n[o-1]=i;return}if(r._color===Et)if(e._color===It){e._color=Et,e.left=wr(It,r);return}else{e.left=wr(It,r);continue}else{if(r=Ue(r),e.left=r.right,r.right=e,r._color=e._color,e._color=It,kt(e),kt(r),o>1){var a=n[o-2];a.right===e?a.right=r:a.left=r}n[o-1]=r,n[o]=e,o+1<n.length?n[o+1]=t:n.push(t),o=o+2}}}}ve.remove=function(){var n=this._stack;if(n.length===0)return this.tree;var t=new Array(n.length),e=n[n.length-1];t[t.length-1]=new ue(e._color,e.key,e.value,e.left,e.right,e._count);for(var r=n.length-2;r>=0;--r){var e=n[r];e.left===n[r+1]?t[r]=new ue(e._color,e.key,e.value,t[r+1],e.right,e._count):t[r]=new ue(e._color,e.key,e.value,e.left,t[r+1],e._count)}if(e=t[t.length-1],e.left&&e.right){var i=t.length;for(e=e.left;e.right;)t.push(e),e=e.right;var o=t[i-1];t.push(new ue(e._color,o.key,o.value,e.left,e.right,e._count)),t[i-1].key=e.key,t[i-1].value=e.value;for(var r=t.length-2;r>=i;--r)e=t[r],t[r]=new ue(e._color,e.key,e.value,e.left,t[r+1],e._count);t[i-1].left=t[i]}if(e=t[t.length-1],e._color===It){var a=t[t.length-2];a.left===e?a.left=null:a.right===e&&(a.right=null),t.pop();for(var r=0;r<t.length;++r)t[r]._count--;return new vr(this.tree._compare,t[0])}else if(e.left||e.right){e.left?Pl(e,e.left):e.right&&Pl(e,e.right),e._color=Et;for(var r=0;r<t.length-1;++r)t[r]._count--;return new vr(this.tree._compare,t[0])}else{if(t.length===1)return new vr(this.tree._compare,null);for(var r=0;r<t.length;++r)t[r]._count--;var c=t[t.length-2];Sd(t),c.left===e?c.left=null:c.right=null}return new vr(this.tree._compare,t[0])};Object.defineProperty(ve,"key",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].key},enumerable:!0});Object.defineProperty(ve,"value",{get:function(){if(this._stack.length>0)return this._stack[this._stack.length-1].value},enumerable:!0});Object.defineProperty(ve,"index",{get:function(){var n=0,t=this._stack;if(t.length===0){var e=this.tree.root;return e?e._count:0}else t[t.length-1].left&&(n=t[t.length-1].left._count);for(var r=t.length-2;r>=0;--r)t[r+1]===t[r].right&&(++n,t[r].left&&(n+=t[r].left._count));return n},enumerable:!0});ve.next=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.right)for(t=t.right;t;)n.push(t),t=t.left;else for(n.pop();n.length>0&&n[n.length-1].right===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(ve,"hasNext",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].right)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].left===n[t])return!0;return!1}});ve.update=function(n){var t=this._stack;if(t.length===0)throw new Error("Can't update empty node!");var e=new Array(t.length),r=t[t.length-1];e[e.length-1]=new ue(r._color,r.key,n,r.left,r.right,r._count);for(var i=t.length-2;i>=0;--i)r=t[i],r.left===t[i+1]?e[i]=new ue(r._color,r.key,r.value,e[i+1],r.right,r._count):e[i]=new ue(r._color,r.key,r.value,r.left,e[i+1],r._count);return new vr(this.tree._compare,e[0])};ve.prev=function(){var n=this._stack;if(n.length!==0){var t=n[n.length-1];if(t.left)for(t=t.left;t;)n.push(t),t=t.right;else for(n.pop();n.length>0&&n[n.length-1].left===t;)t=n[n.length-1],n.pop()}};Object.defineProperty(ve,"hasPrev",{get:function(){var n=this._stack;if(n.length===0)return!1;if(n[n.length-1].left)return!0;for(var t=n.length-1;t>0;--t)if(n[t-1].right===n[t])return!0;return!1}});function Ed(n,t){return n<t?-1:n>t?1:0}function Td(n){return new vr(n||Ed,null)}});var $l=it(Fl=>{"use strict";_();var{AbstractLevel:xd,AbstractIterator:Cd,AbstractKeyIterator:Id,AbstractValueIterator:Ad}=Io(),Wl=me(),Dl=Ul(),Ld=new Set(["gt","gte","lt","lte"]),Xe=Symbol("none"),qt=Symbol("tree"),_t=Symbol("iterator"),fe=Symbol("lowerBound"),br=Symbol("upperBound"),Ml=Symbol("outOfRange"),ko=Symbol("reverse"),Ss=Symbol("options"),ie=Symbol("test"),be=Symbol("advance"),No=Symbol("init");function We(n,t){if(typeof n=="string")return n<t?-1:n>t?1:0;let e=Math.min(n.byteLength,t.byteLength);for(let r=0;r<e;r++){let i=n[r]-t[r];if(i!==0)return i}return n.byteLength-t.byteLength}function kd(n){return We(n,this[br])>0}function Rd(n){return We(n,this[br])>=0}function Od(n){return We(n,this[br])<0}function Bd(n){return We(n,this[br])<=0}var Ro=class extends Cd{constructor(t,e){super(t,e),this[No](t[qt],e)}_next(t){if(!this[_t].valid)return this.nextTick(t);let e=this[_t].key,r=this[_t].value;if(!this[ie](e))return this.nextTick(t);this[_t][this[be]](),this.nextTick(t,null,e,r)}_nextv(t,e,r){let i=this[_t],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push([i.key,i.value]),i[this[be]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[_t],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push([i.key,i.value]),i[this[be]]();this.nextTick(e,null,o)}},Oo=class extends Id{constructor(t,e){super(t,e),this[No](t[qt],e)}_next(t){if(!this[_t].valid)return this.nextTick(t);let e=this[_t].key;if(!this[ie](e))return this.nextTick(t);this[_t][this[be]](),this.nextTick(t,null,e)}_nextv(t,e,r){let i=this[_t],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push(i.key),i[this[be]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[_t],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push(i.key),i[this[be]]();this.nextTick(e,null,o)}},Bo=class extends Ad{constructor(t,e){super(t,e),this[No](t[qt],e)}_next(t){if(!this[_t].valid)return this.nextTick(t);let e=this[_t].key,r=this[_t].value;if(!this[ie](e))return this.nextTick(t);this[_t][this[be]](),this.nextTick(t,null,r)}_nextv(t,e,r){let i=this[_t],o=[];for(;i.valid&&o.length<t&&this[ie](i.key);)o.push(i.value),i[this[be]]();this.nextTick(r,null,o)}_all(t,e){let r=this.limit-this.count,i=this[_t],o=[];for(;i.valid&&o.length<r&&this[ie](i.key);)o.push(i.value),i[this[be]]();this.nextTick(e,null,o)}};for(let n of[Ro,Oo,Bo])n.prototype[No]=function(t,e){this[ko]=e.reverse,this[Ss]=e,this[ko]?(this[be]="prev",this[fe]="lte"in e?e.lte:"lt"in e?e.lt:Xe,this[br]="gte"in e?e.gte:"gt"in e?e.gt:Xe,this[fe]===Xe?this[_t]=t.end:"lte"in e?this[_t]=t.le(this[fe]):this[_t]=t.lt(this[fe]),this[br]!==Xe&&(this[ie]="gte"in e?Rd:kd)):(this[be]="next",this[fe]="gte"in e?e.gte:"gt"in e?e.gt:Xe,this[br]="lte"in e?e.lte:"lt"in e?e.lt:Xe,this[fe]===Xe?this[_t]=t.begin:"gte"in e?this[_t]=t.ge(this[fe]):this[_t]=t.gt(this[fe]),this[br]!==Xe&&(this[ie]="lte"in e?Bd:Od))},n.prototype[ie]=function(){return!0},n.prototype[Ml]=function(t){return this[ie](t)?this[fe]===Xe?!1:this[ko]?"lte"in this[Ss]?We(t,this[fe])>0:We(t,this[fe])>=0:"gte"in this[Ss]?We(t,this[fe])<0:We(t,this[fe])<=0:!0},n.prototype._seek=function(t,e){this[Ml](t)?(this[_t]=this[_t].tree.end,this[_t].next()):this[ko]?this[_t]=this[_t].tree.le(t):this[_t]=this[_t].tree.ge(t)};var Po=class extends xd{constructor(t,e,r){if(typeof t=="object"&&t!==null&&(e=t),typeof t=="function"||typeof e=="function"||typeof r=="function")throw new Wl("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});let{storeEncoding:i,...o}=e||{};if(i=i||"buffer",!["buffer","view","utf8"].includes(i))throw new Wl("The storeEncoding option must be 'buffer', 'view' or 'utf8'",{code:"LEVEL_ENCODING_NOT_SUPPORTED"});super({seek:!0,permanence:!1,createIfMissing:!1,errorIfExists:!1,encodings:{[i]:!0}},o),this[qt]=Dl(We)}_put(t,e,r,i){let o=this[qt].find(t);o.valid?this[qt]=o.update(e):this[qt]=this[qt].insert(t,e),this.nextTick(i)}_get(t,e,r){let i=this[qt].get(t);if(typeof i>"u")return this.nextTick(r,new Error("NotFound"));this.nextTick(r,null,i)}_getMany(t,e,r){this.nextTick(r,null,t.map(i=>this[qt].get(i)))}_del(t,e,r){this[qt]=this[qt].remove(t),this.nextTick(r)}_batch(t,e,r){let i=this[qt];for(let o of t){let a=o.key,c=i.find(a);o.type==="put"?i=c.valid?c.update(o.value):i.insert(a,o.value):i=c.remove()}this[qt]=i,this.nextTick(r)}_clear(t,e){if(t.limit===-1&&!Object.keys(t).some(Pd))return this[qt]=Dl(We),this.nextTick(e);let r=this._keys({...t}),i=r.limit,o=0,a=()=>{for(let c=0;c<500;c++){if(++o>i||!r[_t].valid||!r[ie](r[_t].key))return e();this[qt]=this[qt].remove(r[_t].key),r[_t][r[be]]()}this.nextTick(a)};this.nextTick(a)}_iterator(t){return new Ro(this,t)}_keys(t){return new Oo(this,t)}_values(t){return new Bo(this,t)}};Fl.MemoryLevel=Po;if(typeof $.default<"u"&&!$.default.browser&&typeof K<"u"&&typeof K.setImmediate=="function"){let n=K.setImmediate;Po.prototype.nextTick=function(t,...e){e.length===0?n(t):n(()=>t(...e))}}function Pd(n){return Ld.has(n)}});var Ze=it((gv,Ts)=>{_();typeof window<"u"?(window.global=window,K.fetch=window.fetch,Ts.exports={Buffer:kr().Buffer,Crypto:window.crypto}):Ts.exports={Buffer:kr().Buffer,Crypto:crypto}});var Os=it((ef,$o)=>{_();(function(n){"use strict";var t,e=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,r=Math.ceil,i=Math.floor,o="[BigNumber Error] ",a=o+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,h=9007199254740991,w=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],v=1e7,T=1e9;function d(W){var V,ot,nt,G=X.prototype={constructor:X,toString:null,valueOf:null},J=new X(1),rt=20,ht=4,yt=-7,lt=21,Nt=-1e7,Lt=1e7,tt=!1,Kt=1,wt=0,ee={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},vt="0123456789abcdefghijklmnopqrstuvwxyz",At=!0;function X(p,b){var S,U,A,O,D,I,L,B,P=this;if(!(P instanceof X))return new X(p,b);if(b==null){if(p&&p._isBigNumber===!0){P.s=p.s,!p.c||p.e>Lt?P.c=P.e=null:p.e<Nt?P.c=[P.e=0]:(P.e=p.e,P.c=p.c.slice());return}if((I=typeof p=="number")&&p*0==0){if(P.s=1/p<0?(p=-p,-1):1,p===~~p){for(O=0,D=p;D>=10;D/=10,O++);O>Lt?P.c=P.e=null:(P.e=O,P.c=[p]);return}B=String(p)}else{if(!e.test(B=String(p)))return nt(P,B,I);P.s=B.charCodeAt(0)==45?(B=B.slice(1),-1):1}(O=B.indexOf("."))>-1&&(B=B.replace(".","")),(D=B.search(/e/i))>0?(O<0&&(O=D),O+=+B.slice(D+1),B=B.substring(0,D)):O<0&&(O=B.length)}else{if(N(b,2,vt.length,"Base"),b==10&&At)return P=new X(p),Vt(P,rt+P.e+1,ht);if(B=String(p),I=typeof p=="number"){if(p*0!=0)return nt(P,B,I,b);if(P.s=1/p<0?(B=B.slice(1),-1):1,X.DEBUG&&B.replace(/^0\.0*|\./,"").length>15)throw Error(a+p)}else P.s=B.charCodeAt(0)===45?(B=B.slice(1),-1):1;for(S=vt.slice(0,b),O=D=0,L=B.length;D<L;D++)if(S.indexOf(U=B.charAt(D))<0){if(U=="."){if(D>O){O=L;continue}}else if(!A&&(B==B.toUpperCase()&&(B=B.toLowerCase())||B==B.toLowerCase()&&(B=B.toUpperCase()))){A=!0,D=-1,O=0;continue}return nt(P,String(p),I,b)}I=!1,B=ot(B,b,10,P.s),(O=B.indexOf("."))>-1?B=B.replace(".",""):O=B.length}for(D=0;B.charCodeAt(D)===48;D++);for(L=B.length;B.charCodeAt(--L)===48;);if(B=B.slice(D,++L)){if(L-=D,I&&X.DEBUG&&L>15&&(p>h||p!==i(p)))throw Error(a+P.s*p);if((O=O-D-1)>Lt)P.c=P.e=null;else if(O<Nt)P.c=[P.e=0];else{if(P.e=O,P.c=[],D=(O+1)%l,O<0&&(D+=l),D<L){for(D&&P.c.push(+B.slice(0,D)),L-=l;D<L;)P.c.push(+B.slice(D,D+=l));D=l-(B=B.slice(D)).length}else D-=L;for(;D--;B+="0");P.c.push(+B)}}else P.c=[P.e=0]}X.clone=d,X.ROUND_UP=0,X.ROUND_DOWN=1,X.ROUND_CEIL=2,X.ROUND_FLOOR=3,X.ROUND_HALF_UP=4,X.ROUND_HALF_DOWN=5,X.ROUND_HALF_EVEN=6,X.ROUND_HALF_CEIL=7,X.ROUND_HALF_FLOOR=8,X.EUCLID=9,X.config=X.set=function(p){var b,S;if(p!=null)if(typeof p=="object"){if(p.hasOwnProperty(b="DECIMAL_PLACES")&&(S=p[b],N(S,0,T,b),rt=S),p.hasOwnProperty(b="ROUNDING_MODE")&&(S=p[b],N(S,0,8,b),ht=S),p.hasOwnProperty(b="EXPONENTIAL_AT")&&(S=p[b],S&&S.pop?(N(S[0],-T,0,b),N(S[1],0,T,b),yt=S[0],lt=S[1]):(N(S,-T,T,b),yt=-(lt=S<0?-S:S))),p.hasOwnProperty(b="RANGE"))if(S=p[b],S&&S.pop)N(S[0],-T,-1,b),N(S[1],1,T,b),Nt=S[0],Lt=S[1];else if(N(S,-T,T,b),S)Nt=-(Lt=S<0?-S:S);else throw Error(o+b+" cannot be zero: "+S);if(p.hasOwnProperty(b="CRYPTO"))if(S=p[b],S===!!S)if(S)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))tt=S;else throw tt=!S,Error(o+"crypto unavailable");else tt=S;else throw Error(o+b+" not true or false: "+S);if(p.hasOwnProperty(b="MODULO_MODE")&&(S=p[b],N(S,0,9,b),Kt=S),p.hasOwnProperty(b="POW_PRECISION")&&(S=p[b],N(S,0,T,b),wt=S),p.hasOwnProperty(b="FORMAT"))if(S=p[b],typeof S=="object")ee=S;else throw Error(o+b+" not an object: "+S);if(p.hasOwnProperty(b="ALPHABET"))if(S=p[b],typeof S=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(S))At=S.slice(0,10)=="0123456789",vt=S;else throw Error(o+b+" invalid: "+S)}else throw Error(o+"Object expected: "+p);return{DECIMAL_PLACES:rt,ROUNDING_MODE:ht,EXPONENTIAL_AT:[yt,lt],RANGE:[Nt,Lt],CRYPTO:tt,MODULO_MODE:Kt,POW_PRECISION:wt,FORMAT:ee,ALPHABET:vt}},X.isBigNumber=function(p){if(!p||p._isBigNumber!==!0)return!1;if(!X.DEBUG)return!0;var b,S,U=p.c,A=p.e,O=p.s;t:if({}.toString.call(U)=="[object Array]"){if((O===1||O===-1)&&A>=-T&&A<=T&&A===i(A)){if(U[0]===0){if(A===0&&U.length===1)return!0;break t}if(b=(A+1)%l,b<1&&(b+=l),String(U[0]).length==b){for(b=0;b<U.length;b++)if(S=U[b],S<0||S>=c||S!==i(S))break t;if(S!==0)return!0}}}else if(U===null&&A===null&&(O===null||O===1||O===-1))return!0;throw Error(o+"Invalid BigNumber: "+p)},X.maximum=X.max=function(){return Ir(arguments,G.lt)},X.minimum=X.min=function(){return Ir(arguments,G.gt)},X.random=function(){var p=9007199254740992,b=Math.random()*p&2097151?function(){return i(Math.random()*p)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(S){var U,A,O,D,I,L=0,B=[],P=new X(J);if(S==null?S=rt:N(S,0,T),D=r(S/l),tt)if(crypto.getRandomValues){for(U=crypto.getRandomValues(new Uint32Array(D*=2));L<D;)I=U[L]*131072+(U[L+1]>>>11),I>=9e15?(A=crypto.getRandomValues(new Uint32Array(2)),U[L]=A[0],U[L+1]=A[1]):(B.push(I%1e14),L+=2);L=D/2}else if(crypto.randomBytes){for(U=crypto.randomBytes(D*=7);L<D;)I=(U[L]&31)*281474976710656+U[L+1]*1099511627776+U[L+2]*4294967296+U[L+3]*16777216+(U[L+4]<<16)+(U[L+5]<<8)+U[L+6],I>=9e15?crypto.randomBytes(7).copy(U,L):(B.push(I%1e14),L+=7);L=D/7}else throw tt=!1,Error(o+"crypto unavailable");if(!tt)for(;L<D;)I=b(),I<9e15&&(B[L++]=I%1e14);for(D=B[--L],S%=l,D&&S&&(I=w[l-S],B[L]=i(D/I)*I);B[L]===0;B.pop(),L--);if(L<0)B=[O=0];else{for(O=-1;B[0]===0;B.splice(0,1),O-=l);for(L=1,I=B[0];I>=10;I/=10,L++);L<l&&(O-=l-L)}return P.e=O,P.c=B,P}}(),X.sum=function(){for(var p=1,b=arguments,S=new X(b[0]);p<b.length;)S=S.plus(b[p++]);return S},ot=function(){var p="0123456789";function b(S,U,A,O){for(var D,I=[0],L,B=0,P=S.length;B<P;){for(L=I.length;L--;I[L]*=U);for(I[0]+=O.indexOf(S.charAt(B++)),D=0;D<I.length;D++)I[D]>A-1&&(I[D+1]==null&&(I[D+1]=0),I[D+1]+=I[D]/A|0,I[D]%=A)}return I.reverse()}return function(S,U,A,O,D){var I,L,B,P,Q,g,m,C,H=S.indexOf("."),et=rt,at=ht;for(H>=0&&(P=wt,wt=0,S=S.replace(".",""),C=new X(U),g=C.pow(S.length-H),wt=P,C.c=b(Z(x(g.c),g.e,"0"),10,A,p),C.e=C.c.length),m=b(S,U,A,D?(I=vt,p):(I=p,vt)),B=P=m.length;m[--P]==0;m.pop());if(!m[0])return I.charAt(0);if(H<0?--B:(g.c=m,g.e=B,g.s=O,g=V(g,C,et,at,A),m=g.c,Q=g.r,B=g.e),L=B+et+1,H=m[L],P=A/2,Q=Q||L<0||m[L+1]!=null,Q=at<4?(H!=null||Q)&&(at==0||at==(g.s<0?3:2)):H>P||H==P&&(at==4||Q||at==6&&m[L-1]&1||at==(g.s<0?8:7)),L<1||!m[0])S=Q?Z(I.charAt(1),-et,I.charAt(0)):I.charAt(0);else{if(m.length=L,Q)for(--A;++m[--L]>A;)m[L]=0,L||(++B,m=[1].concat(m));for(P=m.length;!m[--P];);for(H=0,S="";H<=P;S+=I.charAt(m[H++]));S=Z(S,B,I.charAt(0))}return S}}(),V=function(){function p(U,A,O){var D,I,L,B,P=0,Q=U.length,g=A%v,m=A/v|0;for(U=U.slice();Q--;)L=U[Q]%v,B=U[Q]/v|0,D=m*L+B*g,I=g*L+D%v*v+P,P=(I/O|0)+(D/v|0)+m*B,U[Q]=I%O;return P&&(U=[P].concat(U)),U}function b(U,A,O,D){var I,L;if(O!=D)L=O>D?1:-1;else for(I=L=0;I<O;I++)if(U[I]!=A[I]){L=U[I]>A[I]?1:-1;break}return L}function S(U,A,O,D){for(var I=0;O--;)U[O]-=I,I=U[O]<A[O]?1:0,U[O]=I*D+U[O]-A[O];for(;!U[0]&&U.length>1;U.splice(0,1));}return function(U,A,O,D,I){var L,B,P,Q,g,m,C,H,et,at,s,u,f,E,k,M,Y,dt=U.s==A.s?1:-1,St=U.c,ft=A.c;if(!St||!St[0]||!ft||!ft[0])return new X(!U.s||!A.s||(St?ft&&St[0]==ft[0]:!ft)?NaN:St&&St[0]==0||!ft?dt*0:dt/0);for(H=new X(dt),et=H.c=[],B=U.e-A.e,dt=O+B+1,I||(I=c,B=y(U.e/l)-y(A.e/l),dt=dt/l|0),P=0;ft[P]==(St[P]||0);P++);if(ft[P]>(St[P]||0)&&B--,dt<0)et.push(1),Q=!0;else{for(E=St.length,M=ft.length,P=0,dt+=2,g=i(I/(ft[0]+1)),g>1&&(ft=p(ft,g,I),St=p(St,g,I),M=ft.length,E=St.length),f=M,at=St.slice(0,M),s=at.length;s<M;at[s++]=0);Y=ft.slice(),Y=[0].concat(Y),k=ft[0],ft[1]>=I/2&&k++;do{if(g=0,L=b(ft,at,M,s),L<0){if(u=at[0],M!=s&&(u=u*I+(at[1]||0)),g=i(u/k),g>1)for(g>=I&&(g=I-1),m=p(ft,g,I),C=m.length,s=at.length;b(m,at,C,s)==1;)g--,S(m,M<C?Y:ft,C,I),C=m.length,L=1;else g==0&&(L=g=1),m=ft.slice(),C=m.length;if(C<s&&(m=[0].concat(m)),S(at,m,s,I),s=at.length,L==-1)for(;b(ft,at,M,s)<1;)g++,S(at,M<s?Y:ft,s,I),s=at.length}else L===0&&(g++,at=[0]);et[P++]=g,at[0]?at[s++]=St[f]||0:(at=[St[f]],s=1)}while((f++<E||at[0]!=null)&&dt--);Q=at[0]!=null,et[0]||et.splice(0,1)}if(I==c){for(P=1,dt=et[0];dt>=10;dt/=10,P++);Vt(H,O+(H.e=P+B*l-1)+1,D,Q)}else H.e=B,H.r=+Q;return H}}();function sr(p,b,S,U){var A,O,D,I,L;if(S==null?S=ht:N(S,0,8),!p.c)return p.toString();if(A=p.c[0],D=p.e,b==null)L=x(p.c),L=U==1||U==2&&(D<=yt||D>=lt)?z(L,D):Z(L,D,"0");else if(p=Vt(new X(p),b,S),O=p.e,L=x(p.c),I=L.length,U==1||U==2&&(b<=O||O<=yt)){for(;I<b;L+="0",I++);L=z(L,O)}else if(b-=D,L=Z(L,O,"0"),O+1>I){if(--b>0)for(L+=".";b--;L+="0");}else if(b+=O-I,b>0)for(O+1==I&&(L+=".");b--;L+="0");return p.s<0&&A?"-"+L:L}function Ir(p,b){for(var S,U=1,A=new X(p[0]);U<p.length;U++)if(S=new X(p[U]),S.s)b.call(A,S)&&(A=S);else{A=S;break}return A}function cr(p,b,S){for(var U=1,A=b.length;!b[--A];b.pop());for(A=b[0];A>=10;A/=10,U++);return(S=U+S*l-1)>Lt?p.c=p.e=null:S<Nt?p.c=[p.e=0]:(p.e=S,p.c=b),p}nt=function(){var p=/^(-?)0([xbo])(?=\w[\w.]*$)/i,b=/^([^.]+)\.$/,S=/^\.([^.]+)$/,U=/^-?(Infinity|NaN)$/,A=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(O,D,I,L){var B,P=I?D:D.replace(A,"");if(U.test(P))O.s=isNaN(P)?null:P<0?-1:1;else{if(!I&&(P=P.replace(p,function(Q,g,m){return B=(m=m.toLowerCase())=="x"?16:m=="b"?2:8,!L||L==B?g:Q}),L&&(B=L,P=P.replace(b,"$1").replace(S,"0.$1")),D!=P))return new X(P,B);if(X.DEBUG)throw Error(o+"Not a"+(L?" base "+L:"")+" number: "+D);O.s=null}O.c=O.e=null}}();function Vt(p,b,S,U){var A,O,D,I,L,B,P,Q=p.c,g=w;if(Q){t:{for(A=1,I=Q[0];I>=10;I/=10,A++);if(O=b-A,O<0)O+=l,D=b,L=Q[B=0],P=L/g[A-D-1]%10|0;else if(B=r((O+1)/l),B>=Q.length)if(U){for(;Q.length<=B;Q.push(0));L=P=0,A=1,O%=l,D=O-l+1}else break t;else{for(L=I=Q[B],A=1;I>=10;I/=10,A++);O%=l,D=O-l+A,P=D<0?0:L/g[A-D-1]%10|0}if(U=U||b<0||Q[B+1]!=null||(D<0?L:L%g[A-D-1]),U=S<4?(P||U)&&(S==0||S==(p.s<0?3:2)):P>5||P==5&&(S==4||U||S==6&&(O>0?D>0?L/g[A-D]:0:Q[B-1])%10&1||S==(p.s<0?8:7)),b<1||!Q[0])return Q.length=0,U?(b-=p.e+1,Q[0]=g[(l-b%l)%l],p.e=-b||0):Q[0]=p.e=0,p;if(O==0?(Q.length=B,I=1,B--):(Q.length=B+1,I=g[l-O],Q[B]=D>0?i(L/g[A-D]%g[D])*I:0),U)for(;;)if(B==0){for(O=1,D=Q[0];D>=10;D/=10,O++);for(D=Q[0]+=I,I=1;D>=10;D/=10,I++);O!=I&&(p.e++,Q[0]==c&&(Q[0]=1));break}else{if(Q[B]+=I,Q[B]!=c)break;Q[B--]=0,I=1}for(O=Q.length;Q[--O]===0;Q.pop());}p.e>Lt?p.c=p.e=null:p.e<Nt&&(p.c=[p.e=0])}return p}function Mt(p){var b,S=p.e;return S===null?p.toString():(b=x(p.c),b=S<=yt||S>=lt?z(b,S):Z(b,S,"0"),p.s<0?"-"+b:b)}return G.absoluteValue=G.abs=function(){var p=new X(this);return p.s<0&&(p.s=1),p},G.comparedTo=function(p,b){return R(this,new X(p,b))},G.decimalPlaces=G.dp=function(p,b){var S,U,A,O=this;if(p!=null)return N(p,0,T),b==null?b=ht:N(b,0,8),Vt(new X(O),p+O.e+1,b);if(!(S=O.c))return null;if(U=((A=S.length-1)-y(this.e/l))*l,A=S[A])for(;A%10==0;A/=10,U--);return U<0&&(U=0),U},G.dividedBy=G.div=function(p,b){return V(this,new X(p,b),rt,ht)},G.dividedToIntegerBy=G.idiv=function(p,b){return V(this,new X(p,b),0,1)},G.exponentiatedBy=G.pow=function(p,b){var S,U,A,O,D,I,L,B,P,Q=this;if(p=new X(p),p.c&&!p.isInteger())throw Error(o+"Exponent not an integer: "+Mt(p));if(b!=null&&(b=new X(b)),I=p.e>14,!Q.c||!Q.c[0]||Q.c[0]==1&&!Q.e&&Q.c.length==1||!p.c||!p.c[0])return P=new X(Math.pow(+Mt(Q),I?p.s*(2-j(p)):+Mt(p))),b?P.mod(b):P;if(L=p.s<0,b){if(b.c?!b.c[0]:!b.s)return new X(NaN);U=!L&&Q.isInteger()&&b.isInteger(),U&&(Q=Q.mod(b))}else{if(p.e>9&&(Q.e>0||Q.e<-1||(Q.e==0?Q.c[0]>1||I&&Q.c[1]>=24e7:Q.c[0]<8e13||I&&Q.c[0]<=9999975e7)))return O=Q.s<0&&j(p)?-0:0,Q.e>-1&&(O=1/O),new X(L?1/O:O);wt&&(O=r(wt/l+2))}for(I?(S=new X(.5),L&&(p.s=1),B=j(p)):(A=Math.abs(+Mt(p)),B=A%2),P=new X(J);;){if(B){if(P=P.times(Q),!P.c)break;O?P.c.length>O&&(P.c.length=O):U&&(P=P.mod(b))}if(A){if(A=i(A/2),A===0)break;B=A%2}else if(p=p.times(S),Vt(p,p.e+1,1),p.e>14)B=j(p);else{if(A=+Mt(p),A===0)break;B=A%2}Q=Q.times(Q),O?Q.c&&Q.c.length>O&&(Q.c.length=O):U&&(Q=Q.mod(b))}return U?P:(L&&(P=J.div(P)),b?P.mod(b):O?Vt(P,wt,ht,D):P)},G.integerValue=function(p){var b=new X(this);return p==null?p=ht:N(p,0,8),Vt(b,b.e+1,p)},G.isEqualTo=G.eq=function(p,b){return R(this,new X(p,b))===0},G.isFinite=function(){return!!this.c},G.isGreaterThan=G.gt=function(p,b){return R(this,new X(p,b))>0},G.isGreaterThanOrEqualTo=G.gte=function(p,b){return(b=R(this,new X(p,b)))===1||b===0},G.isInteger=function(){return!!this.c&&y(this.e/l)>this.c.length-2},G.isLessThan=G.lt=function(p,b){return R(this,new X(p,b))<0},G.isLessThanOrEqualTo=G.lte=function(p,b){return(b=R(this,new X(p,b)))===-1||b===0},G.isNaN=function(){return!this.s},G.isNegative=function(){return this.s<0},G.isPositive=function(){return this.s>0},G.isZero=function(){return!!this.c&&this.c[0]==0},G.minus=function(p,b){var S,U,A,O,D=this,I=D.s;if(p=new X(p,b),b=p.s,!I||!b)return new X(NaN);if(I!=b)return p.s=-b,D.plus(p);var L=D.e/l,B=p.e/l,P=D.c,Q=p.c;if(!L||!B){if(!P||!Q)return P?(p.s=-b,p):new X(Q?D:NaN);if(!P[0]||!Q[0])return Q[0]?(p.s=-b,p):new X(P[0]?D:ht==3?-0:0)}if(L=y(L),B=y(B),P=P.slice(),I=L-B){for((O=I<0)?(I=-I,A=P):(B=L,A=Q),A.reverse(),b=I;b--;A.push(0));A.reverse()}else for(U=(O=(I=P.length)<(b=Q.length))?I:b,I=b=0;b<U;b++)if(P[b]!=Q[b]){O=P[b]<Q[b];break}if(O&&(A=P,P=Q,Q=A,p.s=-p.s),b=(U=Q.length)-(S=P.length),b>0)for(;b--;P[S++]=0);for(b=c-1;U>I;){if(P[--U]<Q[U]){for(S=U;S&&!P[--S];P[S]=b);--P[S],P[U]+=c}P[U]-=Q[U]}for(;P[0]==0;P.splice(0,1),--B);return P[0]?cr(p,P,B):(p.s=ht==3?-1:1,p.c=[p.e=0],p)},G.modulo=G.mod=function(p,b){var S,U,A=this;return p=new X(p,b),!A.c||!p.s||p.c&&!p.c[0]?new X(NaN):!p.c||A.c&&!A.c[0]?new X(A):(Kt==9?(U=p.s,p.s=1,S=V(A,p,0,3),p.s=U,S.s*=U):S=V(A,p,0,Kt),p=A.minus(S.times(p)),!p.c[0]&&Kt==1&&(p.s=A.s),p)},G.multipliedBy=G.times=function(p,b){var S,U,A,O,D,I,L,B,P,Q,g,m,C,H,et,at=this,s=at.c,u=(p=new X(p,b)).c;if(!s||!u||!s[0]||!u[0])return!at.s||!p.s||s&&!s[0]&&!u||u&&!u[0]&&!s?p.c=p.e=p.s=null:(p.s*=at.s,!s||!u?p.c=p.e=null:(p.c=[0],p.e=0)),p;for(U=y(at.e/l)+y(p.e/l),p.s*=at.s,L=s.length,Q=u.length,L<Q&&(C=s,s=u,u=C,A=L,L=Q,Q=A),A=L+Q,C=[];A--;C.push(0));for(H=c,et=v,A=Q;--A>=0;){for(S=0,g=u[A]%et,m=u[A]/et|0,D=L,O=A+D;O>A;)B=s[--D]%et,P=s[D]/et|0,I=m*B+P*g,B=g*B+I%et*et+C[O]+S,S=(B/H|0)+(I/et|0)+m*P,C[O--]=B%H;C[O]=S}return S?++U:C.splice(0,1),cr(p,C,U)},G.negated=function(){var p=new X(this);return p.s=-p.s||null,p},G.plus=function(p,b){var S,U=this,A=U.s;if(p=new X(p,b),b=p.s,!A||!b)return new X(NaN);if(A!=b)return p.s=-b,U.minus(p);var O=U.e/l,D=p.e/l,I=U.c,L=p.c;if(!O||!D){if(!I||!L)return new X(A/0);if(!I[0]||!L[0])return L[0]?p:new X(I[0]?U:A*0)}if(O=y(O),D=y(D),I=I.slice(),A=O-D){for(A>0?(D=O,S=L):(A=-A,S=I),S.reverse();A--;S.push(0));S.reverse()}for(A=I.length,b=L.length,A-b<0&&(S=L,L=I,I=S,b=A),A=0;b;)A=(I[--b]=I[b]+L[b]+A)/c|0,I[b]=c===I[b]?0:I[b]%c;return A&&(I=[A].concat(I),++D),cr(p,I,D)},G.precision=G.sd=function(p,b){var S,U,A,O=this;if(p!=null&&p!==!!p)return N(p,1,T),b==null?b=ht:N(b,0,8),Vt(new X(O),p,b);if(!(S=O.c))return null;if(A=S.length-1,U=A*l+1,A=S[A]){for(;A%10==0;A/=10,U--);for(A=S[0];A>=10;A/=10,U++);}return p&&O.e+1>U&&(U=O.e+1),U},G.shiftedBy=function(p){return N(p,-h,h),this.times("1e"+p)},G.squareRoot=G.sqrt=function(){var p,b,S,U,A,O=this,D=O.c,I=O.s,L=O.e,B=rt+4,P=new X("0.5");if(I!==1||!D||!D[0])return new X(!I||I<0&&(!D||D[0])?NaN:D?O:1/0);if(I=Math.sqrt(+Mt(O)),I==0||I==1/0?(b=x(D),(b.length+L)%2==0&&(b+="0"),I=Math.sqrt(+b),L=y((L+1)/2)-(L<0||L%2),I==1/0?b="5e"+L:(b=I.toExponential(),b=b.slice(0,b.indexOf("e")+1)+L),S=new X(b)):S=new X(I+""),S.c[0]){for(L=S.e,I=L+B,I<3&&(I=0);;)if(A=S,S=P.times(A.plus(V(O,A,B,1))),x(A.c).slice(0,I)===(b=x(S.c)).slice(0,I))if(S.e<L&&--I,b=b.slice(I-3,I+1),b=="9999"||!U&&b=="4999"){if(!U&&(Vt(A,A.e+rt+2,0),A.times(A).eq(O))){S=A;break}B+=4,I+=4,U=1}else{(!+b||!+b.slice(1)&&b.charAt(0)=="5")&&(Vt(S,S.e+rt+2,1),p=!S.times(S).eq(O));break}}return Vt(S,S.e+rt+1,ht,p)},G.toExponential=function(p,b){return p!=null&&(N(p,0,T),p++),sr(this,p,b,1)},G.toFixed=function(p,b){return p!=null&&(N(p,0,T),p=p+this.e+1),sr(this,p,b)},G.toFormat=function(p,b,S){var U,A=this;if(S==null)p!=null&&b&&typeof b=="object"?(S=b,b=null):p&&typeof p=="object"?(S=p,p=b=null):S=ee;else if(typeof S!="object")throw Error(o+"Argument not an object: "+S);if(U=A.toFixed(p,b),A.c){var O,D=U.split("."),I=+S.groupSize,L=+S.secondaryGroupSize,B=S.groupSeparator||"",P=D[0],Q=D[1],g=A.s<0,m=g?P.slice(1):P,C=m.length;if(L&&(O=I,I=L,L=O,C-=O),I>0&&C>0){for(O=C%I||I,P=m.substr(0,O);O<C;O+=I)P+=B+m.substr(O,I);L>0&&(P+=B+m.slice(O)),g&&(P="-"+P)}U=Q?P+(S.decimalSeparator||"")+((L=+S.fractionGroupSize)?Q.replace(new RegExp("\\d{"+L+"}\\B","g"),"$&"+(S.fractionGroupSeparator||"")):Q):P}return(S.prefix||"")+U+(S.suffix||"")},G.toFraction=function(p){var b,S,U,A,O,D,I,L,B,P,Q,g,m=this,C=m.c;if(p!=null&&(I=new X(p),!I.isInteger()&&(I.c||I.s!==1)||I.lt(J)))throw Error(o+"Argument "+(I.isInteger()?"out of range: ":"not an integer: ")+Mt(I));if(!C)return new X(m);for(b=new X(J),B=S=new X(J),U=L=new X(J),g=x(C),O=b.e=g.length-m.e-1,b.c[0]=w[(D=O%l)<0?l+D:D],p=!p||I.comparedTo(b)>0?O>0?b:B:I,D=Lt,Lt=1/0,I=new X(g),L.c[0]=0;P=V(I,b,0,1),A=S.plus(P.times(U)),A.comparedTo(p)!=1;)S=U,U=A,B=L.plus(P.times(A=B)),L=A,b=I.minus(P.times(A=b)),I=A;return A=V(p.minus(S),U,0,1),L=L.plus(A.times(B)),S=S.plus(A.times(U)),L.s=B.s=m.s,O=O*2,Q=V(B,U,O,ht).minus(m).abs().comparedTo(V(L,S,O,ht).minus(m).abs())<1?[B,U]:[L,S],Lt=D,Q},G.toNumber=function(){return+Mt(this)},G.toPrecision=function(p,b){return p!=null&&N(p,1,T),sr(this,p,b,2)},G.toString=function(p){var b,S=this,U=S.s,A=S.e;return A===null?U?(b="Infinity",U<0&&(b="-"+b)):b="NaN":(p==null?b=A<=yt||A>=lt?z(x(S.c),A):Z(x(S.c),A,"0"):p===10&&At?(S=Vt(new X(S),rt+A+1,ht),b=Z(x(S.c),S.e,"0")):(N(p,2,vt.length,"Base"),b=ot(Z(x(S.c),A,"0"),10,p,U,!0)),U<0&&S.c[0]&&(b="-"+b)),b},G.valueOf=G.toJSON=function(){return Mt(this)},G._isBigNumber=!0,W!=null&&X.set(W),X}function y(W){var V=W|0;return W>0||W===V?V:V-1}function x(W){for(var V,ot,nt=1,G=W.length,J=W[0]+"";nt<G;){for(V=W[nt++]+"",ot=l-V.length;ot--;V="0"+V);J+=V}for(G=J.length;J.charCodeAt(--G)===48;);return J.slice(0,G+1||1)}function R(W,V){var ot,nt,G=W.c,J=V.c,rt=W.s,ht=V.s,yt=W.e,lt=V.e;if(!rt||!ht)return null;if(ot=G&&!G[0],nt=J&&!J[0],ot||nt)return ot?nt?0:-ht:rt;if(rt!=ht)return rt;if(ot=rt<0,nt=yt==lt,!G||!J)return nt?0:!G^ot?1:-1;if(!nt)return yt>lt^ot?1:-1;for(ht=(yt=G.length)<(lt=J.length)?yt:lt,rt=0;rt<ht;rt++)if(G[rt]!=J[rt])return G[rt]>J[rt]^ot?1:-1;return yt==lt?0:yt>lt^ot?1:-1}function N(W,V,ot,nt){if(W<V||W>ot||W!==i(W))throw Error(o+(nt||"Argument")+(typeof W=="number"?W<V||W>ot?" out of range: ":" not an integer: ":" not a primitive number: ")+String(W))}function j(W){var V=W.c.length-1;return y(W.e/l)==V&&W.c[V]%2!=0}function z(W,V){return(W.length>1?W.charAt(0)+"."+W.slice(1):W)+(V<0?"e":"e+")+V}function Z(W,V,ot){var nt,G;if(V<0){for(G=ot+".";++V;G+=ot);W=G+W}else if(nt=W.length,++V>nt){for(G=ot,V-=nt;--V;G+=ot);W+=G}else V<nt&&(W=W.slice(0,V)+"."+W.slice(V));return W}t=d(),t.default=t.BigNumber=t,typeof define=="function"&&define.amd?define(function(){return t}):typeof $o<"u"&&$o.exports?$o.exports=t:(n||(n=typeof self<"u"&&self?self:window),n.BigNumber=t)})(ef)});var sf=it(Vs=>{"use strict";_();Object.defineProperty(Vs,"__esModule",{value:!0});var Cp=Os(),Ks=class{BigNum;constructor(){this.BigNum=(t,e)=>{let r=Cp.BigNumber.clone({DECIMAL_PLACES:e});return new r(t)}}winstonToAr(t,{formatted:e=!1,decimals:r=12,trim:i=!0}={}){let o=this.stringToBigNum(t,r).shiftedBy(-12);return e?o.toFormat(r):o.toFixed(r)}arToWinston(t,{formatted:e=!1}={}){let r=this.stringToBigNum(t).shiftedBy(12);return e?r.toFormat():r.toFixed(0)}compare(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.comparedTo(i)}isEqual(t,e){return this.compare(t,e)===0}isLessThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isLessThan(i)}isGreaterThan(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.isGreaterThan(i)}add(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.plus(e).toFixed(0)}sub(t,e){let r=this.stringToBigNum(t),i=this.stringToBigNum(e);return r.minus(e).toFixed(0)}stringToBigNum(t,e=12){return this.BigNum(t,e)}};Vs.default=Ks});var cf=it(qs=>{"use strict";_();Object.defineProperty(qs,"__esModule",{value:!0});var Gs=class{METHOD_GET="GET";METHOD_POST="POST";config;constructor(t){this.applyConfig(t)}applyConfig(t){this.config=this.mergeDefaults(t)}getConfig(){return this.config}mergeDefaults(t){let e=t.protocol||"http",r=t.port||(e==="https"?443:80);return{host:t.host||"127.0.0.1",protocol:e,port:r,timeout:t.timeout||2e4,logging:t.logging||!1,logger:t.logger||console.log,network:t.network}}async get(t,e){return await this.request(t,{...e,method:this.METHOD_GET})}async post(t,e,r){let i=new Headers(r?.headers||{});return i.get("content-type")?.includes("application/json")||i.append("content-type","application/json"),i.append("accept","application/json, text/plain, */*"),await this.request(t,{...r,method:this.METHOD_POST,body:typeof e!="string"?JSON.stringify(e):e,headers:i})}async request(t,e){let r=new Headers(e?.headers||{}),i=`${this.config.protocol}://${this.config.host}:${this.config.port}`,o=e?.responseType;delete e?.responseType,t.startsWith("/")&&(t=t.slice(1)),this.config.network&&r.append("x-network",this.config.network),this.config.logging&&this.config.logger(`Requesting: ${i}/${t}`);let a=await fetch(`${i}/${t}`,{...e||{},headers:r});this.config.logging&&this.config.logger(`Response:   ${a.url} - ${a.status}`);let l=a.headers.get("content-type")?.match(/charset=([^()<>@,;:\"/[\]?.=\s]*)/i)?.[1],h=a,w=async()=>{if(l)try{h.data=new TextDecoder(l).decode(await a.arrayBuffer())}catch{h.data=await a.text()}else h.data=await a.text()};if(o==="arraybuffer")h.data=await a.arrayBuffer();else if(o==="text")await w();else if(o==="webstream")h.data=Ip(a.body);else try{let v=await a.clone().json();typeof v!="object"?await w():h.data=await a.json(),v=null}catch{await w()}return h}};qs.default=Gs;var Ip=n=>{let t=n;return typeof t[Symbol.asyncIterator]>"u"?(t[Symbol.asyncIterator]=Ap(n),t):n},Ap=function(n){return async function*(){let e=n.getReader();try{for(;;){let{done:r,value:i}=await e.read();if(r)return;yield i}}finally{e.releaseLock()}}}});var Ce=it(Rt=>{"use strict";_();Object.defineProperty(Rt,"__esModule",{value:!0});Rt.b64UrlDecode=Rt.b64UrlEncode=Rt.bufferTob64Url=Rt.bufferTob64=Rt.b64UrlToBuffer=Rt.stringToB64Url=Rt.stringToBuffer=Rt.bufferToString=Rt.b64UrlToString=Rt.concatBuffers=void 0;var uf=wa();function Lp(n){let t=0;for(let i=0;i<n.length;i++)t+=n[i].byteLength;let e=new Uint8Array(t),r=0;e.set(new Uint8Array(n[0]),r),r+=n[0].byteLength;for(let i=1;i<n.length;i++)e.set(new Uint8Array(n[i]),r),r+=n[i].byteLength;return e}Rt.concatBuffers=Lp;function kp(n){let t=hf(n);return lf(t)}Rt.b64UrlToString=kp;function lf(n){return new TextDecoder("utf-8",{fatal:!0}).decode(n)}Rt.bufferToString=lf;function ff(n){return new TextEncoder().encode(n)}Rt.stringToBuffer=ff;function Rp(n){return df(ff(n))}Rt.stringToB64Url=Rp;function hf(n){return new Uint8Array(uf.toByteArray(mf(n)))}Rt.b64UrlToBuffer=hf;function gf(n){return uf.fromByteArray(new Uint8Array(n))}Rt.bufferTob64=gf;function df(n){return pf(gf(n))}Rt.bufferTob64Url=df;function pf(n){return n.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}Rt.b64UrlEncode=pf;function mf(n){n=n.replace(/\-/g,"+").replace(/\_/g,"/");let t;return n.length%4==0?t=0:t=4-n.length%4,n.concat("=".repeat(t))}Rt.b64UrlDecode=mf});var yf=it(Hs=>{"use strict";_();Object.defineProperty(Hs,"__esModule",{value:!0});var Sr=Ce(),js=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let t=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),e=await this.driver.exportKey("jwk",t.privateKey);return{kty:e.kty,e:e.e,n:e.n,d:e.d,p:e.p,q:e.q,dp:e.dp,dq:e.dq,qi:e.qi}}async sign(t,e,{saltLength:r}={}){let i=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(t),e);return new Uint8Array(i)}async hash(t,e="SHA-256"){let r=await this.driver.digest(e,t);return new Uint8Array(r)}async verify(t,e,r){let i={kty:"RSA",e:"AQAB",n:t},o=await this.jwkToPublicCryptoKey(i),a=await this.driver.digest("SHA-256",e),c=await this.driver.verify({name:"RSA-PSS",saltLength:0},o,r,e),l=await this.driver.verify({name:"RSA-PSS",saltLength:32},o,r,e),h=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((o.algorithm.modulusLength-1)/8)-a.byteLength-2},o,r,e);return c||l||h}async jwkToCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(t){return this.driver.importKey("jwk",t,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let t=crypto?.subtle;return t===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(r=>typeof t[r]=="function")}async encrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?Sr.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?Sr.stringToBuffer(r):Sr.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=new Uint8Array(16);crypto.getRandomValues(a);let c=await this.driver.encrypt({name:"AES-CBC",iv:a},o,t);return Sr.concatBuffers([a,c])}async decrypt(t,e,r){let i=await this.driver.importKey("raw",typeof e=="string"?Sr.stringToBuffer(e):e,{name:"PBKDF2",length:32},!1,["deriveKey"]),o=await this.driver.deriveKey({name:"PBKDF2",salt:r?Sr.stringToBuffer(r):Sr.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},i,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),a=t.slice(0,16),c=await this.driver.decrypt({name:"AES-CBC",iv:a},o,t.slice(16));return Sr.concatBuffers([c])}};Hs.default=js});var wf=it(zs=>{"use strict";_();Object.defineProperty(zs,"__esModule",{value:!0});var Qs=class{api;constructor(t){this.api=t}getInfo(){return this.api.get("info").then(t=>t.data)}getPeers(){return this.api.get("peers").then(t=>t.data)}};zs.default=Qs});var wi=it(yi=>{"use strict";_();Object.defineProperty(yi,"__esModule",{value:!0});yi.getError=void 0;var Ys=class extends Error{type;response;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.response=e.response}getType(){return this.type}};yi.default=Ys;function Op(n){let t=n.data;if(typeof n.data=="string")try{t=JSON.parse(n.data)}catch{}if(n.data instanceof ArrayBuffer||n.data instanceof Uint8Array)try{t=JSON.parse(t.toString())}catch{}return t?t.error||t:n.statusText||"unknown"}yi.getError=Op});var _f=it(Js=>{"use strict";_();Object.defineProperty(Js,"__esModule",{value:!0});var ge=vi();async function vf(n){if(Array.isArray(n)){let r=ge.default.utils.concatBuffers([ge.default.utils.stringToBuffer("list"),ge.default.utils.stringToBuffer(n.length.toString())]);return await bf(n,await ge.default.crypto.hash(r,"SHA-384"))}let t=ge.default.utils.concatBuffers([ge.default.utils.stringToBuffer("blob"),ge.default.utils.stringToBuffer(n.byteLength.toString())]),e=ge.default.utils.concatBuffers([await ge.default.crypto.hash(t,"SHA-384"),await ge.default.crypto.hash(n,"SHA-384")]);return await ge.default.crypto.hash(e,"SHA-384")}Js.default=vf;async function bf(n,t){if(n.length<1)return t;let e=ge.default.utils.concatBuffers([t,await vf(n[0])]),r=await ge.default.crypto.hash(e,"SHA-384");return await bf(n.slice(1),r)}});var nc=it(pt=>{"use strict";_();Object.defineProperty(pt,"__esModule",{value:!0});pt.debug=pt.validatePath=pt.arrayCompare=pt.bufferToInt=pt.intToBuffer=pt.arrayFlatten=pt.generateProofs=pt.buildLayers=pt.generateTransactionChunks=pt.generateTree=pt.computeRootHash=pt.generateLeaves=pt.chunkData=pt.MIN_CHUNK_SIZE=pt.MAX_CHUNK_SIZE=void 0;var Vo=vi(),Sf=Ce();pt.MAX_CHUNK_SIZE=256*1024;pt.MIN_CHUNK_SIZE=32*1024;var _i=32,Cn=32;async function Zs(n){let t=[],e=n,r=0;for(;e.byteLength>=pt.MAX_CHUNK_SIZE;){let i=pt.MAX_CHUNK_SIZE,o=e.byteLength-pt.MAX_CHUNK_SIZE;o>0&&o<pt.MIN_CHUNK_SIZE&&(i=Math.ceil(e.byteLength/2));let a=e.slice(0,i),c=await Vo.default.crypto.hash(a);r+=a.byteLength,t.push({dataHash:c,minByteRange:r-a.byteLength,maxByteRange:r}),e=e.slice(i)}return t.push({dataHash:await Vo.default.crypto.hash(e),minByteRange:r,maxByteRange:r+e.byteLength}),t}pt.chunkData=Zs;async function tc(n){return Promise.all(n.map(async({dataHash:t,minByteRange:e,maxByteRange:r})=>({type:"leaf",id:await $t(await Promise.all([$t(t),$t(Si(r))])),dataHash:t,minByteRange:e,maxByteRange:r})))}pt.generateLeaves=tc;async function Bp(n){return(await Ef(n)).id}pt.computeRootHash=Bp;async function Ef(n){return await Go(await tc(await Zs(n)))}pt.generateTree=Ef;async function Pp(n){let t=await Zs(n),e=await tc(t),r=await Go(e),i=await Tf(r),o=t.slice(-1)[0];return o.maxByteRange-o.minByteRange===0&&(t.splice(t.length-1,1),i.splice(i.length-1,1)),{data_root:r.id,chunks:t,proofs:i}}pt.generateTransactionChunks=Pp;async function Go(n,t=0){if(n.length<2)return n[0];let e=[];for(let r=0;r<n.length;r+=2)e.push(await Np(n[r],n[r+1]));return Go(e,t+1)}pt.buildLayers=Go;function Tf(n){let t=Xs(n);return Array.isArray(t)?ec(t):[t]}pt.generateProofs=Tf;function Xs(n,t=new Uint8Array,e=0){if(n.type=="leaf")return{offset:n.maxByteRange-1,proof:(0,Sf.concatBuffers)([t,n.dataHash,Si(n.maxByteRange)])};if(n.type=="branch"){let r=(0,Sf.concatBuffers)([t,n.leftChild.id,n.rightChild.id,Si(n.byteRange)]);return[Xs(n.leftChild,r,e+1),Xs(n.rightChild,r,e+1)]}throw new Error("Unexpected node type")}function ec(n){let t=[];return n.forEach(e=>{Array.isArray(e)?t.push(...ec(e)):t.push(e)}),t}pt.arrayFlatten=ec;async function Np(n,t){return t?{type:"branch",id:await $t([await $t(n.id),await $t(t.id),await $t(Si(n.maxByteRange))]),byteRange:n.maxByteRange,maxByteRange:t.maxByteRange,leftChild:n,rightChild:t}:n}async function $t(n){return Array.isArray(n)&&(n=Vo.default.utils.concatBuffers(n)),new Uint8Array(await Vo.default.crypto.hash(n))}function Si(n){let t=new Uint8Array(_i);for(var e=t.length-1;e>=0;e--){var r=n%256;t[e]=r,n=(n-r)/256}return t}pt.intToBuffer=Si;function rc(n){let t=0;for(var e=0;e<n.length;e++)t*=256,t+=n[e];return t}pt.bufferToInt=rc;var Up=(n,t)=>n.every((e,r)=>t[r]===e);pt.arrayCompare=Up;async function bi(n,t,e,r,i){if(r<=0)return!1;if(t>=r)return bi(n,0,r-1,r,i);if(t<0)return bi(n,0,0,r,i);if(i.length==Cn+_i){let v=i.slice(0,Cn),T=i.slice(v.length,v.length+_i),d=await $t([await $t(v),await $t(T)]);return(0,pt.arrayCompare)(n,d)?{offset:r-1,leftBound:e,rightBound:r,chunkSize:r-e}:!1}let o=i.slice(0,Cn),a=i.slice(o.length,o.length+Cn),c=i.slice(o.length+a.length,o.length+a.length+_i),l=rc(c),h=i.slice(o.length+a.length+c.length),w=await $t([await $t(o),await $t(a),await $t(c)]);return(0,pt.arrayCompare)(n,w)?t<l?await bi(o,t,e,Math.min(r,l),h):await bi(a,t,Math.max(e,l),r,h):!1}pt.validatePath=bi;async function xf(n,t=""){if(n.byteLength<1)return t;let e=n.slice(0,Cn),r=n.slice(e.length,e.length+Cn),i=n.slice(e.length+r.length,e.length+r.length+_i),o=rc(i),a=n.slice(e.length+r.length+i.length),c=await $t([await $t(e),await $t(r),await $t(i)]),l=`${t}
${JSON.stringify(F.Buffer.from(e))},${JSON.stringify(F.Buffer.from(r))},${o} => ${JSON.stringify(c)}`;return xf(a,l)}pt.debug=xf});var jo=it(Ti=>{"use strict";_();Object.defineProperty(Ti,"__esModule",{value:!0});Ti.Tag=void 0;var Wt=Ce(),Wp=_f(),Dp=nc(),qo=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);if(this[t]instanceof Uint8Array)return e&&e.decode&&e.string?Wt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Wt.bufferTob64Url(this[t]);if(this[t]instanceof Array){if(e?.decode!==void 0||e?.string!==void 0)throw t==="tags"&&console.warn(`Did you mean to use 'transaction["tags"]' ?`),new Error("Cannot decode or stringify an array.");return this[t]}return e&&e.decode==!0?e&&e.string?Wt.b64UrlToString(this[t]):Wt.b64UrlToBuffer(this[t]):this[t]}},Ei=class extends qo{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};Ti.Tag=Ei;var ic=class extends qo{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Wt.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new Ei(e.name,e.value)))}addTag(t,e){this.tags.push(new Ei(Wt.stringToB64Url(t),Wt.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Wt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){!this.chunks&&t.byteLength>0&&(this.chunks=await(0,Dp.generateTransactionChunks)(t),this.data_root=Wt.bufferTob64Url(this.chunks.data_root)),!this.chunks&&t.byteLength===0&&(this.chunks={chunks:[],data_root:new Uint8Array,proofs:[]},this.data_root="")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Wt.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Wt.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){switch(this.format){case 1:let t=this.tags.reduce((r,i)=>Wt.concatBuffers([r,i.get("name",{decode:!0,string:!1}),i.get("value",{decode:!0,string:!1})]),new Uint8Array);return Wt.concatBuffers([this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),this.get("data",{decode:!0,string:!1}),Wt.stringToBuffer(this.quantity),Wt.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),t]);case 2:this.data_root||await this.prepareChunks(this.data);let e=this.tags.map(r=>[r.get("name",{decode:!0,string:!1}),r.get("value",{decode:!0,string:!1})]);return await(0,Wp.default)([Wt.stringToBuffer(this.format.toString()),this.get("owner",{decode:!0,string:!1}),this.get("target",{decode:!0,string:!1}),Wt.stringToBuffer(this.quantity),Wt.stringToBuffer(this.reward),this.get("last_tx",{decode:!0,string:!1}),e,Wt.stringToBuffer(this.data_size),this.get("data_root",{decode:!0,string:!1})]);default:throw new Error(`Unexpected transaction format: ${this.format}`)}}};Ti.default=ic});var Lf=it(Ho=>{"use strict";_();Object.defineProperty(Ho,"__esModule",{value:!0});Ho.TransactionUploader=void 0;var Cf=jo(),Mp=Ce(),oc=wi(),Fp=nc(),If=1,$p=["invalid_json","chunk_too_big","data_path_too_big","offset_too_big","data_size_too_big","chunk_proof_ratio_not_attractive","invalid_proof"],Af=1e3*40,xi=class{api;chunkIndex=0;txPosted=!1;transaction;lastRequestTimeEnd=0;totalErrors=0;data;lastResponseStatus=0;lastResponseError="";get isComplete(){return this.txPosted&&this.chunkIndex===this.transaction.chunks.chunks.length}get totalChunks(){return this.transaction.chunks.chunks.length}get uploadedChunks(){return this.chunkIndex}get pctComplete(){return Math.trunc(this.uploadedChunks/this.totalChunks*100)}constructor(t,e){if(this.api=t,!e.id)throw new Error("Transaction is not signed");if(!e.chunks)throw new Error("Transaction chunks not prepared");this.data=e.data,this.transaction=new Cf.default(Object.assign({},e,{data:new Uint8Array(0)}))}async uploadChunk(t){if(this.isComplete)throw new Error("Upload is already complete");if(this.lastResponseError!==""?this.totalErrors++:this.totalErrors=0,this.totalErrors===100)throw new Error(`Unable to complete upload: ${this.lastResponseStatus}: ${this.lastResponseError}`);let e=this.lastResponseError===""?0:Math.max(this.lastRequestTimeEnd+Af-Date.now(),Af);if(e>0&&(e=e-e*Math.random()*.3,await new Promise(a=>setTimeout(a,e))),this.lastResponseError="",!this.txPosted){await this.postTransaction();return}t&&(this.chunkIndex=t);let r=this.transaction.getChunk(t||this.chunkIndex,this.data);if(!await(0,Fp.validatePath)(this.transaction.chunks.data_root,parseInt(r.offset),0,parseInt(r.data_size),Mp.b64UrlToBuffer(r.data_path)))throw new Error(`Unable to validate chunk ${this.chunkIndex}`);let o=await this.api.post("chunk",this.transaction.getChunk(this.chunkIndex,this.data)).catch(a=>(console.error(a.message),{status:-1,data:{error:a.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=o.status,this.lastResponseStatus==200)this.chunkIndex++;else if(this.lastResponseError=(0,oc.getError)(o),$p.includes(this.lastResponseError))throw new Error(`Fatal error uploading chunk ${this.chunkIndex}: ${this.lastResponseError}`)}static async fromSerialized(t,e,r){if(!e||typeof e.chunkIndex!="number"||typeof e.transaction!="object")throw new Error("Serialized object does not match expected format.");var i=new Cf.default(e.transaction);i.chunks||await i.prepareChunks(r);let o=new xi(t,i);if(o.chunkIndex=e.chunkIndex,o.lastRequestTimeEnd=e.lastRequestTimeEnd,o.lastResponseError=e.lastResponseError,o.lastResponseStatus=e.lastResponseStatus,o.txPosted=e.txPosted,o.data=r,o.transaction.data_root!==e.transaction.data_root)throw new Error("Data mismatch: Uploader doesn't match provided data.");return o}static async fromTransactionId(t,e){let r=await t.get(`tx/${e}`);if(r.status!==200)throw new Error(`Tx ${e} not found: ${r.status}`);let i=r.data;return i.data=new Uint8Array(0),{txPosted:!0,chunkIndex:0,lastResponseError:"",lastRequestTimeEnd:0,lastResponseStatus:0,transaction:i}}toJSON(){return{chunkIndex:this.chunkIndex,transaction:this.transaction,lastRequestTimeEnd:this.lastRequestTimeEnd,lastResponseStatus:this.lastResponseStatus,lastResponseError:this.lastResponseError,txPosted:this.txPosted}}async postTransaction(){if(this.totalChunks<=If){this.transaction.data=this.data;let r=await this.api.post("tx",this.transaction).catch(i=>(console.error(i),{status:-1,data:{error:i.message}}));if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=r.status,this.transaction.data=new Uint8Array(0),r.status>=200&&r.status<300){this.txPosted=!0,this.chunkIndex=If;return}throw this.lastResponseError=(0,oc.getError)(r),new Error(`Unable to upload transaction: ${r.status}, ${this.lastResponseError}`)}let e=await this.api.post("tx",this.transaction);if(this.lastRequestTimeEnd=Date.now(),this.lastResponseStatus=e.status,!(e.status>=200&&e.status<300))throw this.lastResponseError=(0,oc.getError)(e),new Error(`Unable to upload transaction: ${e.status}, ${this.lastResponseError}`);this.txPosted=!0}};Ho.TransactionUploader=xi});var Qo=it((rb,kf)=>{_();kf.exports={}});var Rf=it(uc=>{"use strict";_();Object.defineProperty(uc,"__esModule",{value:!0});var ac=wi(),rr=jo(),Ci=Ce(),sc=Lf();Qo();var cc=class{api;crypto;chunks;constructor(t,e,r){this.api=t,this.crypto=e,this.chunks=r}async getTransactionAnchor(){let t=await this.api.get("tx_anchor");if(!t.data.match(/^[a-z0-9_-]{43,}/i)||!t.ok)throw new Error(`Could not getTransactionAnchor. Received: ${t.data}. Status: ${t.status}, ${t.statusText}`);return t.data}async getPrice(t,e){let r=e?`price/${t}/${e}`:`price/${t}`,i=await this.api.get(r);if(!/^\d+$/.test(i.data)||!i.ok)throw new Error(`Could not getPrice. Received: ${i.data}. Status: ${i.status}, ${i.statusText}`);return i.data}async get(t){let e=await this.api.get(`tx/${t}`);if(e.status==200){let r=parseInt(e.data.data_size);if(e.data.format>=2&&r>0&&r<=1024*1024*12){let i=await this.getData(t);return new rr.default({...e.data,data:i})}return new rr.default({...e.data,format:e.data.format||1})}throw e.status==404?new ac.default("TX_NOT_FOUND"):e.status==410?new ac.default("TX_FAILED"):new ac.default("TX_INVALID")}fromRaw(t){return new rr.default(t)}async search(t,e){return this.api.post("arql",{op:"equals",expr1:t,expr2:e}).then(r=>r.data?r.data:[])}getStatus(t){return this.api.get(`tx/${t}/status`).then(e=>e.status==200?{status:200,confirmed:e.data}:{status:e.status,confirmed:null})}async getData(t,e){let r;try{r=await this.chunks.downloadChunkedData(t)}catch(i){console.error(`Error while trying to download chunked data for ${t}`),console.error(i)}if(!r){console.warn(`Falling back to gateway cache for ${t}`);try{let{data:i,ok:o,status:a,statusText:c}=await this.api.get(`/${t}`,{responseType:"arraybuffer"});if(!o)throw new Error("Bad http status code",{cause:{status:a,statusText:c}});r=i}catch(i){console.error(`Error while trying to download contiguous data from gateway cache for ${t}`),console.error(i)}}if(!r)throw new Error(`${t} data was not found!`);return e&&e.decode&&!e.string?r:e&&e.decode&&e.string?Ci.bufferToString(r):Ci.bufferTob64Url(r)}async sign(t,e,r){let o=typeof e=="object"&&(c=>{let l=!0;return["n","e","d","p","q","dp","dq","qi"].map(h=>!(h in c)&&(l=!1)),l})(e),a=typeof arweaveWallet=="object";if(!o&&!a)throw new Error("No valid JWK or external wallet found to sign transaction.");if(o){t.setOwner(e.n);let c=await t.getSignatureData(),l=await this.crypto.sign(e,c,r),h=await this.crypto.hash(l);t.setSignature({id:Ci.bufferTob64Url(h),owner:e.n,signature:Ci.bufferTob64Url(l)})}else if(a){try{(await arweaveWallet.getPermissions()).includes("SIGN_TRANSACTION")||await arweaveWallet.connect(["SIGN_TRANSACTION"])}catch{}let c=await arweaveWallet.sign(t,r);t.setSignature({id:c.id,owner:c.owner,reward:c.reward,tags:c.tags,signature:c.signature})}else throw new Error("An error occurred while signing. Check wallet is valid")}async verify(t){let e=await t.getSignatureData(),r=t.get("signature",{decode:!0,string:!1}),i=Ci.bufferTob64Url(await this.crypto.hash(r));if(t.id!==i)throw new Error("Invalid transaction signature or ID! The transaction ID doesn't match the expected SHA-256 hash of the signature.");return this.crypto.verify(t.owner,e,r)}async post(t){if(typeof t=="string"?t=new rr.default(JSON.parse(t)):typeof t.readInt32BE=="function"?t=new rr.default(JSON.parse(t.toString())):typeof t=="object"&&!(t instanceof rr.default)&&(t=new rr.default(t)),!(t instanceof rr.default))throw new Error("Must be Transaction object");t.chunks||await t.prepareChunks(t.data);let e=await this.getUploader(t,t.data);try{for(;!e.isComplete;)await e.uploadChunk()}catch(r){if(e.lastResponseStatus>0)return{status:e.lastResponseStatus,statusText:e.lastResponseError,data:{error:e.lastResponseError}};throw r}return{status:200,statusText:"OK",data:{}}}async getUploader(t,e){let r;if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t instanceof rr.default){if(e||(e=t.data),!(e instanceof Uint8Array))throw new Error("Data format is invalid");t.chunks||await t.prepareChunks(e),r=new sc.TransactionUploader(this.api,t),(!r.data||r.data.length===0)&&(r.data=e)}else{if(typeof t=="string"&&(t=await sc.TransactionUploader.fromTransactionId(this.api,t)),!e||!(e instanceof Uint8Array))throw new Error("Must provide data when resuming upload");r=await sc.TransactionUploader.fromSerialized(this.api,t,e)}return r}async*upload(t,e){let r=await this.getUploader(t,e);for(;!r.isComplete;)await r.uploadChunk(),yield r;return r}};uc.default=cc});var Bf=it(fc=>{"use strict";_();Object.defineProperty(fc,"__esModule",{value:!0});var Of=Ce();Qo();var lc=class{api;crypto;constructor(t,e){this.api=t,this.crypto=e}getBalance(t){return this.api.get(`wallet/${t}/balance`).then(e=>e.data)}getLastTransactionID(t){return this.api.get(`wallet/${t}/last_tx`).then(e=>e.data)}generate(){return this.crypto.generateJWK()}async jwkToAddress(t){return!t||t==="use_wallet"?this.getAddress():this.getAddress(t)}async getAddress(t){if(!t||t==="use_wallet"){try{await arweaveWallet.connect(["ACCESS_ADDRESS"])}catch{}return arweaveWallet.getActiveAddress()}else return this.ownerToAddress(t.n)}async ownerToAddress(t){return Of.bufferTob64Url(await this.crypto.hash(Of.b64UrlToBuffer(t)))}};fc.default=lc});var Nf=it(Ii=>{"use strict";_();Object.defineProperty(Ii,"__esModule",{value:!0});Ii.SiloResource=void 0;var Pf=Ce(),hc=class{api;crypto;transactions;constructor(t,e,r){this.api=t,this.crypto=e,this.transactions=r}async get(t){if(!t)throw new Error("No Silo URI specified");let e=await this.parseUri(t),r=await this.transactions.search("Silo-Name",e.getAccessKey());if(r.length==0)throw new Error(`No data could be found for the Silo URI: ${t}`);let i=await this.transactions.get(r[0]);if(!i)throw new Error(`No data could be found for the Silo URI: ${t}`);let o=i.get("data",{decode:!0,string:!1});return this.crypto.decrypt(o,e.getEncryptionKey())}async readTransactionData(t,e){if(!e)throw new Error("No Silo URI specified");let r=await this.parseUri(e),i=t.get("data",{decode:!0,string:!1});return this.crypto.decrypt(i,r.getEncryptionKey())}async parseUri(t){let e=t.match(/^([a-z0-9-_]+)\.([0-9]+)/i);if(!e)throw new Error("Invalid Silo name, must be a name in the format of [a-z0-9]+.[0-9]+, e.g. 'bubble.7'");let r=e[1],i=Math.pow(2,parseInt(e[2])),o=await this.hash(Pf.stringToBuffer(r),i),a=Pf.bufferTob64(o.slice(0,15)),c=await this.hash(o.slice(16,31),1);return new zo(t,a,c)}async hash(t,e){let r=await this.crypto.hash(t);for(let i=0;i<e-1;i++)r=await this.crypto.hash(r);return r}};Ii.default=hc;var zo=class{uri;accessKey;encryptionKey;constructor(t,e,r){this.uri=t,this.accessKey=e,this.encryptionKey=r}getUri(){return this.uri}getAccessKey(){return this.accessKey}getEncryptionKey(){return this.encryptionKey}};Ii.SiloResource=zo});var Wf=it(dc=>{"use strict";_();Object.defineProperty(dc,"__esModule",{value:!0});var Uf=wi(),Kp=Ce(),gc=class{api;constructor(t){this.api=t}async getTransactionOffset(t){let e=await this.api.get(`tx/${t}/offset`);if(e.status===200)return e.data;throw new Error(`Unable to get transaction offset: ${(0,Uf.getError)(e)}`)}async getChunk(t){let e=await this.api.get(`chunk/${t}`);if(e.status===200)return e.data;throw new Error(`Unable to get chunk: ${(0,Uf.getError)(e)}`)}async getChunkData(t){let e=await this.getChunk(t);return Kp.b64UrlToBuffer(e.chunk)}firstChunkOffset(t){return parseInt(t.offset)-parseInt(t.size)+1}async downloadChunkedData(t){let e=await this.getTransactionOffset(t),r=parseInt(e.size),o=parseInt(e.offset)-r+1,a=new Uint8Array(r),c=0;for(;c<r;){this.api.config.logging&&console.log(`[chunk] ${c}/${r}`);let l;try{l=await this.getChunkData(o+c)}catch{console.error(`[chunk] Failed to fetch chunk at offset ${o+c}`),console.error("[chunk] This could indicate that the chunk wasn't uploaded or hasn't yet seeded properly to a particular gateway/node")}if(l)a.set(l,c),c+=l.length;else throw new Error(`Couldn't complete data download at ${c}/${r}`)}return a}};dc.default=gc});var Mf=it(pc=>{"use strict";_();Object.defineProperty(pc,"__esModule",{value:!0});var Df=wi();Qo();var Yo=class{api;network;constructor(t,e){this.api=t,this.network=e}async get(t){let e=await this.api.get(`${Yo.HASH_ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new Df.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getByHeight(t){let e=await this.api.get(`${Yo.HEIGHT_ENDPOINT}${t}`);if(e.status===200)return e.data;throw e.status===404?new Df.default("BLOCK_NOT_FOUND"):new Error(`Error while loading block data: ${e}`)}async getCurrent(){let{current:t}=await this.network.getInfo();return await this.get(t)}},Ai=Yo;$e(Ai,"HASH_ENDPOINT","block/hash/"),$e(Ai,"HEIGHT_ENDPOINT","block/height/");pc.default=Ai});var vi=it(mc=>{"use strict";_();Object.defineProperty(mc,"__esModule",{value:!0});var Vp=sf(),Gp=cf(),qp=yf(),jp=wf(),Hp=Rf(),Qp=Bf(),Ff=jo(),Li=Ce(),zp=Nf(),Yp=Wf(),Jp=Mf(),An=class{api;wallets;transactions;network;blocks;ar;silo;chunks;constructor(t){this.api=new Gp.default(t),this.wallets=new Qp.default(this.api,An.crypto),this.chunks=new Yp.default(this.api),this.transactions=new Hp.default(this.api,An.crypto,this.chunks),this.silo=new zp.default(this.api,this.crypto,this.transactions),this.network=new jp.default(this.api),this.blocks=new Jp.default(this.api,this.network),this.ar=new Vp.default}get crypto(){return An.crypto}get utils(){return An.utils}getConfig(){return{api:this.api.getConfig(),crypto:null}}async createTransaction(t,e){let r={};if(Object.assign(r,t),!t.data&&!(t.target&&t.quantity))throw new Error("A new Arweave transaction must have a 'data' value, or 'target' and 'quantity' values.");if(t.owner==null&&e&&e!=="use_wallet"&&(r.owner=e.n),t.last_tx==null&&(r.last_tx=await this.transactions.getTransactionAnchor()),typeof t.data=="string"&&(t.data=Li.stringToBuffer(t.data)),t.data instanceof ArrayBuffer&&(t.data=new Uint8Array(t.data)),t.data&&!(t.data instanceof Uint8Array))throw new Error("Expected data to be a string, Uint8Array or ArrayBuffer");if(t.reward==null){let o=t.data?t.data.byteLength:0;r.reward=await this.transactions.getPrice(o,r.target)}r.data_root="",r.data_size=t.data?t.data.byteLength.toString():"0",r.data=t.data||new Uint8Array(0);let i=new Ff.default(r);return await i.getSignatureData(),i}async createSiloTransaction(t,e,r){let i={};if(Object.assign(i,t),!t.data)throw new Error("Silo transactions must have a 'data' value");if(!r)throw new Error("No Silo URI specified.");if(t.target||t.quantity)throw new Error("Silo transactions can only be used for storing data, sending AR to other wallets isn't supported.");if(t.owner==null){if(!e||!e.n)throw new Error("A new Arweave transaction must either have an 'owner' attribute, or you must provide the jwk parameter.");i.owner=e.n}t.last_tx==null&&(i.last_tx=await this.transactions.getTransactionAnchor());let o=await this.silo.parseUri(r);if(typeof t.data=="string"){let c=await this.crypto.encrypt(Li.stringToBuffer(t.data),o.getEncryptionKey());i.reward=await this.transactions.getPrice(c.byteLength),i.data=Li.bufferTob64Url(c)}if(t.data instanceof Uint8Array){let c=await this.crypto.encrypt(t.data,o.getEncryptionKey());i.reward=await this.transactions.getPrice(c.byteLength),i.data=Li.bufferTob64Url(c)}let a=new Ff.default(i);return a.addTag("Silo-Name",o.getAccessKey()),a.addTag("Silo-Version","0.1.0"),a}arql(t){return this.api.post("/arql",t).then(e=>e.data||[])}},In=An;$e(In,"init"),$e(In,"crypto",new qp.default),$e(In,"utils",Li);mc.default=In});var $f=it(Jo=>{"use strict";_();Object.defineProperty(Jo,"__esModule",{value:!0});Jo.getDefaultConfig=void 0;var Xp=(n,t)=>{let e=/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,r=t.split("."),i=r[r.length-1],o=["localhost","[::1]"];return o.includes(t)||n=="file"||o.includes(i)||!!t.match(e)||!!i.match(e)},Zp=n=>{let t=n.charAt(0)==="[",e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;return!!n.match(e)||t},tm=(n,t)=>{if(Xp(n,t))return{protocol:"https",host:"arweave.net",port:443};if(!Zp(t)){let e=t.split(".");if(e.length>=3){e.shift();let r=e.join(".");return{protocol:n,host:r}}}return{protocol:n,host:t}};Jo.getDefaultConfig=tm});var Xo=it(Er=>{"use strict";_();var em=Er&&Er.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),rm=Er&&Er.__exportStar||function(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&em(t,n,e)};Object.defineProperty(Er,"__esModule",{value:!0});var Ln=vi(),nm=$f();Ln.default.init=function(n={}){let t={host:"arweave.net",port:443,protocol:"https"};if(typeof location!="object"||!location.protocol||!location.hostname)return new Ln.default({...n,...t});let e=location.protocol.replace(":",""),r=location.hostname,i=location.port?parseInt(location.port):e=="https"?443:80,o=(0,nm.getDefaultConfig)(e,r),a=n.protocol||o.protocol,c=n.host||o.host,l=n.port||o.port||i;return new Ln.default({...n,host:c,protocol:a,port:l})};typeof globalThis=="object"?globalThis.Arweave=Ln.default:typeof self=="object"&&(self.Arweave=Ln.default);rm(vi(),Er);Er.default=Ln.default});var dh=it((Nc,gh)=>{"use strict";_();var{hasOwnProperty:ia}=Object.prototype,rn=Pc();rn.configure=Pc;rn.stringify=rn;rn.default=rn;Nc.stringify=rn;Nc.configure=Pc;gh.exports=rn;var hh=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/,Um=new RegExp(hh,"g"),Bc=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000b","\\f","\\r","\\u000e","\\u000f","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001a","\\u001b","\\u001c","\\u001d","\\u001e","\\u001f","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\"];function Wm(n){if(n.length===2){let e=n.charCodeAt(1);return`${n[0]}\\u${e.toString(16)}`}let t=n.charCodeAt(0);return Bc.length>t?Bc[t]:`\\u${t.toString(16)}`}function Tr(n){if(n.length<5e3&&!hh.test(n))return n;if(n.length>100)return n.replace(Um,Wm);let t="",e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);if(i===34||i===92||i<32)t+=`${n.slice(e,r)}${Bc[i]}`,e=r+1;else if(i>=55296&&i<=57343){if(i<=56319&&r+1<n.length){let o=n.charCodeAt(r+1);if(o>=56320&&o<=57343){r++;continue}}t+=`${n.slice(e,r)}\\u${i.toString(16)}`,e=r+1}}return t+=n.slice(e),t}function kc(n){if(n.length>200)return n.sort();for(let t=1;t<n.length;t++){let e=n[t],r=t;for(;r!==0&&n[r-1]>e;)n[r]=n[r-1],r--;n[r]=e}return n}var Dm=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function Rc(n){return Dm.call(n)!==void 0&&n.length!==0}function Oc(n,t,e){n.length<e&&(e=n.length);let r=t===","?"":" ",i=`"0":${r}${n[0]}`;for(let o=1;o<e;o++)i+=`${t}"${o}":${r}${n[o]}`;return i}function Mm(n){if(ia.call(n,"circularValue")){let t=n.circularValue;if(typeof t=="string")return`"${t}"`;if(t==null)return t;if(t===Error||t===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function lh(n,t){let e;if(ia.call(n,t)&&(e=n[t],typeof e!="boolean"))throw new TypeError(`The "${t}" argument must be of type boolean`);return e===void 0?!0:e}function fh(n,t){let e;if(ia.call(n,t)){if(e=n[t],typeof e!="number")throw new TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(e))throw new TypeError(`The "${t}" argument must be an integer`);if(e<1)throw new RangeError(`The "${t}" argument must be >= 1`)}return e===void 0?1/0:e}function en(n){return n===1?"1 item":`${n} items`}function Fm(n){let t=new Set;for(let e of n)(typeof e=="string"||typeof e=="number")&&t.add(String(e));return t}function $m(n){if(ia.call(n,"strict")){let t=n.strict;if(typeof t!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let r=`Object can not safely be stringified. Received type ${typeof e}`;throw typeof e!="function"&&(r+=` (${e.toString()})`),new Error(r)}}}function Pc(n){n={...n};let t=$m(n);t&&(n.bigint===void 0&&(n.bigint=!1),"circularValue"in n||(n.circularValue=Error));let e=Mm(n),r=lh(n,"bigint"),i=lh(n,"deterministic"),o=fh(n,"maximumDepth"),a=fh(n,"maximumBreadth");function c(T,d,y,x,R,N){let j=d[T];switch(typeof j=="object"&&j!==null&&typeof j.toJSON=="function"&&(j=j.toJSON(T)),j=x.call(d,T,j),typeof j){case"string":return`"${Tr(j)}"`;case"object":{if(j===null)return"null";if(y.indexOf(j)!==-1)return e;let z="",Z=",",W=N;if(Array.isArray(j)){if(j.length===0)return"[]";if(o<y.length+1)return'"[Array]"';y.push(j),R!==""&&(N+=R,z+=`
${N}`,Z=`,
${N}`);let rt=Math.min(j.length,a),ht=0;for(;ht<rt-1;ht++){let lt=c(ht,j,y,x,R,N);z+=lt!==void 0?lt:"null",z+=Z}let yt=c(ht,j,y,x,R,N);if(z+=yt!==void 0?yt:"null",j.length-1>a){let lt=j.length-a-1;z+=`${Z}"... ${en(lt)} not stringified"`}return R!==""&&(z+=`
${W}`),y.pop(),`[${z}]`}let V=Object.keys(j),ot=V.length;if(ot===0)return"{}";if(o<y.length+1)return'"[Object]"';let nt="",G="";R!==""&&(N+=R,Z=`,
${N}`,nt=" ");let J=Math.min(ot,a);Rc(j)&&(z+=Oc(j,Z,a),V=V.slice(j.length),J-=j.length,G=Z),i&&(V=kc(V)),y.push(j);for(let rt=0;rt<J;rt++){let ht=V[rt],yt=c(ht,j,y,x,R,N);yt!==void 0&&(z+=`${G}"${Tr(ht)}":${nt}${yt}`,G=Z)}if(ot>a){let rt=ot-a;z+=`${G}"...":${nt}"${en(rt)} not stringified"`,G=Z}return R!==""&&G.length>1&&(z=`
${N}${z}
${W}`),y.pop(),`{${z}}`}case"number":return isFinite(j)?String(j):t?t(j):"null";case"boolean":return j===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(j);default:return t?t(j):void 0}}function l(T,d,y,x,R,N){switch(typeof d=="object"&&d!==null&&typeof d.toJSON=="function"&&(d=d.toJSON(T)),typeof d){case"string":return`"${Tr(d)}"`;case"object":{if(d===null)return"null";if(y.indexOf(d)!==-1)return e;let j=N,z="",Z=",";if(Array.isArray(d)){if(d.length===0)return"[]";if(o<y.length+1)return'"[Array]"';y.push(d),R!==""&&(N+=R,z+=`
${N}`,Z=`,
${N}`);let ot=Math.min(d.length,a),nt=0;for(;nt<ot-1;nt++){let J=l(nt,d[nt],y,x,R,N);z+=J!==void 0?J:"null",z+=Z}let G=l(nt,d[nt],y,x,R,N);if(z+=G!==void 0?G:"null",d.length-1>a){let J=d.length-a-1;z+=`${Z}"... ${en(J)} not stringified"`}return R!==""&&(z+=`
${j}`),y.pop(),`[${z}]`}if(x.size===0)return"{}";y.push(d);let W="";R!==""&&(N+=R,Z=`,
${N}`,W=" ");let V="";for(let ot of x){let nt=l(ot,d[ot],y,x,R,N);nt!==void 0&&(z+=`${V}"${Tr(ot)}":${W}${nt}`,V=Z)}return R!==""&&V.length>1&&(z=`
${N}${z}
${j}`),y.pop(),`{${z}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return d===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(d);default:return t?t(d):void 0}}function h(T,d,y,x,R){switch(typeof d){case"string":return`"${Tr(d)}"`;case"object":{if(d===null)return"null";if(typeof d.toJSON=="function"){if(d=d.toJSON(T),typeof d!="object")return h(T,d,y,x,R);if(d===null)return"null"}if(y.indexOf(d)!==-1)return e;let N=R;if(Array.isArray(d)){if(d.length===0)return"[]";if(o<y.length+1)return'"[Array]"';y.push(d),R+=x;let nt=`
${R}`,G=`,
${R}`,J=Math.min(d.length,a),rt=0;for(;rt<J-1;rt++){let yt=h(rt,d[rt],y,x,R);nt+=yt!==void 0?yt:"null",nt+=G}let ht=h(rt,d[rt],y,x,R);if(nt+=ht!==void 0?ht:"null",d.length-1>a){let yt=d.length-a-1;nt+=`${G}"... ${en(yt)} not stringified"`}return nt+=`
${N}`,y.pop(),`[${nt}]`}let j=Object.keys(d),z=j.length;if(z===0)return"{}";if(o<y.length+1)return'"[Object]"';R+=x;let Z=`,
${R}`,W="",V="",ot=Math.min(z,a);Rc(d)&&(W+=Oc(d,Z,a),j=j.slice(d.length),ot-=d.length,V=Z),i&&(j=kc(j)),y.push(d);for(let nt=0;nt<ot;nt++){let G=j[nt],J=h(G,d[G],y,x,R);J!==void 0&&(W+=`${V}"${Tr(G)}": ${J}`,V=Z)}if(z>a){let nt=z-a;W+=`${V}"...": "${en(nt)} not stringified"`,V=Z}return V!==""&&(W=`
${R}${W}
${N}`),y.pop(),`{${W}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return d===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(d);default:return t?t(d):void 0}}function w(T,d,y){switch(typeof d){case"string":return`"${Tr(d)}"`;case"object":{if(d===null)return"null";if(typeof d.toJSON=="function"){if(d=d.toJSON(T),typeof d!="object")return w(T,d,y);if(d===null)return"null"}if(y.indexOf(d)!==-1)return e;let x="";if(Array.isArray(d)){if(d.length===0)return"[]";if(o<y.length+1)return'"[Array]"';y.push(d);let Z=Math.min(d.length,a),W=0;for(;W<Z-1;W++){let ot=w(W,d[W],y);x+=ot!==void 0?ot:"null",x+=","}let V=w(W,d[W],y);if(x+=V!==void 0?V:"null",d.length-1>a){let ot=d.length-a-1;x+=`,"... ${en(ot)} not stringified"`}return y.pop(),`[${x}]`}let R=Object.keys(d),N=R.length;if(N===0)return"{}";if(o<y.length+1)return'"[Object]"';let j="",z=Math.min(N,a);Rc(d)&&(x+=Oc(d,",",a),R=R.slice(d.length),z-=d.length,j=","),i&&(R=kc(R)),y.push(d);for(let Z=0;Z<z;Z++){let W=R[Z],V=w(W,d[W],y);V!==void 0&&(x+=`${j}"${Tr(W)}":${V}`,j=",")}if(N>a){let Z=N-a;x+=`${j}"...":"${en(Z)} not stringified"`}return y.pop(),`{${x}}`}case"number":return isFinite(d)?String(d):t?t(d):"null";case"boolean":return d===!0?"true":"false";case"undefined":return;case"bigint":if(r)return String(d);default:return t?t(d):void 0}}function v(T,d,y){if(arguments.length>1){let x="";if(typeof y=="number"?x=" ".repeat(Math.min(y,10)):typeof y=="string"&&(x=y.slice(0,10)),d!=null){if(typeof d=="function")return c("",{"":T},[],d,x,"");if(Array.isArray(d))return l("",T,[],Fm(d),x,"")}if(x.length!==0)return h("",T,[],x,"")}return w("",T,[])}return v}});var wy={};Uh(wy,{AbortError:()=>oe,AbstractContractHandler:()=>Hr,ArweaveContractDefinitionLoader:()=>Xr,ArweaveGatewayBundledContractDefinitionLoader:()=>zi,ArweaveGatewayBundledInteractionLoader:()=>sn,ArweaveGatewayInteractionsLoader:()=>Ui,ArweaveWrapper:()=>Zt,Benchmark:()=>bt,CacheKey:()=>Qt,CacheableInteractionsLoader:()=>On,CacheableStateEvaluator:()=>Wi,ConsoleLogger:()=>Wn,ConsoleLoggerFactory:()=>Dn,ContractCache:()=>pi,ContractCallRecord:()=>tn,ContractError:()=>Jt,ContractMetadata:()=>$s,CustomEvent:()=>gi,DEFAULT_LEVEL_DB_LOCATION:()=>da,DefaultEvaluationOptions:()=>hi,DefaultStateEvaluator:()=>Zr,EvalStateResult:()=>Ut,EvaluationOptionsEvaluator:()=>Ki,HandlerBasedContract:()=>on,HandlerExecutorFactory:()=>si,InnerWritesEvaluator:()=>Mi,InteractionCall:()=>Bn,InteractionCompleteEvent:()=>Fs,InteractionInput:()=>na,InteractionOutput:()=>Ac,JsHandlerApi:()=>ci,KV:()=>Mo,KnownErrors:()=>Bs,LevelDbCache:()=>De,LexicographicalInteractionsSorter:()=>tr,LogLevelOrder:()=>vu,LoggerFactory:()=>ct,MemCache:()=>Es,NetworkCommunicationError:()=>Me,NonWhitelistedSourceError:()=>xn,PstContractImpl:()=>ji,REGISTER_PROVIDER:()=>Km,SMART_WEAVE_TAGS:()=>Tt,SUPPORTED_SRC_CONTENT_TYPES:()=>mi,SWBlock:()=>En,SWTransaction:()=>Sn,SWVrf:()=>Tn,Signature:()=>$i,SmartWeaveError:()=>Di,SmartWeaveErrorType:()=>Lc,SmartWeaveGlobal:()=>oi,SortKeyCacheResult:()=>Pt,SourceType:()=>af,SrcCache:()=>di,Tag:()=>Dt,TagsParser:()=>jt,Transaction:()=>Yr,WARP_GW_URL:()=>Yc,WARP_TAGS:()=>st,Warp:()=>an,WarpBuilder:()=>Qi,WarpFactory:()=>Jc,WarpFetchWrapper:()=>Vi,WarpGatewayContractDefinitionLoader:()=>Ni,WarpGatewayInteractionsLoader:()=>zr,WasmHandlerApi:()=>ai,WasmSrc:()=>nr,arrayToHex:()=>Ps,asc:()=>_p,ascS:()=>Sp,bufToBn:()=>xp,bundledTxsFilter:()=>Cc,checkJsSrc:()=>dp,createDummyTx:()=>Wc,createInteractionTagsList:()=>aa,createInteractionTx:()=>oa,deepCopy:()=>_r,defaultArweaveMs:()=>Ko,defaultCacheOptions:()=>Nn,defaultWarpGwOptions:()=>ma,desc:()=>Ep,descS:()=>Tp,emptyTransfer:()=>xr,genesisSortKey:()=>er,getJsonResponse:()=>he,indent:()=>xe,isBrowser:()=>Qr,isTxIdValid:()=>Ms,knownWarpPlugins:()=>zc,knownWarpPluginsPartial:()=>Qc,lastPossibleSortKey:()=>wp,lvlToOrder:()=>to,mapReplacer:()=>vp,mapReviver:()=>bp,matchMutClosureDtor:()=>my,normalizeContractSource:()=>Fo,rustWasmImports:()=>Rs,safeGet:()=>ks,safeParseInt:()=>fi,sleep:()=>li,sortingFirst:()=>of,sortingLast:()=>Us,stripTrailingSlash:()=>Te,timeout:()=>Ds});_();_();_();var vu={silly:0,trace:1,debug:2,info:3,warn:4,error:5,fatal:6,none:7};function to(n){return vu[n]}var Wn=class{constructor(t,e){this.moduleName=t;this.settings=e}trace(t,...e){this.shouldLog("trace")&&console.debug(this.message("trace",t),e)}error(t,...e){this.shouldLog("error")&&console.error(this.message("error",t),e)}info(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}silly(t,...e){this.shouldLog("silly")&&console.debug(this.message("silly",t),e)}debug(t,...e){this.shouldLog("debug")&&console.debug(this.message("debug",t),e)}warn(t,...e){this.shouldLog("warn")&&console.warn(this.message("warn",t),e)}log(t,...e){this.shouldLog("info")&&console.info(this.message("info",t),e)}fatal(t,...e){this.shouldLog("fatal")&&console.error(this.message("fatal",t),e)}shouldLog(t){return to(t)>=to(this.settings.minLevel)}setSettings(t){this.settings=t}message(t,e){return`${new Date().toISOString()} ${t.toUpperCase()} [${this.moduleName}] ${e}`}};_();var Dn=class{registeredLoggers={};registeredOptions={};defOptions={minLevel:"info"};constructor(){this.setOptions=this.setOptions.bind(this),this.getOptions=this.getOptions.bind(this),this.create=this.create.bind(this),this.logLevel=this.logLevel.bind(this)}setOptions(t,e){e?this.registeredLoggers[e]?this.registeredLoggers[e].setSettings({...this.registeredLoggers[e].settings,...t}):this.registeredOptions[e]={...this.defOptions,...t}:(this.defOptions=t,Object.keys(this.registeredLoggers).forEach(r=>{this.registeredLoggers[r].setSettings({...this.registeredLoggers[r].settings,...t})}))}getOptions(t){return t?this.registeredLoggers[t]?this.registeredLoggers[t].settings:this.registeredOptions[t]?this.registeredOptions[t]:this.defOptions:this.defOptions}logLevel(t,e){this.setOptions({minLevel:t},e)}create(t="SWC"){return Object.prototype.hasOwnProperty.call(this.registeredLoggers,t)||(this.registeredLoggers[t]=new Wn(t,this.getOptions(t))),this.registeredLoggers[t]}};_();var Or=class{constructor(){}setOptions(t,e){Or.INST.setOptions(t,e)}getOptions(t){return Or.INST.getOptions(t)}logLevel(t,e){Or.INST.logLevel(t,e)}create(t){return Or.INST.create(t)}static use(t){Or.INST=t}},ct=Or;$e(ct,"INST",new Dn);_();var bt=class{static measure(){return new bt}constructor(){}start=Date.now();end=null;reset(){this.start=Date.now(),this.end=null}stop(){this.end=Date.now()}elapsed(t=!1){this.end===null&&(this.end=Date.now());let e=this.end-this.start;return t?e:`${(this.end-this.start).toFixed(0)}ms`}};_();var Qt=class{constructor(t,e){this.key=t;this.sortKey=e}},Pt=class{constructor(t,e){this.sortKey=t;this.cachedValue=e}};_();var Kl=Gt(Bl()),Vl=Gt($l());var Uo=class{constructor(t,e=!1){this.value=t;this.tomb=e}},De=class{constructor(t){this.cacheOptions=t;this.subLevelSeparator=t.subLevelSeparator||"!",this.subLevelOptions={valueEncoding:"json",separator:this.subLevelSeparator}}ongoingTransactionMark="$$warp-internal-transaction$$";logger=ct.INST.create("LevelDbCache");subLevelSeparator;subLevelOptions;_db;_rollbackBatch;get db(){if(!this._db)if(this.cacheOptions.inMemory)this._db=new Vl.MemoryLevel(this.subLevelOptions);else{if(!this.cacheOptions.dbLocation)throw new Error("LevelDb cache configuration error - no db location specified");let t=this.cacheOptions.dbLocation;this.logger.info(`Using location ${t}`),this._db=new Kl.Level(t,this.subLevelOptions)}return this._db}async get(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open();let i=await this.getValueFromLevel(t.sortKey,r);return i?new Pt(t.sortKey,i):null}async getLast(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open();let r=await e.keys({reverse:!0,limit:1}).all();if(r.length){let i=await this.getValueFromLevel(r[0],e);if(i)return new Pt(r[0],i)}return null}async getLessOrEqual(t,e){let r=this.db.sublevel(t,this.subLevelOptions);await r.open();let i=await r.keys({reverse:!0,lte:e,limit:1}).all();if(i.length){let o=await this.getValueFromLevel(i[0],r);if(o!=null)return new Pt(i[0],o)}return null}async getValueFromLevel(t,e){try{let r=await e.get(t);if(r&&r.tomb===void 0&&r.value===void 0)return r;if(r&&r.tomb===!1&&r.value!=null)return r.value}catch(r){if(r.code!="LEVEL_NOT_FOUND")throw r}return null}async put(t,e){await this.setClientValue(t,new Uo(e))}async del(t){await this.setClientValue(t,new Uo(null,!0))}async setClientValue(t,e){this.validateKey(t.key);let r=this.db.sublevel(t.key,this.subLevelOptions);await r.open(),await r.put(t.sortKey,e),this._rollbackBatch&&this._rollbackBatch.del(t.sortKey,{sublevel:r})}async delete(t){let e=this.db.sublevel(t,this.subLevelOptions);await e.open(),await e.clear()}async batch(t){for(let e of t)e.type==="put"?await this.put(e.key,e.value):e.type==="del"&&await this.delete(e.key)}async open(){await this.db.open()}async close(){this._db&&await this._db.close()}async begin(){await this.initRollbackBatch()}async rollback(){this._rollbackBatch&&(this._rollbackBatch.del(this.ongoingTransactionMark),await this._rollbackBatch.write(),await this._rollbackBatch.close()),this._rollbackBatch=null}async initRollbackBatch(){return this._rollbackBatch==null&&(await this.checkPreviousTransactionFinished(),await this.db.put(this.ongoingTransactionMark,"ongoing"),this._rollbackBatch=this.db.batch()),this._rollbackBatch}async checkPreviousTransactionFinished(){let t;try{t=await this.db.get(this.ongoingTransactionMark)}catch(e){if(e.code!="LEVEL_NOT_FOUND")throw e}if(t=="ongoing")throw new Error("Database seems to be in inconsistent state. The previous transaction has not finished.")}async commit(){this._rollbackBatch&&(await this._rollbackBatch.clear(),await this.db.del(this.ongoingTransactionMark),await this._rollbackBatch.close()),this._rollbackBatch=null}async dump(){return await this.db.iterator().all()}async getLastSortKey(){let t="";await this.db.open();let e=await this.db.keys().all();for(let r of e){let i=r.split(this.subLevelSeparator)[1];i.localeCompare(t)>0&&(t=i)}return t==""?null:t}async keys(t,e){return Array.from((await this.kvMap(t,e)).keys())}validateKey(t){if(t.includes(this.ongoingTransactionMark))throw new Error(`Validation error: Key ${t} for internal use only`);if(t.includes(this.subLevelSeparator))throw new Error(`Validation error: key ${t} contains db separator ${this.subLevelSeparator}`)}extractOriginalKey(t){return t.split(this.subLevelSeparator)[1]}extractSortKey(t){return t.split(this.subLevelSeparator)[2]}async kvMap(t,e){let r=new Map,i=(await this.db.keys(this.levelRangeOptions(e)).all()).filter(o=>o!=this.ongoingTransactionMark).filter(o=>!t||this.extractSortKey(o).localeCompare(t)<=0).map(o=>this.extractOriginalKey(o));for(let o of i){let a=await this.getLessOrEqual(o,t);a&&r.set(o,a.cachedValue)}if(e?.limit){let o=new Map;for(let a of Array.from(r.entries()).slice(0,e.limit))o.set(a[0],a[1]);return o}return r}levelRangeOptions(t){let e={reverse:t?.reverse};return t?.gte&&(e.gte=this.subLevelSeparator+t.gte),t?.lt&&(e.lt=this.subLevelSeparator+t.lt),e}storage(){return this.db}async getNumEntries(){return(await this.db.keys().all()).length}async prune(t=5){(!t||t<=0)&&(t=1);let e=await this.allKeys();for(let r=0;r<e.length;r++){let i=this.db.sublevel(e[r],this.subLevelOptions);await i.open();let o=await i.keys({reverse:!0,limit:t}).all();!o||o.length<t||(await i.clear({lt:o[o.length-1]}),await i.close())}return null}async allKeys(){return(await this.db.keys().all()).filter(t=>t!=this.ongoingTransactionMark).map(t=>this.extractOriginalKey(t))}};_();var Es=class{storage={};clearAll(){Object.keys(this.storage).forEach(t=>{delete this.storage[t]})}contains(t){return Object.prototype.hasOwnProperty.call(this.storage,t)}get(t){return this.storage[t]}put(t,e){this.storage[t]=e}remove(t){delete this.storage[t]}};_();_();var x0=Gt(Ze());_();_();var Nd=Function.prototype.toString,xs=Object.create,Ud=Object.prototype.toString,Wd=function(){function n(){this._keys=[],this._values=[]}return n.prototype.has=function(t){return!!~this._keys.indexOf(t)},n.prototype.get=function(t){return this._values[this._keys.indexOf(t)]},n.prototype.set=function(t,e){this._keys.push(t),this._values.push(e)},n}();function Dd(){return new Wd}function Md(){return new WeakMap}var Fd=typeof WeakMap<"u"?Md:Dd;function Is(n){if(!n)return xs(null);var t=n.constructor;if(t===Object)return n===Object.prototype?{}:xs(n);if(~Nd.call(t).indexOf("[native code]"))try{return new t}catch{}return xs(n)}function $d(n){var t="";return n.global&&(t+="g"),n.ignoreCase&&(t+="i"),n.multiline&&(t+="m"),n.unicode&&(t+="u"),n.sticky&&(t+="y"),t}function Kd(n){return n.flags}var Vd=/test/g.flags==="g"?Kd:$d;function Gl(n){var t=Ud.call(n);return t.substring(8,t.length-1)}function Gd(n){return n[Symbol.toStringTag]||Gl(n)}var qd=typeof Symbol<"u"?Gd:Gl,jd=Object.defineProperty,Hd=Object.getOwnPropertyDescriptor,ql=Object.getOwnPropertyNames,As=Object.getOwnPropertySymbols,jl=Object.prototype,Hl=jl.hasOwnProperty,Qd=jl.propertyIsEnumerable,Ql=typeof As=="function";function zd(n){return ql(n).concat(As(n))}var Yd=Ql?zd:ql;function Do(n,t,e){for(var r=Yd(n),i=0,o=r.length,a=void 0,c=void 0;i<o;++i)if(a=r[i],!(a==="callee"||a==="caller")){if(c=Hd(n,a),!c){t[a]=e.copier(n[a],e);continue}!c.get&&!c.set&&(c.value=e.copier(c.value,e));try{jd(t,a,c)}catch{t[a]=c.value}}return t}function Jd(n,t){var e=new t.Constructor;t.cache.set(n,e);for(var r=0,i=n.length;r<i;++r)e[r]=t.copier(n[r],t);return e}function Xd(n,t){var e=new t.Constructor;return t.cache.set(n,e),Do(n,e,t)}function zl(n,t){return n.slice(0)}function Zd(n,t){return n.slice(0,n.size,n.type)}function tp(n,t){return new t.Constructor(zl(n.buffer))}function ep(n,t){return new t.Constructor(n.getTime())}function Yl(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r,i){e.set(i,t.copier(r,t))}),e}function rp(n,t){return Do(n,Yl(n,t),t)}function np(n,t){var e=Is(t.prototype);t.cache.set(n,e);for(var r in n)Hl.call(n,r)&&(e[r]=t.copier(n[r],t));return e}function ip(n,t){var e=Is(t.prototype);t.cache.set(n,e);for(var r in n)Hl.call(n,r)&&(e[r]=t.copier(n[r],t));for(var i=As(n),o=0,a=i.length,c=void 0;o<a;++o)c=i[o],Qd.call(n,c)&&(e[c]=t.copier(n[c],t));return e}var op=Ql?ip:np;function ap(n,t){var e=Is(t.prototype);return t.cache.set(n,e),Do(n,e,t)}function Cs(n,t){return new t.Constructor(n.valueOf())}function sp(n,t){var e=new t.Constructor(n.source,Vd(n));return e.lastIndex=n.lastIndex,e}function Wo(n,t){return n}function Jl(n,t){var e=new t.Constructor;return t.cache.set(n,e),n.forEach(function(r){e.add(t.copier(r,t))}),e}function cp(n,t){return Do(n,Jl(n,t),t)}var up=Array.isArray,Ls=Object.assign,lp=Object.getPrototypeOf||function(n){return n.__proto__},Xl={array:Jd,arrayBuffer:zl,blob:Zd,dataView:tp,date:ep,error:Wo,map:Yl,object:op,regExp:sp,set:Jl},fp=Ls({},Xl,{array:Xd,map:rp,object:ap,set:cp});function hp(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:Cs,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:Cs,Object:n.object,Promise:Wo,RegExp:n.regExp,Set:n.set,String:Cs,WeakMap:Wo,WeakSet:Wo,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}function Zl(n){var t=Ls({},Xl,n),e=hp(t),r=e.Array,i=e.Object;function o(a,c){if(c.prototype=c.Constructor=void 0,!a||typeof a!="object")return a;if(c.cache.has(a))return c.cache.get(a);if(c.prototype=lp(a),c.Constructor=c.prototype&&c.prototype.constructor,!c.Constructor||c.Constructor===Object)return i(a,c);if(up(a))return r(a,c);var l=e[qd(a)];return l?l(a,c):typeof a.then=="function"?a:i(a,c)}return function(c){return o(c,{Constructor:void 0,cache:Fd(),copier:o,prototype:void 0})}}function gp(n){return Zl(Ls({},fp,n))}var pv=gp({}),tf=Zl({});_();_();var oi=class{gasUsed;gasLimit;transaction;block;vrf;evaluationOptions;arweave;contract;unsafeClient;baseArweaveUrl;safeArweaveGet;contracts;extensions;_activeTx;caller;kv;constructor(t,e,r,i,o){this.gasUsed=0,this.gasLimit=Number.MAX_SAFE_INTEGER,this.unsafeClient=t,this.arweave={ar:t.ar,utils:t.utils,wallets:t.wallets,crypto:t.crypto},this.baseArweaveUrl=`${t.api.config.protocol}://${t.api.config.host}:${t.api.config.port}`,this.safeArweaveGet=async function(a){return ks(`${this.baseArweaveUrl}${a}`)},this.evaluationOptions=r,this.contract=e,this.transaction=new Sn(this),this.block=new En(this),this.contracts={readContractState:(a,c,l)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},viewContractState:(a,c)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},write:(a,c,l)=>{throw new Error("Not implemented - should be set by HandlerApi implementor")},refreshState:()=>{throw new Error("Not implemented - should be set by HandlerApi implementor")}},this.vrf=new Tn(this),this.useGas=this.useGas.bind(this),this.getBalance=this.getBalance.bind(this),this.extensions={},this.kv=new Mo(o,i,this.transaction,this.contract.id)}useGas(t){if(t<0)throw new Error("[RE:GNE] Gas number exception - gas < 0.");if(this.gasUsed+=t,this.gasUsed>this.gasLimit)throw new Error(`[RE:OOG] Out of gas! Used: ${this.gasUsed}, limit: ${this.gasLimit}`)}async getBalance(t,e){if(!this._activeTx)throw new Error("Cannot read balance - active tx is not set.");if(!this.block.height)throw new Error("Cannot read balance - block height not set.");let r=e||this.block.height;return await fetch(`${this.evaluationOptions.walletBalanceUrl}block/height/${r}/wallet/${t}/balance`).then(i=>i.ok?i.text():Promise.reject(i)).catch(i=>{throw new Error(`Unable to read wallet balance. ${i.status}. ${i.body?.message}`)})}},Sn=class{constructor(t){this.smartWeaveGlobal=t}get id(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.id}get owner(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.owner.address}get target(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.recipient}get tags(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.tags}get sortKey(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.sortKey}get dryRun(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.dry===!0}get quantity(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.quantity.winston}get reward(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.fee.winston}get origin(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.source==="redstone-sequencer"?"L2":"L1"}},En=class{constructor(t){this.smartWeaveGlobal=t}get height(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.height}get indep_hash(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current Tx");return this.smartWeaveGlobal._activeTx.block.id}get timestamp(){if(!this.smartWeaveGlobal._activeTx)throw new Error("No current tx");return this.smartWeaveGlobal._activeTx.block.timestamp}},Tn=class{constructor(t){this.smartWeaveGlobal=t}get data(){return this.smartWeaveGlobal._activeTx.vrf}get value(){return this.smartWeaveGlobal._activeTx.vrf.bigint}randomInt(t){if(!Number.isInteger(t))throw new Error("Integer max value required for random integer generation");let e=BigInt(this.smartWeaveGlobal._activeTx.vrf.bigint)%BigInt(t)+BigInt(1);if(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)throw new Error("Random int cannot be cast to number");return Number(e)}},Mo=class{constructor(t,e,r,i){this._storage=t;this._interactionState=e;this._transaction=r;this._contractTxId=i}async put(t,e){this.checkStorageAvailable(),await this._storage.put(new Qt(t,this._transaction.sortKey),e)}async get(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.getKV(this._contractTxId,new Qt(t,this._transaction.sortKey));return r??(await this._storage.getLessOrEqual(t,this._transaction.sortKey))?.cachedValue??null}async del(t){this.checkStorageAvailable();let e=this._transaction.sortKey,r=await this._interactionState.delKV(this._contractTxId,new Qt(t,this._transaction.sortKey));if(r!=null)return r;await this._storage.del(new Qt(t,this._transaction.sortKey))}async keys(t){let e=this._transaction.sortKey;return await this._storage.keys(e,t)}async kvMap(t){let e=this._transaction.sortKey;return this._storage.kvMap(e,t)}async begin(){if(this._storage)return this._storage.begin()}async commit(){this._storage&&(this._transaction.dryRun?await this._storage.rollback():await this._storage.commit())}async rollback(){this._storage&&await this._storage.rollback()}open(){if(this._storage)return this._storage.open()}close(){if(this._storage)return this._storage.close()}checkStorageAvailable(){if(!this._storage)throw new Error("KV Storage not available")}};_();_();var Rs=(n,t,e,r,i)=>{let o=ct.INST.create("WASM:Rust"),a={metering:{usegas:n.useGas},console:{log:function(g){o.debug(`${n.contract.id}: ${g}`)}},Block:{height:function(){return n.block.height},indep_hash:function(){return n.block.indep_hash},timestamp:function(){return n.block.timestamp}},Transaction:{id:function(){return n.transaction.id},owner:function(){return n.transaction.owner},target:function(){return n.transaction.target}},Contract:{id:function(){return n.contract.id},owner:function(){return n.contract.owner}},KV:{get:async function(g){return await n.kv.get(g)},put:async function(g,m){await n.kv.put(g,m)}},SmartWeave:{caller:function(){return n.caller},readContractState:async function(g){return await n.contracts.readContractState(g)},viewContractState:async function(g,m){return await n.contracts.viewContractState(g,m)},write:async function(g,m){return await n.contracts.write(g,m,!1)}},Vrf:{value:function(){return n.vrf.value},randomInt:function(g){return n.vrf.randomInt(g)}}},c=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});c.decode();let l=null;function h(){return(l===null||l.byteLength===0)&&(l=new Uint8Array(e.exports.memory.buffer)),l}function w(g,m){return c.decode(h().subarray(g,g+m))}let v=new Array(128).fill(void 0);v.push(void 0,null,!0,!1);let T=v.length;function d(g){T===v.length&&v.push(v.length+1);let m=T;if(T=v[m],typeof T!="number")throw new Error("corrupt heap");return v[m]=g,m}function y(g){return v[g]}function x(g){if(typeof g!="boolean")throw new Error("expected a boolean argument")}function R(g){return g==null}function N(g){if(typeof g!="number")throw new Error("expected a number argument")}let j=null;function z(){return(j===null||j.byteLength===0)&&(j=new Float64Array(e.exports.memory.buffer)),j}let Z=null;function W(){return(Z===null||Z.byteLength===0)&&(Z=new Int32Array(e.exports.memory.buffer)),Z}let V=0,ot=new TextEncoder("utf-8"),nt=typeof ot.encodeInto=="function"?function(g,m){return ot.encodeInto(g,m)}:function(g,m){let C=ot.encode(g);return m.set(C),{read:g.length,written:C.length}};function G(g,m,C){if(typeof g!="string")throw new Error("expected a string argument");if(C===void 0){let u=ot.encode(g),f=m(u.length);return h().subarray(f,f+u.length).set(u),V=u.length,f}let H=g.length,et=m(H),at=h(),s=0;for(;s<H;s++){let u=g.charCodeAt(s);if(u>127)break;at[et+s]=u}if(s!==H){s!==0&&(g=g.slice(s)),et=C(et,H,H=s+g.length*3);let u=h().subarray(et+s,et+H),f=nt(g,u);if(f.read!==g.length)throw new Error("failed to pass whole string");s+=f.written}return V=s,et}function J(g){g<132||(v[g]=T,T=g)}function rt(g){let m=y(g);return J(g),m}function ht(g){let m=typeof g;if(m=="number"||m=="boolean"||g==null)return`${g}`;if(m=="string")return`"${g}"`;if(m=="symbol"){let et=g.description;return et==null?"Symbol":`Symbol(${et})`}if(m=="function"){let et=g.name;return typeof et=="string"&&et.length>0?`Function(${et})`:"Function"}if(Array.isArray(g)){let et=g.length,at="[";et>0&&(at+=ht(g[0]));for(let s=1;s<et;s++)at+=", "+ht(g[s]);return at+="]",at}let C=/\[object ([^\]]+)\]/.exec(toString.call(g)),H;if(C.length>1)H=C[1];else return toString.call(g);if(H=="Object")try{return"Object("+JSON.stringify(g)+")"}catch{return"Object"}return g instanceof Error?`${g.name}: ${g.message}
${g.stack}`:H}function yt(g){if(typeof g!="bigint")throw new Error("expected a bigint argument")}let lt=null;function Nt(){return(lt===null||lt.byteLength===0)&&(lt=new BigInt64Array(e.exports.memory.buffer)),lt}function Lt(g,m,C,H){let et={a:g,b:m,cnt:1,dtor:C},at=(...s)=>{et.cnt++;let u=et.a;et.a=0;try{return H(u,et.b,...s)}finally{--et.cnt===0?e.exports.__wbindgen_export_2.get(et.dtor)(u,et.b):et.a=u}};return at.original=et,at}function tt(g,m){try{return g.apply(this,m)}catch(C){let H=function(){try{return C instanceof Error?`${C.message}

Stack:
${C.stack}`:C.toString()}catch{return"<failed to stringify thrown value>"}}();throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:",H),C}}function Kt(g,m,C){N(g),N(m),e.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__(g,m,d(C))}function wt(g){let m=e.exports.warpContractWrite(d(g));return rt(m)}function ee(g){var m=e.exports.handle(d(g));return rt(m)}let vt=128;function At(g){if(vt==1)throw new Error("out of js stack");return v[--vt]=g,vt}function X(g){try{let H=e.exports.__wbindgen_add_to_stack_pointer(-16);e.exports.initState(H,At(g));var m=W()[H/4+0],C=W()[H/4+1];let et;return m!==0&&(et=w(m,C).slice(),e.exports.__wbindgen_free(m,C*1)),et}finally{e.exports.__wbindgen_add_to_stack_pointer(16),v[vt++]=void 0}}function sr(g){try{e.exports.initState(At(g))}finally{v[vt++]=void 0}}function Ir(){let g=e.exports.currentState();return rt(g)}function cr(){return e.exports.version()}function Vt(){return e.exports.lang()}function Mt(g){let m=e.exports.warpContractView(d(g));return rt(m)}function p(g,m){try{return g.apply(this,m)}catch(C){e.exports.__wbindgen_exn_store(d(C))}}function b(g,m,C,H){N(g),N(m),e.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__(g,m,d(C),d(H))}function S(g){return()=>{throw new Error(`${g} is not defined`)}}let U={__wbindgen_json_parse:function(g,m){let C=JSON.parse(w(g,m));return d(C)},__wbindgen_json_serialize:function(g,m){let C=y(m),H=JSON.stringify(C===void 0?null:C),et=G(H,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),at=V;W()[g/4+1]=at,W()[g/4+0]=et},__wbindgen_error_new:function(g,m){let C=new Error(w(g,m));return d(C)},__wbindgen_is_undefined:function(g){let m=y(g)===void 0;return x(m),m},__wbindgen_in:function(g,m){let C=y(g)in y(m);return x(C),C},__wbindgen_number_get:function(g,m){let C=y(m),H=typeof C=="number"?C:void 0;R(H)||N(H),z()[g/8+1]=R(H)?0:H,W()[g/4+0]=!R(H)},__wbindgen_boolean_get:function(g){let m=y(g),C=typeof m=="boolean"?m?1:0:2;return N(C),C},__wbindgen_is_null:function(g){let m=y(g)===null;return x(m),m},__wbindgen_string_new:function(g,m){let C=w(g,m);return d(C)},__wbindgen_string_get:function(g,m){let C=y(m),H=typeof C=="string"?C:void 0;var et=R(H)?0:G(H,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),at=V;W()[g/4+1]=at,W()[g/4+0]=et},__wbindgen_is_bigint:function(g){let m=typeof y(g)=="bigint";return x(m),m},__wbindgen_is_object:function(g){let m=y(g),C=typeof m=="object"&&m!==null;return x(C),C},__wbindgen_object_clone_ref:function(g){let m=y(g);return d(m)},__wbindgen_jsval_eq:function(g,m){let C=y(g)===y(m);return x(C),C},__wbindgen_bigint_from_i64:function(g){return d(g)},__wbindgen_bigint_from_u64:function(g){let m=BigInt.asUintN(64,g);return d(m)},__wbg_readContractState:function(){return p(function(g,m){let C=a.SmartWeave.readContractState(w(g,m));return d(C)},arguments)},__wbg_viewContractState:function(){return p(function(g,m,C){let H=a.SmartWeave.viewContractState(w(g,m),rt(C));return d(H)},arguments)},__wbg_write:function(){return p(function(g,m,C){let H=a.SmartWeave.write(w(g,m),rt(C));return d(H)},arguments)},__wbg_refreshState:function(g,m){},__wbg_kvGet:function(){return p(function(g,m){let C=a.KV.get(w(g,m));return d(C)},arguments)},__wbg_kvPut:function(){return p(function(g,m,C){let H=a.KV.put(w(g,m),rt(C));return d(H)},arguments)},__wbindgen_object_drop_ref:function(g){rt(g)},__wbg_error:function(){return tt(function(g,m){try{a.console.log(w(g,m))}finally{e.exports.__wbindgen_free(g,m)}},arguments)},__wbg_new_abda76e883ba8a5f:function(){return tt(function(){let g=new Error;return d(g)},arguments)},__wbg_stack:function(){return tt(function(g,m){let C=Error.stackTraceLimit;Error.stackTraceLimit=25;let H=y(m).stack,et=G(H,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),at=V;W()[g/4+1]=at,W()[g/4+0]=et,Error.stackTraceLimit=C},arguments)},__wbg_indephash:function(){return tt(function(g){let m=a.Block.indep_hash(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_height:function(){return tt(function(){let g=a.Block.height();return N(g),g},arguments)},__wbg_timestamp:function(){return tt(function(){let g=a.Block.timestamp();return N(g),g},arguments)},__wbg_contractId:function(){return tt(function(g){let m=a.Contract.id(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_contractOwner:function(){return tt(function(g){let m=a.Contract.owner(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_id:function(){return tt(function(g){let m=a.Transaction.id(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_owner:function(){return tt(function(g){let m=a.Transaction.owner(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_target:function(){return tt(function(g){let m=a.Transaction.target(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_caller:function(){return tt(function(g){let m=a.SmartWeave.caller(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_value_b245bf3240b21a48:function(){return tt(function(g){let m=a.Vrf.value(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_value_7d69ddc3f1ad7876:function(){return tt(function(g){let m=a.Vrf.value(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_vrfValue:function(){return tt(function(g){let m=a.Vrf.value(),C=G(m,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),H=V;W()[g/4+1]=H,W()[g/4+0]=C},arguments)},__wbg_randomInt:function(){return tt(function(g){let m=a.Vrf.randomInt(g);return N(m),m},arguments)},__wbg_log:function(){return tt(function(g,m){a.console.log(w(g,m))},arguments)},__wbindgen_cb_drop:function(g){let m=rt(g).original;if(m.cnt--==1)return m.a=0,!0;let C=!1;return x(C),C},__wbg_debug:function(){return tt(function(g){console.log(y(g))},arguments)},__wbg_String:function(){return tt(function(g,m){let C=String(y(m)),H=G(C,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),et=V;W()[g/4+1]=et,W()[g/4+0]=H},arguments)},__wbg_getwithrefkey:function(){return tt(function(g,m){let C=y(g)[y(m)];return d(C)},arguments)},__wbg_set_841ac57cff3d672b:function(){return tt(function(g,m,C){y(g)[rt(m)]=rt(C)},arguments)},__wbindgen_number_new:function(g){return d(g)},__wbindgen_jsval_loose_eq:function(g,m){let C=y(g)==y(m);return x(C),C},__wbg_get_27fe3dac1c4d0224:function(){return tt(function(g,m){let C=y(g)[m>>>0];return d(C)},arguments)},__wbg_set_17224bc548dd1d7b:function(){return tt(function(g,m,C){y(g)[m>>>0]=rt(C)},arguments)},__wbg_isArray:function(){return tt(function(g){let m=Array.isArray(y(g));return x(m),m},arguments)},__wbg_length_e498fbc24f9c1d4f:function(){return tt(function(g){let m=y(g).length;return N(m),m},arguments)},__wbg_new_b525de17f44a8943:function(){return tt(function(){let g=new Array;return d(g)},arguments)},__wbg_instanceof_ArrayBuffer:function(){return tt(function(g){let m;try{m=y(g)instanceof ArrayBuffer}catch{m=!1}let C=m;return x(C),C},arguments)},__wbg_call_95d1ea488d03e4e8:function(){return p(function(g,m){let C=y(g).call(y(m));return d(C)},arguments)},__wbg_call_9495de66fdbe016b:function(){return p(function(g,m,C){let H=y(g).call(y(m),y(C));return d(H)},arguments)},__wbg_call_94697a95cb7e239c:function(){return p(function(g,m,C){let H=y(g).call(y(m),y(C));return d(H)},arguments)},__wbg_new_f841cc6f2098f4b5:function(){return tt(function(){return d(new Map)},arguments)},__wbg_set_388c4c6422704173:function(){return tt(function(g,m,C){let H=y(g).set(y(m),y(C));return d(H)},arguments)},__wbg_next_88560ec06a094dea:function(){return p(function(g){let m=y(g).next();return d(m)},arguments)},__wbg_next_b7d530c04fd8b217:function(){return tt(function(g){let m=y(g).next;return d(m)},arguments)},__wbg_done:function(){return tt(function(g){let m=y(g).done;return x(m),m},arguments)},__wbg_value_6ac8da5cc5b3efda:function(){return tt(function(g){let m=y(g).value;return d(m)},arguments)},__wbg_isSafeInteger:function(){return tt(function(g){let m=Number.isSafeInteger(y(g));return x(m),m},arguments)},__wbg_entries:function(){return tt(function(g){let m=Object.entries(y(g));return d(m)},arguments)},__wbg_new_f9876326328f45ed:function(){return tt(function(){let g=new Object;return d(g)},arguments)},__wbg_iterator:function(){return tt(function(){return d(Symbol.iterator)},arguments)},__wbg_new_9d3a9ce4282a18a8:function(){return tt(function(g,m){try{var C={a:g,b:m},H=(at,s)=>{let u=C.a;C.a=0;try{return b(u,C.b,at,s)}finally{C.a=u}};let et=new Promise(H);return d(et)}finally{C.a=C.b=0}},arguments)},__wbg_new_4beacc9c71572250:function(){return tt(function(g,m){try{var C={a:g,b:m},H=(at,s)=>{let u=C.a;C.a=0;try{return b(u,C.b,at,s)}finally{C.a=u}};let et=new Promise(H);return d(et)}finally{C.a=C.b=0}},arguments)},__wbg_resolve:function(){return tt(function(g){let m=Promise.resolve(y(g));return d(m)},arguments)},__wbg_then_ec5db6d509eb475f:function(){return tt(function(g,m){let C=y(g).then(y(m));return d(C)},arguments)},__wbg_then_a6860c82b90816ca:function(){return tt(function(g,m){let C=y(g).then(y(m));return d(C)},arguments)},__wbg_then_f753623316e2873a:function(){return tt(function(g,m,C){let H=y(g).then(y(m),y(C));return d(H)},arguments)},__wbg_then_58a04e42527f52c6:function(){return tt(function(g,m,C){let H=y(g).then(y(m),y(C));return d(H)},arguments)},__wbg_instanceof_Uint8Array:function(){return tt(function(g){let m;try{m=y(g)instanceof Uint8Array}catch{m=!1}let C=m;return x(C),C},arguments)},__wbg_new_537b7341ce90bb31:function(){return tt(function(g){let m=new Uint8Array(y(g));return d(m)},arguments)},__wbg_length_27a2afe8ab42b09f:function(){return tt(function(g){let m=y(g).length;return N(m),m},arguments)},__wbg_set_17499e8aa4003ebd:function(){return tt(function(g,m,C){y(g).set(y(m),C>>>0)},arguments)},__wbindgen_is_function:function(g){let m=typeof y(g)=="function";return x(m),m},__wbindgen_is_string:function(g){let m=typeof y(g)=="string";return x(m),m},__wbg_buffer:function(){return tt(function(g){let m=y(g).buffer;return d(m)},arguments)},__wbg_get_baf4855f9a986186:function(){return p(function(g,m){let C=Reflect.get(y(g),y(m));return d(C)},arguments)},__wbindgen_debug_string:function(g,m){let C=ht(y(m)),H=G(C,e.exports.__wbindgen_malloc,e.exports.__wbindgen_realloc),et=V;W()[g/4+1]=et,W()[g/4+0]=H},__wbindgen_bigint_get_as_i64:function(g,m){let C=y(m),H=typeof C=="bigint"?C:void 0;R(H)||yt(H),Nt()[g/8+1]=R(H)?BigInt(0):H,W()[g/4+0]=!R(H)},__wbindgen_throw:function(g,m){throw new Error(w(g,m))},__wbindgen_memory:function(){let g=e.exports.memory;return d(g)},__wbindgen_closure_wrapper:function(){return tt(function(g,m,C){let H=Lt(g,m,r,Kt);return d(H)},arguments)}},A={_assertBoolean:x,_assertNum:N,addBorrowedObject:At,addHeapObject:d,getInt32Memory0:W,getObject:y,getStringFromWasm0:w,handleError:p,heap:()=>v,logError:tt,notDefined:S,passStringToWasm0:G,takeObject:rt,wasm:()=>e.exports,WASM_VECTOR_LEN:()=>V,__wbg_adapter_4:b,__wbg_adapter_3:Kt};function O(g){return function(){return tt(function(m){let C=g(rt(m));return d(C)},arguments)}}function D(g,m){let C={};for(let[H,et]of Object.entries(g.extensions)){let at=et.rustImports?.(m)??{};for(let[s,u]of Object.entries(at))s.startsWith("__wbg_")?C[s]=u:C["__wbg_"+s]=O(u)}return C}let I={...U,...D(n,A)},L=Object.keys(I),B=t.reduce((g,m)=>{let C=L.find(H=>m.startsWith(H));if(C===void 0)throw new Error(`Cannot find import mapping for ${m}. Please file a bug.`);if(L.filter(H=>m.startsWith(H)).length!=1)throw new Error(`Multiple import mappings for ${m}. Please file a bug.`);if(g.usedKeys.has(C))throw new Error(`Multiple methods maps to ${C}. Please file a bug.`);return g.res[m]=I[C],g.usedKeys.add(C),g},{res:{},usedKeys:new Set}).res;i==="__WARP_CONTRACTS_VERSION_LEGACY"?(B.initStateLegacy=sr,B.handle=ee):(B.initState=X,B.warpContractWrite=wt,B.warpContractView=Mt),B.currentState=Ir,B.version=cr,B.lang=Vt;let P={};P.__wbindgen_placeholder__=B;class Q{__destroy_into_raw(){let m=this.ptr;return this.ptr=0,m}free(){let m=this.__destroy_into_raw();e.exports.__wbg_statewrapper_free(m)}}return B.StateWrapper=Q,P.metering=a.metering,{imports:P,exports:B}};_();_();var Hr=class{constructor(t,e){this.swGlobal=t;this.contractDefinition=e;this.assignReadContractState=this.assignReadContractState.bind(this),this.assignViewContractState=this.assignViewContractState.bind(this),this.assignWrite=this.assignWrite.bind(this),this.assignRefreshState=this.assignRefreshState.bind(this)}logger=ct.INST.create("ContractHandler");async dispose(){}assignWrite(t){this.swGlobal.contracts.write=async(e,r,i)=>{if(!t.evaluationOptions.internalWrites)throw new Error("Internal writes feature switched off. Change EvaluationOptions.internalWrites flag to 'true'");let o=i??t.evaluationOptions.throwOnInternalWriteError,a={from:this.contractDefinition.txId,to:e,input:r};this.logger.debug("swGlobal.write call:",a);let c=t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"write"}),l=await c.applyInput(r,this.swGlobal._activeTx,t.signal);this.logger.debug("Cache result?:",!this.swGlobal._activeTx.dry);let h=l.type!=="ok"&&o&&(!this.swGlobal._activeTx.dry||this.swGlobal._activeTx.dry&&this.swGlobal._activeTx.strict),w=h?`Internal write auto error for call [${JSON.stringify(a)}]: ${l.errorMessage}`:l.errorMessage,v=w?{...l.originalErrorMessages,[this.swGlobal._activeTx.id]:w}:l.originalErrorMessages;if(c.interactionState().update(c.txId(),{state:l.state,validity:{...l.originalValidity,[this.swGlobal._activeTx.id]:l.type=="ok"},errorMessages:v},this.swGlobal._activeTx.sortKey),h)throw new Jt(l.type==="error"&&l.error?l.error:w);return l}}assignViewContractState(t){this.swGlobal.contracts.viewContractState=async(e,r)=>(this.logger.debug("swGlobal.viewContractState call:",{from:this.contractDefinition.txId,to:e,input:r}),await t.warp.contract(e,t.contract,{callingInteraction:this.swGlobal._activeTx,callType:"view"}).viewStateForTx(r,this.swGlobal._activeTx,t.signal))}assignReadContractState(t,e){this.swGlobal.contracts.readContractState=async(r,i)=>{this.logger.debug("swGlobal.readContractState call:",{from:this.contractDefinition.txId,to:r,sortKey:e.sortKey,transaction:this.swGlobal.transaction.id});let{contract:o,warp:a,signal:c}=t,h=await a.contract(r,o,{callingInteraction:e,callType:"read"}).readState(e.sortKey,void 0,c);if(h?.cachedValue?.errorMessages){let v=Reflect.ownKeys(h?.cachedValue?.errorMessages);if(v.length){let T=v[v.length-1],d=h?.cachedValue?.errorMessages[T];if(d&&d.startsWith&&(d.startsWith("[SkipUnsafeError]")||d.startsWith("[NonWhitelistedSourceError]")))throw new Jt(d)}}return i?{state:_r(h.cachedValue.state),validity:h.cachedValue.validity,errorMessages:h.cachedValue.errorMessages}:_r(h.cachedValue.state)}}assignRefreshState(t){this.swGlobal.contracts.refreshState=async()=>t.contract.interactionState().get(this.swGlobal.contract.id,this.swGlobal._activeTx.sortKey)?.state}};var ai=class extends Hr{constructor(e,r,i){super(e,r);this.wasmExports=i}async handle(e,r,i){try{let{interaction:o,interactionTx:a}=i;this.swGlobal._activeTx=a,this.swGlobal.caller=o.caller,this.swGlobal.gasLimit=e.evaluationOptions.gasLimit,this.swGlobal.gasUsed=0,this.assignReadContractState(e,a),this.assignViewContractState(e),this.assignWrite(e),await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let c=await this.doHandle(o);return i.interaction.interactionType==="view"?await this.swGlobal.kv.rollback():await this.swGlobal.kv.commit(),{type:"ok",result:c,state:this.doGetCurrentState(),gasUsed:this.swGlobal.gasUsed,event:null}}catch(o){await this.swGlobal.kv.rollback();let a={errorMessage:o.message,state:r.state,result:null};if(o instanceof Jt||o instanceof xn)return{...a,error:o.error,type:"error",event:null};if(o instanceof Me)throw o;return{...a,type:"exception",event:null}}finally{await this.swGlobal.kv.close()}}initState(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("initStateLegacy"in this.wasmExports){this.wasmExports.initStateLegacy(e);return}let r=this.wasmExports.initState(e);if(r)throw new Error(r);return}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async doHandleLegacy(e){let r=await this.wasmExports.handle(e.input);if(!r)return;if(Object.prototype.hasOwnProperty.call(r,"Ok"))return r.Ok;let i,o="";throw typeof r.Err=="string"||r.Err instanceof String?i=r.Err:"kind"in r.Err?(i=r.Err.kind,o="data"in r.Err?" "+r.Err.data:""):(i=Object.keys(r.Err)[0],o=" "+r.Err[i]),i=="RuntimeError"?new Error(`[RE:RE]${o}`):new Jt(`[CE:${i}${o}]`)}async doHandle(e){switch(this.contractDefinition.srcWasmLang){case"rust":{if("handle"in this.wasmExports)return await this.doHandleLegacy(e);let r=e.interactionType==="write"?await this.wasmExports.warpContractWrite(e.input):await this.wasmExports.warpContractView(e.input);if(!r)return;if(r.type==="ok")return r.result;throw this.logger.error("Error from rust",r),r.type==="error"?new Jt(r.error):new Error(r.errorMessage)}default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor)throw Error("Constructor is not implemented for wasm");return e}doGetCurrentState(){switch(this.contractDefinition.srcWasmLang){case"rust":return this.wasmExports.currentState();default:throw new Error(`Support for ${this.contractDefinition.srcWasmLang} not implemented yet.`)}}};_();function Fo(n,t){let e=n.trim().split(`
`),r=e[0],i=e[e.length-1];return(/\(\s*\(\)\s*=>\s*{/g.test(r)||/\s*\(\s*function\s*\(\)\s*{/g.test(r))&&/}\s*\)\s*\(\)\s*;/g.test(i)&&(e.shift(),e.pop(),n=e.join(`
`)),n=n.replace(/export\s+async\s+function\s+handle/gmu,"async function handle").replace(/export\s+function\s+handle/gmu,"function handle"),t?`
    ${n}
    module.exports = handle;`:`
    const window=void 0,document=void 0,Function=void 0,eval=void 0,globalThis=void 0;
    const [SmartWeave, BigNumber, logger${Qr()?", Buffer, atob, btoa":""}] = arguments;
    class ContractError extends Error { constructor(message) { super(message); this.name = 'ContractError' } };
    function ContractAssert(cond, message) { if (!cond) throw new ContractError(message) };
    ${n};
    return handle;
  `}function dp(n,t){try{let e=Fo(n,!1);return new Function(e)(),!0}catch(e){return t?.error(e),!1}}var nf=Gt(Ze()),rf=Os(),Jt=class extends Error{constructor(e,r){super(e.toString());this.error=e;this.subtype=r;this.name="ContractError"}},xn=class extends Error{constructor(e){super(e.toString());this.error=e;this.name="NonWhitelistedSourceError"}},oe=class extends Error{constructor(e){super(e.toString());this.error=e;this.name="AbortError"}},si=class{constructor(t){this.arweave=t}logger=ct.INST.create("HandlerExecutorFactory");async create(t,e,r,i){r.hasPlugin("contract-blacklist")&&await this.blacklistContracts(r,t),this.checkWhiteListContractSources(t,e);let o=null;e.useKVStorage&&(o=r.kvStorageFactory(t.txId));let a=new oi(this.arweave,{id:t.txId,owner:t.owner},e,i,o);if(r.matchPlugins("^smartweave-extension-").forEach(l=>{r.loadPlugin(l).process(a.extensions)}),t.contractType=="wasm"){this.logger.info("Creating handler for wasm contract",t.txId);let l=bt.measure(),h,w=null,v=pp(t.srcBinary);switch(t.srcWasmLang){case"rust":{let T={exports:null,modifiedExports:{wasm_bindgen__convert__closures__invoke2_mut__:null,_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__:null}},d=await mp(v,t.srcBinary),y=WebAssembly.Module.exports(d).filter(z=>z.kind==="global"&&z.name.startsWith("__WARP_CONTRACTS_VERSION_")).map(z=>z.name).shift()||"__WARP_CONTRACTS_VERSION_LEGACY",x=WebAssembly.Module.imports(d).filter(z=>z.module==="__wbindgen_placeholder__").map(z=>z.name),{imports:R,exports:N}=Rs(a,x,T,t.metadata.dtor,y);w=N,h=await WebAssembly.instantiate(d,R),T.exports=h.exports,Object.keys(h.exports).forEach(z=>{z.startsWith("wasm_bindgen__convert__closures__invoke2_mut__")&&(T.modifiedExports.wasm_bindgen__convert__closures__invoke2_mut__=h.exports[z]),z.startsWith("_dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__")&&(T.modifiedExports._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__invoke__=h.exports[z])});break}default:throw new Error(`Support for ${t.srcWasmLang} not implemented yet.`)}return this.logger.info(`WASM ${t.srcWasmLang} handler created in ${l.elapsed()}`),new ai(a,t,w||h.exports)}else{let l=Fo(t.src,r.hasPlugin("vm2"));if(l.includes("unsafeClient"))switch(e.unsafeClient){case"allow":{this.logger.warn(`Reading unsafe contract ${t.txId}, evaluation is non-deterministic!`);break}case"throw":throw new Error(`[SkipUnsafeError] Using unsafeClient is not allowed by default. Use EvaluationOptions.unsafeClient flag to evaluate ${t.txId}.`);case"skip":throw new Jt(`[SkipUnsafeError] Skipping evaluation of the unsafe contract ${t.txId}.`,"unsafeClientSkip");default:throw new Error(`Unknown unsafeClient setting ${e.unsafeClient}`)}if(!e.allowBigInt&&l.includes("BigInt"))throw new Error("Using BigInt is not allowed by default. Use EvaluationOptions.allowBigInt flag.");if(r.hasPlugin("vm2"))return r.loadPlugin("vm2").process({normalizedSource:l,swGlobal:a,logger:this.logger,contractDefinition:t});if(r.hasPlugin("ivm-handler-api"))return r.loadPlugin("ivm-handler-api").process({contractSource:t.src,evaluationOptions:e,arweave:this.arweave,swGlobal:a,contractDefinition:t});{let h=new Function(l),w=Qr()?h(a,rf,ct.INST.create(a.contract.id),nf.Buffer,atob,btoa):h(a,rf,ct.INST.create(a.contract.id));return new ci(a,t,w)}}}checkWhiteListContractSources(t,e){if(e&&e.whitelistSources.length>0&&!e.whitelistSources.includes(t.srcTxId))throw new xn(`[NonWhitelistedSourceError] Contract source not part of whitelisted sources list: ${t.srcTxId}.`)}async blacklistContracts(t,e){let r=t.loadPlugin("contract-blacklist"),i=!1;try{i=await r.process(e.txId)}catch(o){this.logger.error(o)}if(i==!0)throw new Jt(`[SkipUnsafeError] Skipping evaluation of the blacklisted contract ${e.txId}.`,"blacklistedSkip")}};function pp(n){let t={status:200,statusText:"OK",headers:{"Content-Type":"application/wasm"}};return new Response(n,t)}async function mp(n,t){return WebAssembly.compileStreaming?await WebAssembly.compileStreaming(n):await WebAssembly.compile(t)}_();_();function Ps(n){let t="";for(let e of n)t+=("0"+e.toString(16)).slice(-2);return t}var yp="".padEnd(13,"0"),Ns="".padEnd(13,"9"),Ko="".padEnd(13,"0"),of="".padEnd(64,"0"),Us="".padEnd(64,"z"),er=`${"".padStart(12,"0")},${yp},${of}`,wp=`${"".padStart(12,"9")},${Ns},${Us}`,tr=class{constructor(t){this.arweave=t}logger=ct.INST.create("LexicographicalInteractionsSorter");async sort(t){let e=[...t],r=e.map(i=>this.addSortKey(i));return await Promise.all(r),e.sort((i,o)=>i.node.sortKey.localeCompare(o.node.sortKey))}async createSortKey(t,e,r,i=!1){let o=this.arweave.utils.b64UrlToBuffer(t),a=this.arweave.utils.b64UrlToBuffer(e),c=this.arweave.utils.concatBuffers([o,a]),l=Ps(await this.arweave.crypto.hash(c));return`${`${r}`.padStart(12,"0")},${i?Ns:Ko},${l}`}extractBlockHeight(t){return t?parseInt(t.split(",")[0]):null}async addSortKey(t){let{node:e}=t,r=t.node.sortKey;r?(t.node.sortKey=r,this.logger.debug("Using sortKey from sequencer",t.node.sortKey)):t.node.sortKey=await this.createSortKey(e.block.id,e.id,e.block.height)}generateLastSortKey(t){return`${`${t}`.padStart(12,"0")},${Ns},${Us}`}};var Ws="__init",ui=(n,t)=>{let e=new Error(t);throw e.name=n,e},Bs=(o=>(o.ContractError="ContractError",o.ConstructorError="ConstructorError",o.NetworkCommunicationError="NetworkCommunicationError",o.NonWhitelistedSourceError="NonWhitelistedSourceError",o.AbortError="AbortError",o))(Bs||{}),ci=class extends Hr{constructor(e,r,i){super(e,r);this.contractFunction=i}async handle(e,r,i){let{interaction:o,interactionTx:a}=i;return this.setupSwGlobal(i),this.enableInternalWrites(e,a),this.assertNotConstructorCall(o),await this.runContractFunction(e,o,r.state)}initState(e){}async maybeCallStateConstructor(e,r){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor){let i={input:{function:Ws,args:e},caller:this.contractDefinition.owner,interactionType:"write"},o={owner:{address:r.caller,key:null},sortKey:er},a={interaction:i,interactionTx:o};this.setupSwGlobal(a);let c=this.configureSwGlobalForConstructor(),l=await this.runContractFunction(r,i,{});if(c(),l.type!=="ok")throw r.contract.isRoot()?new Error(`ConstructorError: ${l.errorMessage}`):new Jt(`ConstructorError [${r.contract.txId()}]: ${l.errorMessage}`,"constructor");return l.state}else return e}assertNotConstructorCall(e){if(this.contractDefinition.manifest?.evaluationOptions?.useConstructor&&e.input.function===Ws)throw new Error(`You have enabled {useConstructor: true} option, so you can't call function ${Ws}`)}configureSwGlobalForConstructor(){let e=a=>({get:(c,l)=>ui("ConstructorError",`SmartWeave.${a}.${String(l)} is not accessible in constructor context`)});this.swGlobal.contracts.readContractState=()=>ui("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.viewContractState=()=>ui("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.refreshState=()=>ui("ConstructorError","Internal writes feature is not available in constructor"),this.swGlobal.contracts.write=()=>ui("ConstructorError","Internal writes feature is not available in constructor");let r=new En(this.swGlobal);this.swGlobal.block=new Proxy(this.swGlobal.block,e("block"));let i=new Tn(this.swGlobal);this.swGlobal.vrf=new Proxy(this.swGlobal.vrf,e("vrf"));let o=new Sn(this.swGlobal);return this.swGlobal.transaction=new Proxy(this.swGlobal.vrf,e("transaction")),()=>{this.swGlobal.block=r,this.swGlobal.vrf=i,this.swGlobal.transaction=o}}async runContractFunction(e,r,i){let o=_r(i),{timeoutId:a,timeoutPromise:c}=Ds(e.evaluationOptions.maxInteractionEvaluationTimeSeconds);try{await this.swGlobal.kv.open(),await this.swGlobal.kv.begin();let l=await Promise.race([c,this.contractFunction(o,r)]);if(l&&(l.state!==void 0||l.result!==void 0)){await this.swGlobal.kv.commit();let h=null;return l.event&&(h={contractTxId:this.swGlobal.contract.id,sortKey:this.swGlobal.transaction.sortKey,transactionId:this.swGlobal.transaction.id,caller:r.caller,input:r.input,blockTimestamp:this.swGlobal.block.timestamp,blockHeight:this.swGlobal.block.height,data:l.event}),{type:"ok",result:l.result,state:l.state||o,event:h}}throw new Error(`Unexpected result from contract: ${JSON.stringify(l)}`)}catch(l){switch(await this.swGlobal.kv.rollback(),l.name){case"ContractError":return{type:"error",errorMessage:l.message,state:i,result:null,event:null};case"ConstructorError":throw e.contract.isRoot()?Error(`ConstructorError: ${l.message}`):new Jt(`ConstructorError [${e.contract.txId()}]: ${l.message}`,"constructor");case"NetworkCommunicationError":throw l;case"NonWhitelistedSourceError":return{type:"error",errorMessage:l.message,state:i,result:null,event:null};default:return{type:"exception",errorMessage:`${l&&l.stack||l&&l.message||l}`,state:i,result:null,event:null}}}finally{a&&clearTimeout(a),await this.swGlobal.kv.close()}}setupSwGlobal({interaction:e,interactionTx:r}){this.swGlobal._activeTx=r,this.swGlobal.caller=e.caller}enableInternalWrites(e,r){this.assignReadContractState(e,r),this.assignViewContractState(e),this.assignWrite(e),this.assignRefreshState(e)}};var li=n=>new Promise(t=>setTimeout(t,n)),fi=n=>{let t=Number.parseInt(n);if(Number.isNaN(t)&&!Number.isSafeInteger(t))throw Error(`Failed to cast ${n} to integer`);return t},_r=n=>tf(n),vp=(n,t)=>t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t,bp=(n,t)=>typeof t=="object"&&t!==null&&t.dataType==="Map"?new Map(t.value):t,_p=(n,t)=>n-t,Sp=(n,t)=>+n-+t,Ep=(n,t)=>t-n,Tp=(n,t)=>+t-+n;function Ds(n){let t=null,e=new Promise((r,i)=>{t=setTimeout(()=>{clearTimeout(t),i("timeout")},n*1e3)});return{timeoutId:t,timeoutPromise:e}}function Te(n){return n.endsWith("/")?n.slice(0,-1):n}function xe(n){return`[d:${n}]`.padEnd(n*2,"-").concat("> ")}function xp(n){let t=[];return Uint8Array.from(n).forEach(function(r){let i=r.toString(16);i.length%2&&(i="0"+i),t.push(i)}),BigInt("0x"+t.join(""))}var Qr=new Function("try {return this===window;}catch(e){ return false;}"),Me=class extends Error{constructor(e){super(e.toString());this.error=e;this.name="NetworkCommunicationError"}};async function he(n){let t;try{t=await n}catch(e){throw new Me(`Error during network communication: ${JSON.stringify(e)}`)}if(!t?.ok){let e=await t.text();throw new Me(`Wrong response code: ${t.status}. ${e}`)}try{return await t.json()}catch(e){throw new Me(`Error while parsing json response: ${JSON.stringify(e)}`)}}async function ks(n,t){return he(fetch(n,t))}function Ms(n){return/[a-z0-9_-]{43}/i.test(n)}var af=(r=>(r.ARWEAVE="arweave",r.WARP_SEQUENCER="redstone-sequencer",r.BOTH="both",r))(af||{}),zr=class{constructor(t=null,e="both"){this.confirmationStatus=t;this.source=e;Object.assign(this,t),this.source=e}_warp;logger=ct.INST.create("WarpGatewayInteractionsLoader");async load(t,e,r,i,o){this.logger.debug("Loading interactions: for ",{contractId:t,fromSortKey:e,toSortKey:r});let a=e,c=[],l=0,h=0,w=0,v=i?.transactionsPagesPerBatch||Number.MAX_SAFE_INTEGER;this.logger.debug("Pages per batch:",v);let T=i?i.sourceType:this.source,d=bt.measure(),y=Te(this._warp.gwUrl());do{let x=bt.measure();if(o?.aborted)throw new oe(`Abort signal in ${zr.name}`);let R=`${y}/gateway/v3/interactions-sort-key`;l++;let N=await he(fetch(`${R}?${new URLSearchParams({contractId:t,...this._warp.whoAmI?{client:this._warp.whoAmI}:"",...e?{from:e}:"",...r?{to:r}:"",fromSdk:"true",...this.confirmationStatus&&this.confirmationStatus.confirmed?{confirmationStatus:"confirmed"}:"",...this.confirmationStatus&&this.confirmationStatus.notCorrupted?{confirmationStatus:"not_corrupted"}:"",...T=="both"?"":{source:T}})}`));this.logger.debug(`Loading interactions: page ${l} loaded in ${x.elapsed()}`),c.push(...N.interactions),h=N.paging.limit,w=N.paging.items,e=c[c.length-1]?.sortKey,this.logger.debug(`Loaded interactions length: ${c.length}, from: ${e}, to: ${r}`)}while(w==h&&l<v);return this.logger.debug("All loaded interactions:",{from:a,to:r,loaded:c.length,time:d.elapsed()}),c}type(){return"warp"}clearCache(){}set warp(t){this._warp=t}};var Ut=class{constructor(t,e,r){this.state=t;this.validity=e;this.errorMessages=r}},hi=class{ignoreExceptions=!0;waitForConfirmation=!1;updateCacheForEachInteraction=!1;internalWrites=!1;maxCallDepth=7;maxInteractionEvaluationTimeSeconds=60;stackTrace={saveState:!1};sequencerUrl="https://d1o5nlqr4okus2.cloudfront.net/";gasLimit=Number.MAX_SAFE_INTEGER;sourceType="both";unsafeClient="throw";allowBigInt=!1;walletBalanceUrl="http://nyc-1.dev.arweave.net:1984/";mineArLocalBlocks=!0;throwOnInternalWriteError=!0;cacheEveryNInteractions=-1;useKVStorage=!1;remoteStateSyncEnabled=!1;remoteStateSyncSource="https://dre-1.warp.cc/contract";useConstructor=!1;whitelistSources=[];transactionsPagesPerBatch=null;strictSortKey=!1;strictEvolve=!0},gi=class extends Event{detail;constructor(t,e){super(t,e),this.detail=e.detail}},Fs=class{constructor(t,e,r,i,o,a,c,l){this.contractTxId=t;this.sortKey=e;this.transactionId=r;this.caller=i;this.input=o;this.blockTimestamp=a;this.blockHeight=c;this.data=l}};_();_();var mi=["application/javascript","application/wasm"],$s=class{dtor},di=class{src;srcBinary;srcWasmLang;constructor(t){this.src=t.src,this.srcBinary=t.srcBinary,this.srcWasmLang=t.srcWasmLang}},pi=class{txId;srcTxId;initState;minFee;owner;contractType;metadata;manifest;contractTx;srcTx;testnet;constructor(t){this.txId=t.txId,this.srcTxId=t.srcTxId,this.initState=t.initState,this.manifest=t.manifest,this.minFee=t.minFee,this.owner=t.owner,this.contractType=t.contractType,this.metadata=t.metadata,this.contractTx=t.contractTx,this.srcTx=t.srcTx,this.testnet=t.testnet}};_();var Tt={APP_NAME:"App-Name",APP_VERSION:"App-Version",CONTRACT_TX_ID:"Contract",INPUT:"Input",CONTENT_TYPE:"Content-Type",CONTRACT_SRC_TX_ID:"Contract-Src",SDK:"SDK",MIN_FEE:"Min-Fee"},st={SEQUENCER:"Sequencer",SEQUENCER_OWNER:"Sequencer-Owner",SEQUENCER_MILLIS:"Sequencer-Mills",SEQUENCER_SORT_KEY:"Sequencer-Sort-Key",SEQUENCER_PREV_SORT_KEY:"Sequencer-Prev-Sort-Key",SEQUENCER_LAST_SORT_KEY:"Sequencer-Last-Sort-Key",SEQUENCER_TX_ID:"Sequencer-Tx-Id",SEQUENCER_BLOCK_HEIGHT:"Sequencer-Block-Height",SEQUENCER_BLOCK_ID:"Sequencer-Block-Id",SEQUENCER_BLOCK_TIMESTAMP:"Sequencer-Block-Timestamp",INIT_STATE:"Init-State",INIT_STATE_TX:"Init-State-TX",INTERACT_WRITE:"Interact-Write",WASM_LANG:"Wasm-Lang",WASM_LANG_VERSION:"Wasm-Lang-Version",WASM_META:"Wasm-Meta",REQUEST_VRF:"Request-Vrf",SIGNATURE_TYPE:"Signature-Type",UPLOADER_TX_ID:"Uploader-Tx-Id",WARP_TESTNET:"Warp-Testnet",MANIFEST:"Contract-Manifest",NONCE:"Nonce",INPUT_FORMAT:"Input-Format"};_();var Kf=Gt(Xo()),yc=Gt(Ze());_();var Xt=Gt(Ce()),Zo=class{get(t,e){if(!Object.getOwnPropertyNames(this).includes(t))throw new Error(`Field "${t}" is not a property of the Arweave Transaction class.`);return this[t]instanceof Uint8Array?e&&e.decode&&e.string?Xt.bufferToString(this[t]):e&&e.decode&&!e.string?this[t]:Xt.bufferTob64Url(this[t]):e&&e.decode==!0?e&&e.string?Xt.b64UrlToString(this[t]):Xt.b64UrlToBuffer(this[t]):this[t]}},Yr=class extends Zo{format=2;id="";last_tx="";owner="";tags=[];target="";quantity="0";data_size="0";data=new Uint8Array;data_root="";reward="0";signature="";chunks;constructor(t={}){super(),Object.assign(this,t),typeof this.data=="string"&&(this.data=Xt.b64UrlToBuffer(this.data)),t.tags&&(this.tags=t.tags.map(e=>new Dt(e.name,e.value)))}addTag(t,e){this.tags.push(new Dt(Xt.stringToB64Url(t),Xt.stringToB64Url(e)))}toJSON(){return{format:this.format,id:this.id,last_tx:this.last_tx,owner:this.owner,tags:this.tags,target:this.target,quantity:this.quantity,data:Xt.bufferTob64Url(this.data),data_size:this.data_size,data_root:this.data_root,data_tree:this.data_tree,reward:this.reward,signature:this.signature}}setOwner(t){this.owner=t}setSignature({id:t,owner:e,reward:r,tags:i,signature:o}){this.id=t,this.owner=e,r&&(this.reward=r),i&&(this.tags=i),this.signature=o}async prepareChunks(t){throw new Error("Should not be called, use arweave-js version.")}getChunk(t,e){if(!this.chunks)throw new Error("Chunks have not been prepared");let r=this.chunks.proofs[t],i=this.chunks.chunks[t];return{data_root:this.data_root,data_size:this.data_size,data_path:Xt.bufferTob64Url(r.proof),offset:r.offset.toString(),chunk:Xt.bufferTob64Url(e.slice(i.minByteRange,i.maxByteRange))}}async getSignatureData(){throw new Error("Should not be called, use arweave-js version.")}},Dt=class extends Zo{name;value;constructor(t,e,r=!1){super(),this.name=t,this.value=e}};var Zt=class{constructor(t){this.warp=t;let{arweave:e}=t;this.baseUrl=`${e.api.config.protocol}://${e.api.config.host}:${e.api.config.port}`,this.logger.debug("baseurl",this.baseUrl)}logger=ct.INST.create("ArweaveWrapper");baseUrl;async warpGwInfo(){return await this.doFetchInfo(`${Te(this.warp.gwUrl())}/gateway/arweave/info`)}async warpGwBlock(){return this.logger.debug("Calling warp gw block info"),await this.doFetchInfo(`${Te(this.warp.gwUrl())}/gateway/arweave/block`)}async info(){return await this.doFetchInfo(`${this.baseUrl}/info`)}async gql(t,e){try{let r=JSON.stringify({query:t,variables:e});return{data:await he(fetch(`${this.baseUrl}/graphql`,{method:"POST",body:r,headers:{"Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Accept:"application/json"}})),status:200}}catch(r){throw this.logger.error("Error while loading gql",r),r}}async tx(t){let e=await fetch(`${this.baseUrl}/tx/${t}`).then(r=>r.ok?r.json():Promise.reject(r)).catch(r=>{throw r.body?.message&&this.logger.error(r.body.message),new Me(`Unable to retrieve tx ${t}. ${r.status}. ${r.body?.message}`)});return new Yr({...e})}async txData(t){let e=await fetch(`${this.baseUrl}/${t}`);if(e.ok){let r=await e.arrayBuffer();return yc.Buffer.from(r)}else{this.logger.warn(`Unable to load data from arweave.net/${t} endpoint, falling back to arweave.js`);let r=await this.warp.arweave.transactions.getData(t,{decode:!0});return yc.Buffer.from(r)}}async txDataString(t){let e=await this.txData(t);return Kf.default.utils.bufferToString(e)}async doFetchInfo(t){return await he(fetch(t))}};_();var jt=class{logger=ct.INST.create("TagsParser");getInputTag(t,e){if(jt.hasMultipleInteractions(t)){this.logger.debug("Interaction transaction is using multiple input tx tag format.");let r=t.tags.findIndex(o=>o.name===Tt.CONTRACT_TX_ID&&o.value===e);if(t.tags.length-1===r){this.logger.warn("Wrong tags format: 'Contract' is the last tag");return}let i=t.tags[r+1];if(i.name!==Tt.INPUT){this.logger.warn(`No 'Input' tag found after 'Contract' tag. Instead ${i.name} was found`);return}return i}else return t.tags.find(r=>r.name===Tt.INPUT)}isInteractWrite(t,e){return t.tags.some(r=>r.name===st.INTERACT_WRITE&&r.value===e)}getInteractWritesContracts(t){return t.tags.filter(e=>e.name===st.INTERACT_WRITE).map(e=>e.value)}getContractTag(t){return t.tags.find(e=>e.name===Tt.CONTRACT_TX_ID)?.value}getContractsWithInputs(t){let e=new Map;return t.tags.filter(i=>i.name===Tt.CONTRACT_TX_ID).forEach(i=>{e.set(i.value,this.getInputTag(t,i.value))}),e}isEvmSigned(t){return t.tags.some(e=>e.name===st.SIGNATURE_TYPE&&e.value==="ethereum")}static hasMultipleInteractions(t){return t.tags.filter(e=>e.name===Tt.CONTRACT_TX_ID).length>1}decodeTags(t){let e=t.get("tags"),r=[];for(let i of e)try{let o=i.get("name",{decode:!0,string:!0}),a=i.get("value",{decode:!0,string:!0});r.push({name:o,value:a})}catch{}return r}getTag(t,e){let r=t.get("tags");for(let i of r)try{if(i.get("name",{decode:!0,string:!0})===e)return i.get("value",{decode:!0,string:!0})}catch{}return!1}hasVrfTag(t){return t.tags.some(e=>e.name==st.REQUEST_VRF&&e.value==="true")}};_();_();function Qf(n){return n.arrayBuffer?n.arrayBuffer():new Promise((t,e)=>{let r=new FileReader;r.addEventListener("loadend",()=>{t(r.result)}),r.addEventListener("error",e),r.readAsArrayBuffer(n)})}async function im(n){let t=await Qf(n);return new Uint8Array(t)}function zf(n){return typeof Blob<"u"&&n instanceof Blob}function Bi(n){return typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer}var om=typeof $.default<"u"&&$.default.versions&&typeof $.default.versions.node<"u"&&typeof $.default.versions.electron>"u";function am(n){return n.byteOffset===0&&n.byteLength===n.buffer.byteLength}var ea=class{constructor(t){this.typedArray=t instanceof ArrayBuffer||Bi(t)?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}async getLength(){return this.typedArray.byteLength}async read(t,e){return new Uint8Array(this.typedArray.buffer,this.typedArray.byteOffset+t,e)}},ra=class{constructor(t){this.blob=t}async getLength(){return this.blob.size}async read(t,e){let r=this.blob.slice(t,t+e),i=await Qf(r);return new Uint8Array(i)}async sliceAsBlob(t,e,r=""){return this.blob.slice(t,t+e,r)}};function sm(n,t){var e=Uint8Array;if(n[0]==3&&n[1]==0)return t||new e(0);var r=um,i=Yf,o=cm,a=Jf,c=t==null;c&&(t=new e(n.length>>>2<<3));for(var l=0,h=0,w=0,v=0,T=0,d=0,y=0,x=0,R=0,N,j;l==0;){if(l=r(n,R,1),h=r(n,R+1,2),R+=3,h==0){R&7&&(R+=8-(R&7));var z=(R>>>3)+4,Z=n[z-4]|n[z-3]<<8;c&&(t=wc(t,x+Z)),t.set(new e(n.buffer,n.byteOffset+z,Z),x),R=z+Z<<3,x+=Z;continue}if(c&&(t=wc(t,x+(1<<17))),h==1&&(N=ut.flmap,j=ut.fdmap,d=(1<<9)-1,y=(1<<5)-1),h==2){w=i(n,R,5)+257,v=i(n,R+5,5)+1,T=i(n,R+10,4)+4,R+=14;for(var W=0;W<38;W+=2)ut.itree[W]=0,ut.itree[W+1]=0;for(var V=1,W=0;W<T;W++){var ot=i(n,R+W*3,3);ut.itree[(ut.ordr[W]<<1)+1]=ot,ot>V&&(V=ot)}R+=3*T,ki(ut.itree,V),Ri(ut.itree,V,ut.imap),N=ut.lmap,j=ut.dmap,R=o(ut.imap,(1<<V)-1,w+v,n,R,ut.ttree);var nt=Vf(ut.ttree,0,w,ut.ltree);d=(1<<nt)-1;var G=Vf(ut.ttree,w,v,ut.dtree);y=(1<<G)-1,ki(ut.ltree,nt),Ri(ut.ltree,nt,N),ki(ut.dtree,G),Ri(ut.dtree,G,j)}for(;;){var J=N[a(n,R)&d];R+=J&15;var rt=J>>>4;if(!(rt>>>8))t[x++]=rt;else{if(rt==256)break;var ht=x+rt-254;if(rt>264){var yt=ut.ldef[rt-257];ht=x+(yt>>>3)+i(n,R,yt&7),R+=yt&7}var lt=j[a(n,R)&y];R+=lt&15;var Nt=lt>>>4,Lt=ut.ddef[Nt],tt=(Lt>>>4)+r(n,R,Lt&15);for(R+=Lt&15,c&&(t=wc(t,x+(1<<17)));x<ht;)t[x]=t[x++-tt],t[x]=t[x++-tt],t[x]=t[x++-tt],t[x]=t[x++-tt];x=ht}}}return t.length==x?t:t.slice(0,x)}function wc(n,t){var e=n.length;if(t<=e)return n;var r=new Uint8Array(Math.max(e<<1,t));return r.set(n,0),r}function cm(n,t,e,r,i,o){for(var a=Yf,c=Jf,l=0;l<e;){var h=n[c(r,i)&t];i+=h&15;var w=h>>>4;if(w<=15)o[l]=w,l++;else{var v=0,T=0;w==16?(T=3+a(r,i,2),i+=2,v=o[l-1]):w==17?(T=3+a(r,i,3),i+=3):w==18&&(T=11+a(r,i,7),i+=7);for(var d=l+T;l<d;)o[l]=v,l++}}return i}function Vf(n,t,e,r){for(var i=0,o=0,a=r.length>>>1;o<e;){var c=n[o+t];r[o<<1]=0,r[(o<<1)+1]=c,c>i&&(i=c),o++}for(;o<a;)r[o<<1]=0,r[(o<<1)+1]=0,o++;return i}function ki(n,t){for(var e=n.length,r,i,o,a,c,l=ut.bl_count,a=0;a<=t;a++)l[a]=0;for(a=1;a<e;a+=2)l[n[a]]++;var h=ut.next_code;for(r=0,l[0]=0,i=1;i<=t;i++)r=r+l[i-1]<<1,h[i]=r;for(o=0;o<e;o+=2)c=n[o+1],c!=0&&(n[o]=h[c],h[c]++)}function Ri(n,t,e){for(var r=n.length,i=ut.rev15,o=0;o<r;o+=2)if(n[o+1]!=0)for(var a=o>>1,c=n[o+1],l=a<<4|c,h=t-c,w=n[o]<<h,v=w+(1<<h);w!=v;){var T=i[w]>>>15-t;e[T]=l,w++}}function Gf(n,t){for(var e=ut.rev15,r=15-t,i=0;i<n.length;i+=2){var o=n[i]<<t-n[i+1];n[i]=e[o]>>>r}}function Yf(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8)>>>(t&7)&(1<<e)-1}function um(n,t,e){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)&(1<<e)-1}function Jf(n,t){return(n[t>>>3]|n[(t>>>3)+1]<<8|n[(t>>>3)+2]<<16)>>>(t&7)}var ut=function(){var n=Uint16Array,t=Uint32Array;return{next_code:new n(16),bl_count:new n(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new n(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new n(512),fltree:[],fdmap:new n(32),fdtree:[],lmap:new n(32768),ltree:[],ttree:[],dmap:new n(32768),dtree:[],imap:new n(512),itree:[],rev15:new n(1<<15),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new n(1<<16),prev:new n(1<<15)}}();(function(){for(var n=32768,t=0;t<n;t++){var e=t;e=(e&2863311530)>>>1|(e&1431655765)<<1,e=(e&3435973836)>>>2|(e&858993459)<<2,e=(e&4042322160)>>>4|(e&252645135)<<4,e=(e&4278255360)>>>8|(e&16711935)<<8,ut.rev15[t]=(e>>>16|e<<16)>>>17}function r(i,o,a){for(;o--!=0;)i.push(0,a)}for(var t=0;t<32;t++)ut.ldef[t]=ut.of0[t]<<3|ut.exb[t],ut.ddef[t]=ut.df0[t]<<4|ut.dxb[t];r(ut.fltree,144,8),r(ut.fltree,255-143,9),r(ut.fltree,279-255,7),r(ut.fltree,287-279,8),ki(ut.fltree,9),Ri(ut.fltree,9,ut.flmap),Gf(ut.fltree,9),r(ut.fdtree,32,5),ki(ut.fdtree,5),Ri(ut.fdtree,5,ut.fdmap),Gf(ut.fdtree,5),r(ut.itree,19,0),r(ut.ltree,286,0),r(ut.dtree,30,0),r(ut.ttree,320,0)})();var qf={table:function(){for(var n=new Uint32Array(256),t=0;t<256;t++){for(var e=t,r=0;r<8;r++)e&1?e=3988292384^e>>>1:e=e>>>1;n[t]=e}return n}(),update:function(n,t,e,r){for(var i=0;i<r;i++)n=qf.table[(n^t[e+i])&255]^n>>>8;return n},crc:function(n,t,e){return qf.update(4294967295,n,t,e)^4294967295}};function lm(n,t){return sm(n,t)}var Pi={numWorkers:1,workerURL:"",useWorkers:!1},fm=0,jf=0,_c=!0,hm=[],ta=[],kn=[],Sc=new Map;function gm(n){Xf(n.target);let{id:t,error:e,data:r}=n.data,i=Sc.get(t);Sc.delete(t),e?i.reject(e):i.resolve(r)}function vc(n){return new Promise((t,e)=>{let r=new Worker(n);r.onmessage=i=>{i.data==="start"?(r.onerror=void 0,r.onmessage=void 0,t(r)):e(new Error(`unexpected message: ${i.data}`))},r.onerror=e})}function dm(n,t){return n.require?n.require(t):{}}var Hf=function(){if(om){let{Worker:n}=dm(module,"worker_threads");return{async createWorker(t){return new n(t)},addEventListener(t,e){t.on("message",r=>{e({target:t,data:r})})},async terminate(t){await t.terminate()}}}else return{async createWorker(n){try{return await vc(n)}catch{console.warn("could not load worker:",n)}let t;try{let e=await fetch(n,{mode:"cors"});if(!e.ok)throw new Error(`could not load: ${n}`);t=await e.text(),n=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));let r=await vc(n);return Pi.workerURL=n,r}catch{console.warn("could not load worker via fetch:",n)}if(t!==void 0)try{n=`data:application/javascript;base64,${btoa(t)}`;let e=await vc(n);return Pi.workerURL=n,e}catch{console.warn("could not load worker via dataURI")}throw console.warn("workers will not be used"),new Error("can not start workers")},addEventListener(n,t){n.addEventListener("message",t)},async terminate(n){n.terminate()}}}();function Xf(n){ta.push(n),Zf()}async function pm(){if(ta.length===0&&jf<Pi.numWorkers){++jf;try{let n=await Hf.createWorker(Pi.workerURL);hm.push(n),ta.push(n),Hf.addEventListener(n,gm)}catch{_c=!1}}return ta.pop()}function mm(n,t,e,r){let i=new Uint8Array(t);lm(n,i),r(e?new Blob([i],{type:e}):i.buffer)}async function Zf(){if(kn.length!==0){if(Pi.useWorkers&&_c){let n=await pm();if(_c){if(n){if(kn.length===0){Xf(n);return}let{id:t,src:e,uncompressedSize:r,type:i,resolve:o,reject:a}=kn.shift();Sc.set(t,{id:t,resolve:o,reject:a});let c=[];n.postMessage({type:"inflate",data:{id:t,type:i,src:e,uncompressedSize:r}},c)}return}}for(;kn.length;){let{src:n,uncompressedSize:t,type:e,resolve:r}=kn.shift(),i=n;zf(n)&&(i=await im(n)),mm(i,t,e,r)}}}function th(n,t,e){return new Promise((r,i)=>{kn.push({src:n,uncompressedSize:t,type:e,resolve:r,reject:i,id:fm++}),Zf()})}function ym(n,t){let e=n&31,r=(n>>5&15)-1,i=(n>>9&127)+1980,o=0,a=(t&31)*2,c=t>>5&63,l=t>>11&31;return new Date(i,r,e,l,c,a,o)}var Ec=class{constructor(t,e){this._reader=t,this._rawEntry=e,this.name=e.name,this.nameBytes=e.nameBytes,this.size=e.uncompressedSize,this.compressedSize=e.compressedSize,this.comment=e.comment,this.commentBytes=e.commentBytes,this.compressionMethod=e.compressionMethod,this.lastModDate=ym(e.lastModFileDate,e.lastModFileTime),this.isDirectory=e.uncompressedSize===0&&e.name.endsWith("/"),this.encrypted=!!(e.generalPurposeBitFlag&1),this.externalFileAttributes=e.externalFileAttributes,this.versionMadeBy=e.versionMadeBy}async blob(t="application/octet-stream"){return await Am(this._reader,this._rawEntry,t)}async arrayBuffer(){return await Im(this._reader,this._rawEntry)}async text(){let t=await this.arrayBuffer();return Oi(new Uint8Array(t))}async json(){let t=await this.text();return JSON.parse(t)}},bc=22,wm=65535,vm=101010256,bm=101075792;async function Rn(n,t,e){return await n.read(t,e)}async function Tc(n,t,e,r){return n.sliceAsBlob?await n.sliceAsBlob(t,e,r):await n.read(t,e)}var _m={unsigned(){return 0}};function Ht(n,t){return n[t]+n[t+1]*256}function te(n,t){return n[t]+n[t+1]*256+n[t+2]*65536+n[t+3]*16777216}function Jr(n,t){return te(n,t)+te(n,t+4)*4294967296}var Sm=new TextDecoder;function Oi(n,t){return Bi(n.buffer)&&(n=new Uint8Array(n)),Sm.decode(n)}async function Em(n,t){let e=Math.min(bc+wm,t),r=t-e,i=await Rn(n,r,e);for(let o=e-bc;o>=0;--o){if(te(i,o)!==vm)continue;let a=new Uint8Array(i.buffer,i.byteOffset+o,i.byteLength-o),c=Ht(a,4);if(c!==0)throw new Error(`multi-volume zip files are not supported. This is volume: ${c}`);let l=Ht(a,10),h=te(a,12),w=te(a,16),v=Ht(a,20),T=a.length-bc;if(v!==T)throw new Error(`invalid comment length. expected: ${T}, actual: ${v}`);let d=new Uint8Array(a.buffer,a.byteOffset+22,v),y=Oi(d);return l===65535||w===4294967295?await xm(n,r+o,y,d):await eh(n,w,h,l,y,d)}throw new Error("could not find end of central directory. maybe not zip file")}var Tm=117853008;async function xm(n,t,e,r){let i=t-20,o=await Rn(n,i,20);if(te(o,0)!==Tm)throw new Error("invalid zip64 end of central directory locator signature");let a=Jr(o,8),c=await Rn(n,a,56);if(te(c,0)!==bm)throw new Error("invalid zip64 end of central directory record signature");let l=Jr(c,32),h=Jr(c,40),w=Jr(c,48);return eh(n,w,h,l,e,r)}var Cm=33639248;async function eh(n,t,e,r,i,o){let a=0,c=await Rn(n,t,e),l=[];for(let w=0;w<r;++w){let v=c.subarray(a,a+46),T=te(v,0);if(T!==Cm)throw new Error(`invalid central directory file header signature: 0x${T.toString(16)}`);let d={versionMadeBy:Ht(v,4),versionNeededToExtract:Ht(v,6),generalPurposeBitFlag:Ht(v,8),compressionMethod:Ht(v,10),lastModFileTime:Ht(v,12),lastModFileDate:Ht(v,14),crc32:te(v,16),compressedSize:te(v,20),uncompressedSize:te(v,24),fileNameLength:Ht(v,28),extraFieldLength:Ht(v,30),fileCommentLength:Ht(v,32),internalFileAttributes:Ht(v,36),externalFileAttributes:te(v,38),relativeOffsetOfLocalHeader:te(v,42)};if(d.generalPurposeBitFlag&64)throw new Error("strong encryption is not supported");a+=46;let y=c.subarray(a,a+d.fileNameLength+d.extraFieldLength+d.fileCommentLength);d.nameBytes=y.slice(0,d.fileNameLength),d.name=Oi(d.nameBytes);let x=d.fileNameLength+d.extraFieldLength,R=y.slice(d.fileNameLength,x);d.extraFields=[];let N=0;for(;N<R.length-3;){let z=Ht(R,N+0),Z=Ht(R,N+2),W=N+4,V=W+Z;if(V>R.length)throw new Error("extra field length exceeds extra field buffer size");d.extraFields.push({id:z,data:R.slice(W,V)}),N=V}if(d.commentBytes=y.slice(x,x+d.fileCommentLength),d.comment=Oi(d.commentBytes),a+=y.length,d.uncompressedSize===4294967295||d.compressedSize===4294967295||d.relativeOffsetOfLocalHeader===4294967295){let z=d.extraFields.find(V=>V.id===1);if(!z)throw new Error("expected zip64 extended information extra field");let Z=z.data,W=0;if(d.uncompressedSize===4294967295){if(W+8>Z.length)throw new Error("zip64 extended information extra field does not include uncompressed size");d.uncompressedSize=Jr(Z,W),W+=8}if(d.compressedSize===4294967295){if(W+8>Z.length)throw new Error("zip64 extended information extra field does not include compressed size");d.compressedSize=Jr(Z,W),W+=8}if(d.relativeOffsetOfLocalHeader===4294967295){if(W+8>Z.length)throw new Error("zip64 extended information extra field does not include relative header offset");d.relativeOffsetOfLocalHeader=Jr(Z,W),W+=8}}let j=d.extraFields.find(z=>z.id===28789&&z.data.length>=6&&z.data[0]===1&&te(z.data,1),_m.unsigned(d.nameBytes));if(j&&(d.fileName=Oi(j.data.slice(5))),d.compressionMethod===0){let z=d.uncompressedSize;if(d.generalPurposeBitFlag&1&&(z+=12),d.compressedSize!==z)throw new Error(`compressed size mismatch for stored file: ${d.compressedSize} != ${z}`)}l.push(d)}return{zip:{comment:i,commentBytes:o},entries:l.map(w=>new Ec(n,w))}}async function rh(n,t){if(t.generalPurposeBitFlag&1)throw new Error("encrypted entries not supported");let e=await Rn(n,t.relativeOffsetOfLocalHeader,30),r=await n.getLength(),i=te(e,0);if(i!==67324752)throw new Error(`invalid local file header signature: 0x${i.toString(16)}`);let o=Ht(e,26),a=Ht(e,28),c=t.relativeOffsetOfLocalHeader+e.length+o+a,l;if(t.compressionMethod===0)l=!1;else if(t.compressionMethod===8)l=!0;else throw new Error(`unsupported compression method: ${t.compressionMethod}`);let h=c,w=h+t.compressedSize;if(t.compressedSize!==0&&w>r)throw new Error(`file data overflows file bounds: ${h} +  ${t.compressedSize}  > ${r}`);return{decompress:l,fileDataStart:h}}async function Im(n,t){let{decompress:e,fileDataStart:r}=await rh(n,t);if(!e){let a=await Rn(n,r,t.compressedSize);return am(a)?a.buffer:a.slice().buffer}let i=await Tc(n,r,t.compressedSize);return await th(i,t.uncompressedSize)}async function Am(n,t,e){let{decompress:r,fileDataStart:i}=await rh(n,t);if(!r){let c=await Tc(n,i,t.compressedSize,e);return zf(c)?c:new Blob([Bi(c.buffer)?new Uint8Array(c):c],{type:e})}let o=await Tc(n,i,t.compressedSize);return await th(o,t.uncompressedSize,e)}async function Lm(n){let t;if(typeof Blob<"u"&&n instanceof Blob)t=new ra(n);else if(n instanceof ArrayBuffer||n&&n.buffer&&n.buffer instanceof ArrayBuffer)t=new ea(n);else if(Bi(n)||Bi(n.buffer))t=new ea(n);else if(typeof n=="string"){let r=await fetch(n);if(!r.ok)throw new Error(`failed http request ${n}, status: ${r.status}: ${r.statusText}`);let i=await r.blob();t=new ra(i)}else if(typeof n.getLength=="function"&&typeof n.read=="function")t=n;else throw new Error("unsupported source type");let e=await t.getLength();if(e>Number.MAX_SAFE_INTEGER)throw new Error(`file too large. size: ${e}. Only file sizes up 4503599627370496 bytes are supported`);return await Em(t,e)}async function nh(n){let{zip:t,entries:e}=await Lm(n);return{zip:t,entries:Object.fromEntries(e.map(r=>[r.name,r]))}}var ih=Gt(Ze());var nr=class{constructor(t){this.src=t;this.splitted=this.splitBuffer(t),this.logger.debug(`Buffer splitted into ${this.splitted.length} parts`)}logger=ct.INST.create("WasmSrc");splitted;wasmBinary(){return this.splitted[0]}async sourceCode(){let{entries:t}=await nh(this.splitted[1]),e=new Map;for(let[r,i]of Object.entries(t)){if(i.isDirectory)continue;let o=await i.text();e.set(r,o)}return e}additionalCode(){return this.splitted.length==2?null:this.splitted[2].toString()}splitBuffer(t){let e="",r=parseInt(t.toString("utf8",0,1));this.logger.debug(`Number of elements: ${r}`);let i=t.length,o=0,a=0;for(let h=2;h<i;h++){let w=t.toString("utf8",h,h+1);if(w=="|"&&o++,o==r){a=h+1;break}e+=w}this.logger.debug("Parsed:",{header:e,dataStart:a});let c=e.split("|").map(h=>parseInt(h));this.logger.debug("Lengths",c);let l=[];for(let h of c){let w=ih.Buffer.alloc(h),v=a+h;t.copy(w,0,a,v),a=v,l.push(w)}return l}};var Xr=class{constructor(t,e){this.arweave=t;this.env=e;this.tagsParser=new jt}logger=ct.INST.create("ContractDefinitionLoader");arweaveWrapper;tagsParser;async load(t,e){let r=bt.measure(),i=await this.doLoad(t,e);return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),i}async doLoad(t,e){let r=bt.measure(),i=await this.arweaveWrapper.tx(t),o=await this.arweave.wallets.ownerToAddress(i.owner);this.logger.debug("Contract tx and owner",r.elapsed()),r.reset();let a=e||this.tagsParser.getTag(i,Tt.CONTRACT_SRC_TX_ID),c=this.tagsParser.getTag(i,st.WARP_TESTNET)||null;if(c&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!c&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let l=this.tagsParser.getTag(i,Tt.MIN_FEE),h=null,w=this.tagsParser.getTag(i,st.MANIFEST);w&&(h=JSON.parse(w)),this.logger.debug("Tags decoding",r.elapsed()),r.reset();let v=await this.evalInitialState(i);this.logger.debug("init state",v);let T=JSON.parse(v);this.logger.debug("Parsing src and init state",r.elapsed());let{src:d,srcBinary:y,srcWasmLang:x,contractType:R,metadata:N,srcTx:j}=await this.loadContractSource(a);return{txId:t,srcTxId:a,src:d,srcBinary:y,srcWasmLang:x,initState:T,minFee:l,owner:o,contractType:R,metadata:N,manifest:h,contractTx:i.toJSON(),srcTx:j,testnet:c}}async loadContractSource(t){let e=bt.measure(),r=await this.arweaveWrapper.tx(t),i=this.tagsParser.getTag(r,Tt.CONTENT_TYPE);if(!mi.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i=="application/javascript"?"js":"wasm",a=o=="js"?await this.arweaveWrapper.txDataString(t):await this.arweaveWrapper.txData(t),c,l,h;if(o=="wasm"){if(l=new nr(a),c=this.tagsParser.getTag(r,st.WASM_LANG),!c)throw new Error(`Wasm lang not set for wasm contract src ${t}`);h=JSON.parse(this.tagsParser.getTag(r,st.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?l.wasmBinary():null,srcWasmLang:c,contractType:o,metadata:h,srcTx:r.toJSON()}}async evalInitialState(t){if(this.tagsParser.getTag(t,st.INIT_STATE))return this.tagsParser.getTag(t,st.INIT_STATE);if(this.tagsParser.getTag(t,st.INIT_STATE_TX)){let e=this.tagsParser.getTag(t,st.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}type(){return"arweave"}set warp(t){this.arweaveWrapper=new Zt(t)}};_();var xc=Gt(Ze());var Ni=class{rLogger=ct.INST.create("WarpGatewayContractDefinitionLoader");contractDefinitionLoader;arweaveWrapper;tagsParser;_warp;constructor(t,e){this.contractDefinitionLoader=new Xr(t,e),this.tagsParser=new jt}async load(t,e){try{let r=Te(this._warp.gwUrl()),i=await he(fetch(`${r}/gateway/contract?txId=${t}${e?`&srcTxId=${e}`:""}`));if(i.srcBinary!=null&&!(i.srcBinary instanceof xc.Buffer)&&(i.srcBinary=xc.Buffer.from(i.srcBinary.data)),i.srcBinary){let o=new nr(i.srcBinary);i.srcBinary=o.wasmBinary();let a;i.srcTx?a=new Yr({...i.srcTx}):a=await this.arweaveWrapper.tx(i.srcTxId);let c=JSON.parse(this.tagsParser.getTag(a,st.WASM_META));i.metadata=c}return i.contractType=i.src?"js":"wasm",i}catch(r){return this.rLogger.warn("Falling back to default contracts loader",r),await this.contractDefinitionLoader.doLoad(t,e)}}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return"warp"}set warp(t){this._warp=t,this.arweaveWrapper=new Zt(t),this.contractDefinitionLoader.warp=t}};_();_();var oh=`query Transactions($tags: [TagFilter!]!, $blockFilter: BlockFilter!, $first: Int!, $after: String) {
    transactions(tags: $tags, block: $blockFilter, first: $first, sort: HEIGHT_ASC, after: $after) {
      pageInfo {
        hasNextPage
      }
      edges {
        node {
          id
          owner { address }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston }
          quantity { winston }
          parent { id }
          bundledIn { id }
        }
        cursor
      }
    }
  }`,km=`query Transaction($id: ID!) {
  transaction(id: $id) {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          bundledIn { id }
    			parent{ id }
          signature
        }
}`,Rm=`query Transactions($tags: [TagFilter!]!) {
  transactions(tags: $tags) {
      edges {
        node {
          id
          owner { address, key }
          recipient
          tags {
            name
            value
          }
          block {
            height
            id
            timestamp
          }
          fee { winston, ar }
          quantity { winston, ar }
          parent { id }
          bundledIn { id }
          signature
        }
      }
  }
}`,ah=30*1e3,Om=100,_e=class{constructor(t){this.warp=t;this.arweaveWrapper=new Zt(t)}arweaveWrapper;logger=ct.INST.create(_e.name);async transaction(t){return(await this.fetch(km,{id:t})).transaction}async transactionUsingUploaderTag(t){let e={name:st.UPLOADER_TX_ID,values:[t]},r=(await this.fetch(Rm,{tags:[e]})).transactions;if(r.edges.length<1)throw new Error(`No interaction with tag ${st.UPLOADER_TX_ID}:${t}`);return r.edges[0].node}async transactions(t,e,r){let i=(await this.fetch(oh,t)).transactions,o=[...i.edges],a=1;if(a>=e)return o;if(r?.aborted)throw new oe(`Abort signal in ${_e.name}`);for(;i.pageInfo.hasNextPage&&a<e;){if(r?.aborted)throw new oe(`Abort signal in ${_e.name}`);let c=i.edges[Om-1].cursor,l={...t,after:c};i=(await this.fetch(oh,l)).transactions,o.push(...i.edges),a++}return o}async fetch(t,e){let r=bt.measure(),i=await this.arweaveWrapper.gql(t,e);for(this.logger.debug("GQL page load:",r.elapsed());i.status===403;)this.logger.warn(`GQL rate limiting, waiting ${ah}ms before next try.`),await li(ah),i=await this.arweaveWrapper.gql(t,e);if(i.status!==200)throw new Error(`Unable to retrieve transactions. Arweave gateway responded with status ${i.status}.`);if(i.data.errors)throw this.logger.error(i.data.errors),new Error("Error while fetching arweave transactions");return i.data.data}};var sh=100;function Cc(n){return!n.node.parent?.id&&!n.node.bundledIn?.id}var Ui=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new tr(t)}logger=ct.INST.create("ArweaveGatewayInteractionsLoader");sorter;arweaveTransactionQuery;_warp;tagsParser=new jt;async load(t,e,r,i,o){this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r});let a=this.sorter.extractBlockHeight(e),c=this.sorter.extractBlockHeight(r),l=i?.transactionsPagesPerBatch||Number.MAX_SAFE_INTEGER;this.logger.debug("Pages per batch",l);let h={tags:[{name:Tt.APP_NAME,values:["SmartWeaveAction"]},{name:Tt.CONTRACT_TX_ID,values:[t]}],blockFilter:{min:a,max:c},first:sh},w=bt.measure(),v=(await this.arweaveTransactionQuery.transactions(h,l,o)).filter(Cc);if(w.stop(),i?.transactionsPagesPerBatch&&v.length>0&&(v=await this.sorter.sort(v),c=v[v.length-1].node.block.height),i.internalWrites){let N=function(){return i?.transactionsPagesPerBatch?v.length>0?Number.MAX_SAFE_INTEGER:i?.transactionsPagesPerBatch:Number.MAX_SAFE_INTEGER}(),j={tags:[{name:st.INTERACT_WRITE,values:[t]}],blockFilter:{min:a,max:c},first:sh},z=(await this.arweaveTransactionQuery.transactions(j,N,o)).filter(Cc);this.logger.debug("Inner writes interactions length:",z.length),v=v.concat(z)}v=v.filter(N=>N.node.block&&N.node.block.id&&N.node.block.height);let T=new Map;for(let N of v)T.has(N.node.id)||T.set(N.node.id,N);let d=Array.from(T.values()),y=await this.sorter.sort(d);e&&r?y=y.filter(N=>N.node.sortKey.localeCompare(e)>0&&N.node.sortKey.localeCompare(r)<=0):e&&!r?y=y.filter(N=>N.node.sortKey.localeCompare(e)>0):!e&&r&&(y=y.filter(N=>N.node.sortKey.localeCompare(r)<=0)),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:y.length,time:w.elapsed()});let x=this.environment==="local"||this.environment==="testnet",R=this._warp.maybeLoadPlugin("vrf");return y.map(N=>{let j=N.node;return x&&this.tagsParser.hasVrfTag(j)&&(R?j.vrf=R.process().generateMockVrf(j.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),j})}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveTransactionQuery=new _e(t),this._warp=t}};_();var On=class{constructor(t){this.delegate=t}logger=ct.INST.create("CacheableInteractionsLoader");interactionsCache=new Map;async load(t,e,r,i){if(this.logger.debug("Loading interactions for",{contractTxId:t,fromSortKey:e,toSortKey:r}),this.interactionsCache.has(t)){let o=this.interactionsCache.get(t);if(o?.length){let a=o[o.length-1].sortKey;if(a.localeCompare(r)<0){let c=await this.delegate.load(t,a,r,i),l=o.concat(c);return this.interactionsCache.set(t,l),l}}return o}else{let o=await this.delegate.load(t,e,r,i);return o.length&&this.interactionsCache.set(t,o),o}}type(){return this.delegate.type()}clearCache(){this.interactionsCache.clear()}set warp(t){this.delegate.warp=t}};_();var Zr=class{constructor(t,e=[]){this.arweave=t;this.executionContextModifiers=e}logger=ct.INST.create("DefaultStateEvaluator");tagsParser=new jt;async eval(t){return this.doReadState(t.sortedInteractions,new Ut(t.contractDefinition.initState,{},{}),t)}async doReadState(t,e,r){let{ignoreExceptions:i,stackTrace:o,internalWrites:a}=r.evaluationOptions,{contract:c,contractDefinition:l,sortedInteractions:h,warp:w,signal:v}=r,T=e.state,d=null,y=e.validity,x=e.errorMessages;r?.handler.initState(T);let R=r.contract.callDepth();this.logger.debug(`${xe(R)}Evaluating state for ${l.txId} [${t.length} non-cached of ${h.length} all]`);let N=null,j=null,z=t.length,Z=w.maybeLoadPlugin("evm-signature-verification"),W=w.maybeLoadPlugin("evaluation-progress"),V=w.maybeLoadPlugin("vrf"),ot=!1;for(let G=0;G<z&&!ot;G++){if(v?.aborted)throw new oe(`Abort signal in ${Zr.name}`);let J=t[G];d=J.sortKey,c.interactionState().setInitial(c.txId(),new Ut(T,y,x),d);let rt=bt.measure();if(J.vrf){if(!V)this.logger.warn('Cannot verify vrf for interaction - no "warp-contracts-plugin-vrf" attached!');else if(!V.process().verify(J.vrf,J.sortKey))throw new Error("Vrf verification failed.")}if(Z&&this.tagsParser.isEvmSigned(J))try{if(!await Z.process(J)){this.logger.warn(`Interaction ${J.id} was not verified, skipping.`);continue}}catch(lt){this.logger.error(lt);continue}if(this.logger.debug(`${xe(R)}[${l.txId}][${J.id}][${J.block.height}]: ${t.indexOf(J)+1}/${t.length} [of all:${h.length}]`),this.tagsParser.isInteractWrite(J,l.txId)&&a){let lt=this.tagsParser.getContractTag(J);this.logger.debug(`${xe(R)}Internal Write - Loading writing contract`,lt);let Nt=c.getCallStack().addInteractionData({interaction:null,interactionTx:J}),Lt=w.contract(lt,r.contract,{callingInteraction:J,callType:"read"});this.logger.debug(`${xe(R)}Reading state of the calling contract at`,J.sortKey);let tt=null,Kt=null;try{Kt=await Lt.readState(J.sortKey,void 0,v),tt=c.interactionState().get(c.txId(),J.sortKey)}catch(wt){if(wt.name=="ContractError"&&(wt.subtype=="unsafeClientSkip"||wt.subtype=="constructor"||wt.subtype=="blacklistedSkip")||wt.name=="NonWhitelistedSourceError"){if(this.logger.warn(`Skipping contract in internal write, reason ${wt.subtype||wt.name}`),x[J.id]=wt,Ic(J)){let ee=new Ut(T,y,x);j={tx:J,state:ee}}}else throw wt}if(tt!==null&&Kt!==null){let wt=Kt.cachedValue.validity[J.id];wt&&(T=tt.state),r?.handler.initState(T),wt?(y[J.id]=tt.validity[J.id],tt.errorMessages?.[J.id]&&(x[J.id]=tt.errorMessages[J.id])):(y[J.id]=!1,x[J.id]=Kt.cachedValue.errorMessages[J.id]);let ee=new Ut(T,y,x);Ic(J)&&(j={tx:J,state:ee})}else y[J.id]=!1;Nt.update({cacheHit:!1,outputState:o.saveState?T:void 0,executionTime:rt.elapsed(!0),valid:y[J.id],errorMessage:N,gasUsed:0})}else{let lt=this.tagsParser.getInputTag(J,r.contractDefinition.txId);if(!lt){this.logger.error(`${xe(R)}Skipping tx - Input tag not found for ${J.id}`);continue}let Nt=this.parseInput(lt);if(!Nt){this.logger.error(`${xe(R)}Skipping tx - invalid Input tag - ${J.id}`);continue}let Lt={input:Nt,caller:J.owner.address,interactionType:"write"},tt={interaction:Lt,interactionTx:J},Kt=c.getCallStack().addInteractionData(tt),wt=await r.handler.handle(r,new Ut(T,y,x),tt);N=wt.errorMessage,wt.type!=="ok"&&(x[J.id]=N);let ee=wt.type==="ok";if(y[J.id]=ee,this.logResult(wt,J,r),this.logger.debug(`${xe(R)}Interaction evaluation`,rt.elapsed()),Kt.update({cacheHit:!1,outputState:o.saveState?T:void 0,executionTime:rt.elapsed(!0),valid:y[J.id],errorMessage:N,gasUsed:wt.gasUsed}),wt.type==="exception"&&i!==!0)throw new Error(`Exception while processing ${JSON.stringify(Lt)}:
${wt.errorMessage}`);T=wt.state;let vt=new Ut(T,y,x);Ic(J)&&(j={tx:J,state:vt});let At=wt.event;At&&w.eventTarget.dispatchEvent(new gi(ee?"interactionCompleted":"interactionFailed",{detail:At}))}W&&W.process({contractTxId:l.txId,allInteractions:z,currentInteraction:G,lastInteractionProcessingTime:rt.elapsed()});try{for(let{modify:lt}of this.executionContextModifiers)r=await lt(T,r)}catch(lt){if(lt.name=="ContractError"&&lt.subtype=="unsafeClientSkip"||lt.name=="NonWhitelistedSourceError")y[J.id]=!1,x[J.id]=lt.message,ot=!0;else throw lt}let yt=r.evaluationOptions.cacheEveryNInteractions>0&&G%r.evaluationOptions.cacheEveryNInteractions===0||t.length==1;if(c.isRoot())c.clearChildren(),j&&(c.interactionState().update(c.txId(),j.state,j.tx.sortKey),y[J.id]?await c.interactionState().commit(J,yt):await c.interactionState().rollback(J,yt));else{let lt=new Ut(T,y,x);c.interactionState().update(c.txId(),lt,d)}}let nt=new Ut(T,y,x);return j!==null&&!(c.isRoot()&&t.length==1)&&await this.onStateEvaluated(j.tx,r,j.state),new Pt(d,nt)}logResult(t,e,r){t.type==="exception"&&this.logger.error(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] threw exception:`,`${t.errorMessage}`),t.type==="error"&&this.logger.warn(`Executing of interaction: [${r.contractDefinition.txId} -> ${e.id}] returned error:`,t.errorMessage)}parseInput(t){try{return JSON.parse(t.value)}catch(e){return this.logger.error(e),null}}};function Ic(n){return n.confirmationStatus===void 0?!0:n.confirmationStatus==="confirmed"}_();var Wi=class extends Zr{constructor(e,r,i=[]){super(e,i);this.cache=r}cLogger=ct.INST.create("CacheableStateEvaluator");async eval(e){let{cachedState:r,contract:i}=e,o=e.sortedInteractions;if(r&&r.sortKey==e.requestedSortKey&&!o?.length)return this.cLogger.info(`Exact cache hit for sortKey ${e?.contractDefinition?.txId}:${r.sortKey}`),e.handler?.initState(r.cachedValue.state),r;let a=e.contractDefinition.txId;if(!a)throw new Error("Contract tx id not set in the execution context");let c=r==null,l=c?e.contractDefinition.initState:r.cachedValue.state,h=c?{}:r.cachedValue.validity||{},w=c?{}:r.cachedValue.errorMessages||{};if(c&&(l=await e.handler.maybeCallStateConstructor(e.contractDefinition.initState,e),await i.interactionState().commitKV()),o.length==0)if(this.cLogger.info(`No missing interactions ${a}`),c){e.handler?.initState(l),this.cLogger.debug("Inserting initial state into cache");let v=new Ut(l,{},{});return await this.cache.put(new Qt(a,er),v),new Pt(er,v)}else return e.handler?.initState(r.cachedValue.state),r;return await this.doReadState(o,new Ut(l,h,w),e)}async onStateEvaluated(e,r,i){let o=r.contractDefinition.txId;this.cLogger.debug(`${xe(r.contract.callDepth())}onStateEvaluated: cache update for contract ${o} [${e.sortKey}]`),await this.putInCache(o,e,i)}async onStateUpdate(e,r,i,o=!1){(r.evaluationOptions.updateCacheForEachInteraction||o)&&(this.cLogger.debug(`onStateUpdate: cache update for contract ${r.contractDefinition.txId} [${e.sortKey}]`,{contract:r.contractDefinition.txId,state:i.state,sortKey:e.sortKey}),await this.putInCache(r.contractDefinition.txId,e,i))}async latestAvailableState(e,r){if(this.cLogger.debug("Searching for",{contractTxId:e,sortKey:r}),r){let i=await this.cache.getLessOrEqual(e,r);return i&&this.cLogger.debug(`Latest available state at ${e}: ${i.sortKey}`),i}else return await this.cache.getLast(e)}async onInternalWriteStateUpdate(e,r,i){this.cLogger.debug("Internal write state update:",{sortKey:e.sortKey,dry:e.dry,contractTxId:r,state:i.state}),await this.putInCache(r,e,i)}async onContractCall(e,r,i){if(r.sortedInteractions?.length==0)return;let o=r.sortedInteractions.indexOf(e);o<1||await this.putInCache(r.contractDefinition.txId,r.sortedInteractions[o-1],i)}async putInCache(e,r,i){if(r.dry||r.confirmationStatus!==void 0&&r.confirmationStatus!=="confirmed")return;let o=new Ut(i.state,i.validity||{},i.errorMessages||{});this.cLogger.debug("Putting into cache",{contractTxId:e,transaction:r.id,sortKey:r.sortKey,dry:r.dry}),await this.cache.put(new Qt(e,r.sortKey),o)}async syncState(e,r,i,o){let a=new Ut(i,o,{});return await this.cache.put(new Qt(e,r),a),new Pt(r,a)}async dumpCache(){return await this.cache.dump()}async internalWriteState(e,r){return await this.cache.get(new Qt(e,r))}async hasContractCached(e){return await this.cache.getLast(e)!=null}async lastCachedSortKey(){return await this.cache.getLastSortKey()}setCache(e){this.cache=e}getCache(){return this.cache}};_();var ch=Gt(Ze()),tn=class{constructor(t,e,r=null){this.contractTxId=t;this.depth=e;this.innerCallType=r;this.id=ch.Crypto.randomUUID()}interactions={};id;addInteractionData(t){let{interaction:e,interactionTx:r}=t,i=Bn.create(new na(r.id,r.sortKey,r.block.height,r.block.timestamp,e?.caller,e?.input.function,e?.input,r.dry,{}));return this.interactions[r.id]=i,i}getInteraction(t){return this.interactions[t]}print(){return JSON.stringify(this,null,2)}},Bn=class{constructor(t){this.interactionInput=t}interactionOutput;static create(t){return new Bn(t)}update(t){this.interactionOutput=t}},na=class{constructor(t,e,r,i,o,a,c,l,h={}){this.txId=t;this.sortKey=e;this.blockHeight=r;this.blockTimestamp=i;this.caller=o;this.functionName=a;this.functionArguments=c;this.dryWrite=l;this.foreignContractCalls=h}},Ac=class{constructor(t,e,r,i,o="",a){this.cacheHit=t;this.outputState=e;this.executionTime=r;this.valid=i;this.errorMessage=o;this.gasUsed=a}};_();var pa=Gt(Xo());_();_();var Lc=(t=>(t.CONTRACT_NOT_FOUND="CONTRACT_NOT_FOUND",t))(Lc||{}),Di=class extends Error{type;otherInfo;constructor(t,e={}){e.message?super(e.message):super(),this.type=t,this.otherInfo=e}getType(){return this.type}};function Bm(n){if(!n)return!1;let t=uh(n);return n.evolve!==void 0||t.has("evolve")}var ir=class{logger=ct.INST.create("Evolve");constructor(){this.modify=this.modify.bind(this)}async modify(t,e){let{definitionLoader:r,executorFactory:i}=e.warp,o=e.contractDefinition.txId,a=ir.evolvedSrcTxId(t),c=e.contractDefinition.srcTxId,l=e.evaluationOptions;if(a&&c!==a)try{this.logger.info("Evolving to: ",a);let h=await r.load(o,a),w=await i.create(h,e.evaluationOptions,e.warp,e.contract.interactionState());return e.contractDefinition=h,e.handler=w,e.handler.initState(t),this.logger.debug("evolved to:",{evolve:a,newSrcTxId:e.contractDefinition.srcTxId,currentSrcTxId:c,contract:e.contractDefinition.txId}),e}catch(h){if(h.name==="ContractError"&&h.subtype==="unsafeClientSkip"||h.name=="NonWhitelistedSourceError")throw h;if(h.name==="NetworkCommunicationError"&&!l.strictEvolve)return this.logger.warn(`Error while evolving ${o} from ${c} to ${a}: ${h}`),e;throw new Di("CONTRACT_NOT_FOUND",{message:`Error while evolving ${o} from ${c} to ${a}: ${h}`,requestedTxId:o})}return e}static evolvedSrcTxId(t){if(!Bm(t))return;let e=uh(t),r=t.evolve||e.get("evolve"),i=t.canEvolve||e.get("canEvolve");if(i==null&&(i=!0),r&&/[a-z0-9_-]{43}/i.test(r)&&i)return r}};function uh(n){let t=new Map;return n.settings&&(Pm(n.settings)?t=new Map(n.settings):Nm(n.settings)&&(t=new Map(Object.entries(n.settings)))),t}function Pm(n){return n==null?!1:typeof n[Symbol.iterator]=="function"}function Nm(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}_();_();_();var Uc=Gt(dh(),1),iS=Uc.default.configure;var ph=Uc.default;_();async function oa(n,t,e,r,i,o="",a="0",c=!1,l,h){let w={data:Math.random().toString().slice(-4)};o&&o.length&&(w.target=o.toString(),a&&+a>0&&(w.quantity=a.toString())),c&&(w.reward="0",w.last_tx="p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"),h&&h.length&&(w.reward=h);let v=await n.createTransaction(w);return aa(e,r,l,i).forEach(d=>v.addTag(d.name,d.value)),t&&await t(v),v}function Wc(n,t,e){let i=new jt().decodeTags(n);return{id:n.id,owner:{address:t,key:""},recipient:n.target,tags:i,fee:{winston:n.reward,ar:""},quantity:{winston:n.quantity,ar:""},block:{id:e.indep_hash,height:e.height,timestamp:e.timestamp,previous:null},dry:!0,anchor:null,signature:null,data:null,parent:null,bundledIn:null}}function aa(n,t,e,r){let i=[];if(r&&r.length)for(let o of r)i.push(new Dt(o.name.toString(),o.value.toString()));return i.push(new Dt(Tt.APP_NAME,"SmartWeaveAction")),i.push(new Dt(Tt.APP_VERSION,"0.3.0")),i.push(new Dt(Tt.SDK,"Warp")),i.push(new Dt(Tt.CONTRACT_TX_ID,n)),i.push(new Dt(Tt.INPUT,JSON.stringify(t))),i.push(new Dt(st.INPUT_FORMAT,"tag")),e&&i.push(new Dt(st.WARP_TESTNET,"1.0.0")),i}_();var xr={target:"",winstonQty:"0"},Km=["node1","node2","arweave"];_();var Mi=class{eval(t){let e=[];return Object.keys(t.interactions).forEach(r=>{let i=t.interactions[r];this.evalForeignCalls(t.contractTxId,i,e)}),e}evalForeignCalls(t,e,r){Object.keys(e.interactionInput.foreignContractCalls).forEach(i=>{let o=e.interactionInput.foreignContractCalls[i];o.innerCallType=="write"&&Object.keys(o.interactions).forEach(a=>{let c=o.interactions[a];c.interactionInput.dryWrite&&!r.includes(o.contractTxId)&&t!==o.contractTxId&&r.push(o.contractTxId),this.evalForeignCalls(t,c,r)})})}};_();_();var Vm=Object.create,Kc=Object.defineProperty,Gm=Object.getOwnPropertyDescriptor,qm=Object.getOwnPropertyNames,jm=Object.getPrototypeOf,Hm=Object.prototype.hasOwnProperty,ar=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),Qm=(n,t)=>{for(var e in t)Kc(n,e,{get:t[e],enumerable:!0})},zm=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of qm(t))!Hm.call(n,i)&&i!==e&&Kc(n,i,{get:()=>t[i],enumerable:!(r=Gm(t,i))||r.enumerable});return n},nn=(n,t,e)=>(e=n!=null?Vm(jm(n)):{},zm(t||!n||!n.__esModule?Kc(e,"default",{value:n,enumerable:!0}):e,n)),Ym=ar(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});function t(e){var r=4,i=e.length,o=i%r;if(!o)return e;var a=i,c=r-o,l=i+c,h=F.Buffer.alloc(l);for(h.write(e);c--;)h.write("=",a++);return h.toString()}n.default=t}),Jm=ar(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=Ym();function e(l,h){return h===void 0&&(h="utf8"),F.Buffer.isBuffer(l)?o(l.toString("base64")):o(F.Buffer.from(l,h).toString("base64"))}function r(l,h){return h===void 0&&(h="utf8"),F.Buffer.from(i(l),"base64").toString(h)}function i(l){return l=l.toString(),t.default(l).replace(/\-/g,"+").replace(/_/g,"/")}function o(l){return l.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function a(l){return F.Buffer.from(i(l),"base64")}var c=e;c.encode=e,c.decode=r,c.toBase64=i,c.fromBase64=o,c.toBuffer=a,n.default=c}),Vc=ar((n,t)=>{t.exports=Jm().default,t.exports.default=t.exports}),yh=ar(n=>{"use strict";n.byteLength=l,n.toByteArray=w,n.fromByteArray=d;var t=[],e=[],r=typeof Uint8Array<"u"?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(o=0,a=i.length;o<a;++o)t[o]=i[o],e[i.charCodeAt(o)]=o;var o,a;e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63;function c(y){var x=y.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var R=y.indexOf("=");R===-1&&(R=x);var N=R===x?0:4-R%4;return[R,N]}function l(y){var x=c(y),R=x[0],N=x[1];return(R+N)*3/4-N}function h(y,x,R){return(x+R)*3/4-R}function w(y){var x,R=c(y),N=R[0],j=R[1],z=new r(h(y,N,j)),Z=0,W=j>0?N-4:N,V;for(V=0;V<W;V+=4)x=e[y.charCodeAt(V)]<<18|e[y.charCodeAt(V+1)]<<12|e[y.charCodeAt(V+2)]<<6|e[y.charCodeAt(V+3)],z[Z++]=x>>16&255,z[Z++]=x>>8&255,z[Z++]=x&255;return j===2&&(x=e[y.charCodeAt(V)]<<2|e[y.charCodeAt(V+1)]>>4,z[Z++]=x&255),j===1&&(x=e[y.charCodeAt(V)]<<10|e[y.charCodeAt(V+1)]<<4|e[y.charCodeAt(V+2)]>>2,z[Z++]=x>>8&255,z[Z++]=x&255),z}function v(y){return t[y>>18&63]+t[y>>12&63]+t[y>>6&63]+t[y&63]}function T(y,x,R){for(var N,j=[],z=x;z<R;z+=3)N=(y[z]<<16&16711680)+(y[z+1]<<8&65280)+(y[z+2]&255),j.push(v(N));return j.join("")}function d(y){for(var x,R=y.length,N=R%3,j=[],z=16383,Z=0,W=R-N;Z<W;Z+=z)j.push(T(y,Z,Z+z>W?W:Z+z));return N===1?(x=y[R-1],j.push(t[x>>2]+t[x<<4&63]+"==")):N===2&&(x=(y[R-2]<<8)+y[R-1],j.push(t[x>>10]+t[x>>4&63]+t[x<<2&63]+"=")),j.join("")}}),wh=ar(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.b64UrlDecode=n.b64UrlEncode=n.bufferTob64Url=n.bufferTob64=n.b64UrlToBuffer=n.stringToB64Url=n.stringToBuffer=n.bufferToString=n.b64UrlToString=n.concatBuffers=void 0;var t=yh();function e(T){let d=0;for(let R=0;R<T.length;R++)d+=T[R].byteLength;let y=new Uint8Array(d),x=0;y.set(new Uint8Array(T[0]),x),x+=T[0].byteLength;for(let R=1;R<T.length;R++)y.set(new Uint8Array(T[R]),x),x+=T[R].byteLength;return y}n.concatBuffers=e;function r(T){let d=c(T);return i(d)}n.b64UrlToString=r;function i(T){return new TextDecoder("utf-8",{fatal:!0}).decode(T)}n.bufferToString=i;function o(T){return new TextEncoder().encode(T)}n.stringToBuffer=o;function a(T){return h(o(T))}n.stringToB64Url=a;function c(T){return new Uint8Array(t.toByteArray(v(T)))}n.b64UrlToBuffer=c;function l(T){return t.fromByteArray(new Uint8Array(T))}n.bufferTob64=l;function h(T){return w(l(T))}n.bufferTob64Url=h;function w(T){return T.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}n.b64UrlEncode=w;function v(T){T=T.replace(/\-/g,"+").replace(/\_/g,"/");let d;return T.length%4==0?d=0:d=4-T.length%4,T.concat("=".repeat(d))}n.b64UrlDecode=v}),Xm=ar(n=>{"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=wh(),e=class{keyLength=4096;publicExponent=65537;hashAlgorithm="sha256";driver;constructor(){if(!this.detectWebCrypto())throw new Error("SubtleCrypto not available!");this.driver=crypto.subtle}async generateJWK(){let r=await this.driver.generateKey({name:"RSA-PSS",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign"]),i=await this.driver.exportKey("jwk",r.privateKey);return{kty:i.kty,e:i.e,n:i.n,d:i.d,p:i.p,q:i.q,dp:i.dp,dq:i.dq,qi:i.qi}}async sign(r,i,{saltLength:o}={}){let a=await this.driver.sign({name:"RSA-PSS",saltLength:32},await this.jwkToCryptoKey(r),i);return new Uint8Array(a)}async hash(r,i="SHA-256"){let o=await this.driver.digest(i,r);return new Uint8Array(o)}async verify(r,i,o){let a={kty:"RSA",e:"AQAB",n:r},c=await this.jwkToPublicCryptoKey(a),l=await this.driver.digest("SHA-256",i),h=await this.driver.verify({name:"RSA-PSS",saltLength:0},c,o,i),w=await this.driver.verify({name:"RSA-PSS",saltLength:32},c,o,i),v=await this.driver.verify({name:"RSA-PSS",saltLength:Math.ceil((c.algorithm.modulusLength-1)/8)-l.byteLength-2},c,o,i);return h||w||v}async jwkToCryptoKey(r){return this.driver.importKey("jwk",r,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["sign"])}async jwkToPublicCryptoKey(r){return this.driver.importKey("jwk",r,{name:"RSA-PSS",hash:{name:"SHA-256"}},!1,["verify"])}detectWebCrypto(){if(typeof crypto>"u")return!1;let r=crypto?.subtle;return r===void 0?!1:["generateKey","importKey","exportKey","digest","sign"].every(i=>typeof r[i]=="function")}async encrypt(r,i,o){let a=await this.driver.importKey("raw",typeof i=="string"?t.stringToBuffer(i):i,{name:"PBKDF2",length:32},!1,["deriveKey"]),c=await this.driver.deriveKey({name:"PBKDF2",salt:o?t.stringToBuffer(o):t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),l=new Uint8Array(16);crypto.getRandomValues(l);let h=await this.driver.encrypt({name:"AES-CBC",iv:l},c,r);return t.concatBuffers([l,h])}async decrypt(r,i,o){let a=await this.driver.importKey("raw",typeof i=="string"?t.stringToBuffer(i):i,{name:"PBKDF2",length:32},!1,["deriveKey"]),c=await this.driver.deriveKey({name:"PBKDF2",salt:o?t.stringToBuffer(o):t.stringToBuffer("salt"),iterations:1e5,hash:"SHA-256"},a,{name:"AES-CBC",length:256},!1,["encrypt","decrypt"]),l=r.slice(0,16),h=await this.driver.decrypt({name:"AES-CBC",iv:l},c,r.slice(16));return t.concatBuffers([h])}};n.default=e}),Zm=ar(n=>{n.read=function(t,e,r,i,o){var a,c,l=o*8-i-1,h=(1<<l)-1,w=h>>1,v=-7,T=r?o-1:0,d=r?-1:1,y=t[e+T];for(T+=d,a=y&(1<<-v)-1,y>>=-v,v+=l;v>0;a=a*256+t[e+T],T+=d,v-=8);for(c=a&(1<<-v)-1,a>>=-v,v+=i;v>0;c=c*256+t[e+T],T+=d,v-=8);if(a===0)a=1-w;else{if(a===h)return c?NaN:(y?-1:1)*(1/0);c=c+Math.pow(2,i),a=a-w}return(y?-1:1)*c*Math.pow(2,a-i)},n.write=function(t,e,r,i,o,a){var c,l,h,w=a*8-o-1,v=(1<<w)-1,T=v>>1,d=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=i?0:a-1,x=i?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=v):(c=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-c))<1&&(c--,h*=2),c+T>=1?e+=d/h:e+=d*Math.pow(2,1-T),e*h>=2&&(c++,h/=2),c+T>=v?(l=0,c=v):c+T>=1?(l=(e*h-1)*Math.pow(2,o),c=c+T):(l=e*Math.pow(2,T-1)*Math.pow(2,o),c=0));o>=8;t[r+y]=l&255,y+=x,l/=256,o-=8);for(c=c<<o|l,w+=o;w>0;t[r+y]=c&255,y+=x,c/=256,w-=8);t[r+y-x]|=R*128}}),Mc=ar(n=>{"use strict";var t=yh(),e=Zm(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=c,n.SlowBuffer=j,n.INSPECT_MAX_BYTES=50;var i=2147483647;n.kMaxLength=i,c.TYPED_ARRAY_SUPPORT=o(),!c.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function o(){try{let s=new Uint8Array(1),u={foo:function(){return 42}};return Object.setPrototypeOf(u,Uint8Array.prototype),Object.setPrototypeOf(s,u),s.foo()===42}catch{return!1}}Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}});function a(s){if(s>i)throw new RangeError('The value "'+s+'" is invalid for option "size"');let u=new Uint8Array(s);return Object.setPrototypeOf(u,c.prototype),u}function c(s,u,f){if(typeof s=="number"){if(typeof u=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return v(s)}return l(s,u,f)}c.poolSize=8192;function l(s,u,f){if(typeof s=="string")return T(s,u);if(ArrayBuffer.isView(s))return y(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(m(s,ArrayBuffer)||s&&m(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(m(s,SharedArrayBuffer)||s&&m(s.buffer,SharedArrayBuffer)))return x(s,u,f);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let E=s.valueOf&&s.valueOf();if(E!=null&&E!==s)return c.from(E,u,f);let k=R(s);if(k)return k;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return c.from(s[Symbol.toPrimitive]("string"),u,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}c.from=function(s,u,f){return l(s,u,f)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array);function h(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function w(s,u,f){return h(s),s<=0?a(s):u!==void 0?typeof f=="string"?a(s).fill(u,f):a(s).fill(u):a(s)}c.alloc=function(s,u,f){return w(s,u,f)};function v(s){return h(s),a(s<0?0:N(s)|0)}c.allocUnsafe=function(s){return v(s)},c.allocUnsafeSlow=function(s){return v(s)};function T(s,u){if((typeof u!="string"||u==="")&&(u="utf8"),!c.isEncoding(u))throw new TypeError("Unknown encoding: "+u);let f=z(s,u)|0,E=a(f),k=E.write(s,u);return k!==f&&(E=E.slice(0,k)),E}function d(s){let u=s.length<0?0:N(s.length)|0,f=a(u);for(let E=0;E<u;E+=1)f[E]=s[E]&255;return f}function y(s){if(m(s,Uint8Array)){let u=new Uint8Array(s);return x(u.buffer,u.byteOffset,u.byteLength)}return d(s)}function x(s,u,f){if(u<0||s.byteLength<u)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<u+(f||0))throw new RangeError('"length" is outside of buffer bounds');let E;return u===void 0&&f===void 0?E=new Uint8Array(s):f===void 0?E=new Uint8Array(s,u):E=new Uint8Array(s,u,f),Object.setPrototypeOf(E,c.prototype),E}function R(s){if(c.isBuffer(s)){let u=N(s.length)|0,f=a(u);return f.length===0||s.copy(f,0,0,u),f}if(s.length!==void 0)return typeof s.length!="number"||C(s.length)?a(0):d(s);if(s.type==="Buffer"&&Array.isArray(s.data))return d(s.data)}function N(s){if(s>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return s|0}function j(s){return+s!=s&&(s=0),c.alloc(+s)}c.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==c.prototype},c.compare=function(s,u){if(m(s,Uint8Array)&&(s=c.from(s,s.offset,s.byteLength)),m(u,Uint8Array)&&(u=c.from(u,u.offset,u.byteLength)),!c.isBuffer(s)||!c.isBuffer(u))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===u)return 0;let f=s.length,E=u.length;for(let k=0,M=Math.min(f,E);k<M;++k)if(s[k]!==u[k]){f=s[k],E=u[k];break}return f<E?-1:E<f?1:0},c.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(s,u){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return c.alloc(0);let f;if(u===void 0)for(u=0,f=0;f<s.length;++f)u+=s[f].length;let E=c.allocUnsafe(u),k=0;for(f=0;f<s.length;++f){let M=s[f];if(m(M,Uint8Array))k+M.length>E.length?(c.isBuffer(M)||(M=c.from(M)),M.copy(E,k)):Uint8Array.prototype.set.call(E,M,k);else if(c.isBuffer(M))M.copy(E,k);else throw new TypeError('"list" argument must be an Array of Buffers');k+=M.length}return E};function z(s,u){if(c.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||m(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);let f=s.length,E=arguments.length>2&&arguments[2]===!0;if(!E&&f===0)return 0;let k=!1;for(;;)switch(u){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return L(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f*2;case"hex":return f>>>1;case"base64":return Q(s).length;default:if(k)return E?-1:L(s).length;u=(""+u).toLowerCase(),k=!0}}c.byteLength=z;function Z(s,u,f){let E=!1;if((u===void 0||u<0)&&(u=0),u>this.length||((f===void 0||f>this.length)&&(f=this.length),f<=0)||(f>>>=0,u>>>=0,f<=u))return"";for(s||(s="utf8");;)switch(s){case"hex":return wt(this,u,f);case"utf8":case"utf-8":return lt(this,u,f);case"ascii":return tt(this,u,f);case"latin1":case"binary":return Kt(this,u,f);case"base64":return yt(this,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ee(this,u,f);default:if(E)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),E=!0}}c.prototype._isBuffer=!0;function W(s,u,f){let E=s[u];s[u]=s[f],s[f]=E}c.prototype.swap16=function(){let s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let u=0;u<s;u+=2)W(this,u,u+1);return this},c.prototype.swap32=function(){let s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let u=0;u<s;u+=4)W(this,u,u+3),W(this,u+1,u+2);return this},c.prototype.swap64=function(){let s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let u=0;u<s;u+=8)W(this,u,u+7),W(this,u+1,u+6),W(this,u+2,u+5),W(this,u+3,u+4);return this},c.prototype.toString=function(){let s=this.length;return s===0?"":arguments.length===0?lt(this,0,s):Z.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(s){if(!c.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:c.compare(this,s)===0},c.prototype.inspect=function(){let s="",u=n.INSPECT_MAX_BYTES;return s=this.toString("hex",0,u).replace(/(.{2})/g,"$1 ").trim(),this.length>u&&(s+=" ... "),"<Buffer "+s+">"},r&&(c.prototype[r]=c.prototype.inspect),c.prototype.compare=function(s,u,f,E,k){if(m(s,Uint8Array)&&(s=c.from(s,s.offset,s.byteLength)),!c.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(u===void 0&&(u=0),f===void 0&&(f=s?s.length:0),E===void 0&&(E=0),k===void 0&&(k=this.length),u<0||f>s.length||E<0||k>this.length)throw new RangeError("out of range index");if(E>=k&&u>=f)return 0;if(E>=k)return-1;if(u>=f)return 1;if(u>>>=0,f>>>=0,E>>>=0,k>>>=0,this===s)return 0;let M=k-E,Y=f-u,dt=Math.min(M,Y),St=this.slice(E,k),ft=s.slice(u,f);for(let Ct=0;Ct<dt;++Ct)if(St[Ct]!==ft[Ct]){M=St[Ct],Y=ft[Ct];break}return M<Y?-1:Y<M?1:0};function V(s,u,f,E,k){if(s.length===0)return-1;if(typeof f=="string"?(E=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,C(f)&&(f=k?0:s.length-1),f<0&&(f=s.length+f),f>=s.length){if(k)return-1;f=s.length-1}else if(f<0)if(k)f=0;else return-1;if(typeof u=="string"&&(u=c.from(u,E)),c.isBuffer(u))return u.length===0?-1:ot(s,u,f,E,k);if(typeof u=="number")return u=u&255,typeof Uint8Array.prototype.indexOf=="function"?k?Uint8Array.prototype.indexOf.call(s,u,f):Uint8Array.prototype.lastIndexOf.call(s,u,f):ot(s,[u],f,E,k);throw new TypeError("val must be string, number or Buffer")}function ot(s,u,f,E,k){let M=1,Y=s.length,dt=u.length;if(E!==void 0&&(E=String(E).toLowerCase(),E==="ucs2"||E==="ucs-2"||E==="utf16le"||E==="utf-16le")){if(s.length<2||u.length<2)return-1;M=2,Y/=2,dt/=2,f/=2}function St(Ct,Bt){return M===1?Ct[Bt]:Ct.readUInt16BE(Bt*M)}let ft;if(k){let Ct=-1;for(ft=f;ft<Y;ft++)if(St(s,ft)===St(u,Ct===-1?0:ft-Ct)){if(Ct===-1&&(Ct=ft),ft-Ct+1===dt)return Ct*M}else Ct!==-1&&(ft-=ft-Ct),Ct=-1}else for(f+dt>Y&&(f=Y-dt),ft=f;ft>=0;ft--){let Ct=!0;for(let Bt=0;Bt<dt;Bt++)if(St(s,ft+Bt)!==St(u,Bt)){Ct=!1;break}if(Ct)return ft}return-1}c.prototype.includes=function(s,u,f){return this.indexOf(s,u,f)!==-1},c.prototype.indexOf=function(s,u,f){return V(this,s,u,f,!0)},c.prototype.lastIndexOf=function(s,u,f){return V(this,s,u,f,!1)};function nt(s,u,f,E){f=Number(f)||0;let k=s.length-f;E?(E=Number(E),E>k&&(E=k)):E=k;let M=u.length;E>M/2&&(E=M/2);let Y;for(Y=0;Y<E;++Y){let dt=parseInt(u.substr(Y*2,2),16);if(C(dt))return Y;s[f+Y]=dt}return Y}function G(s,u,f,E){return g(L(u,s.length-f),s,f,E)}function J(s,u,f,E){return g(B(u),s,f,E)}function rt(s,u,f,E){return g(Q(u),s,f,E)}function ht(s,u,f,E){return g(P(u,s.length-f),s,f,E)}c.prototype.write=function(s,u,f,E){if(u===void 0)E="utf8",f=this.length,u=0;else if(f===void 0&&typeof u=="string")E=u,f=this.length,u=0;else if(isFinite(u))u=u>>>0,isFinite(f)?(f=f>>>0,E===void 0&&(E="utf8")):(E=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let k=this.length-u;if((f===void 0||f>k)&&(f=k),s.length>0&&(f<0||u<0)||u>this.length)throw new RangeError("Attempt to write outside buffer bounds");E||(E="utf8");let M=!1;for(;;)switch(E){case"hex":return nt(this,s,u,f);case"utf8":case"utf-8":return G(this,s,u,f);case"ascii":case"latin1":case"binary":return J(this,s,u,f);case"base64":return rt(this,s,u,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ht(this,s,u,f);default:if(M)throw new TypeError("Unknown encoding: "+E);E=(""+E).toLowerCase(),M=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function yt(s,u,f){return u===0&&f===s.length?t.fromByteArray(s):t.fromByteArray(s.slice(u,f))}function lt(s,u,f){f=Math.min(s.length,f);let E=[],k=u;for(;k<f;){let M=s[k],Y=null,dt=M>239?4:M>223?3:M>191?2:1;if(k+dt<=f){let St,ft,Ct,Bt;switch(dt){case 1:M<128&&(Y=M);break;case 2:St=s[k+1],(St&192)===128&&(Bt=(M&31)<<6|St&63,Bt>127&&(Y=Bt));break;case 3:St=s[k+1],ft=s[k+2],(St&192)===128&&(ft&192)===128&&(Bt=(M&15)<<12|(St&63)<<6|ft&63,Bt>2047&&(Bt<55296||Bt>57343)&&(Y=Bt));break;case 4:St=s[k+1],ft=s[k+2],Ct=s[k+3],(St&192)===128&&(ft&192)===128&&(Ct&192)===128&&(Bt=(M&15)<<18|(St&63)<<12|(ft&63)<<6|Ct&63,Bt>65535&&Bt<1114112&&(Y=Bt))}}Y===null?(Y=65533,dt=1):Y>65535&&(Y-=65536,E.push(Y>>>10&1023|55296),Y=56320|Y&1023),E.push(Y),k+=dt}return Lt(E)}var Nt=4096;function Lt(s){let u=s.length;if(u<=Nt)return String.fromCharCode.apply(String,s);let f="",E=0;for(;E<u;)f+=String.fromCharCode.apply(String,s.slice(E,E+=Nt));return f}function tt(s,u,f){let E="";f=Math.min(s.length,f);for(let k=u;k<f;++k)E+=String.fromCharCode(s[k]&127);return E}function Kt(s,u,f){let E="";f=Math.min(s.length,f);for(let k=u;k<f;++k)E+=String.fromCharCode(s[k]);return E}function wt(s,u,f){let E=s.length;(!u||u<0)&&(u=0),(!f||f<0||f>E)&&(f=E);let k="";for(let M=u;M<f;++M)k+=H[s[M]];return k}function ee(s,u,f){let E=s.slice(u,f),k="";for(let M=0;M<E.length-1;M+=2)k+=String.fromCharCode(E[M]+E[M+1]*256);return k}c.prototype.slice=function(s,u){let f=this.length;s=~~s,u=u===void 0?f:~~u,s<0?(s+=f,s<0&&(s=0)):s>f&&(s=f),u<0?(u+=f,u<0&&(u=0)):u>f&&(u=f),u<s&&(u=s);let E=this.subarray(s,u);return Object.setPrototypeOf(E,c.prototype),E};function vt(s,u,f){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+u>f)throw new RangeError("Trying to access beyond buffer length")}c.prototype.readUintLE=c.prototype.readUIntLE=function(s,u,f){s=s>>>0,u=u>>>0,f||vt(s,u,this.length);let E=this[s],k=1,M=0;for(;++M<u&&(k*=256);)E+=this[s+M]*k;return E},c.prototype.readUintBE=c.prototype.readUIntBE=function(s,u,f){s=s>>>0,u=u>>>0,f||vt(s,u,this.length);let E=this[s+--u],k=1;for(;u>0&&(k*=256);)E+=this[s+--u]*k;return E},c.prototype.readUint8=c.prototype.readUInt8=function(s,u){return s=s>>>0,u||vt(s,1,this.length),this[s]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(s,u){return s=s>>>0,u||vt(s,2,this.length),this[s]|this[s+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(s,u){return s=s>>>0,u||vt(s,2,this.length),this[s]<<8|this[s+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},c.prototype.readBigUInt64LE=et(function(s){s=s>>>0,A(s,"offset");let u=this[s],f=this[s+7];(u===void 0||f===void 0)&&O(s,this.length-8);let E=u+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24,k=this[++s]+this[++s]*2**8+this[++s]*2**16+f*2**24;return BigInt(E)+(BigInt(k)<<BigInt(32))}),c.prototype.readBigUInt64BE=et(function(s){s=s>>>0,A(s,"offset");let u=this[s],f=this[s+7];(u===void 0||f===void 0)&&O(s,this.length-8);let E=u*2**24+this[++s]*2**16+this[++s]*2**8+this[++s],k=this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+f;return(BigInt(E)<<BigInt(32))+BigInt(k)}),c.prototype.readIntLE=function(s,u,f){s=s>>>0,u=u>>>0,f||vt(s,u,this.length);let E=this[s],k=1,M=0;for(;++M<u&&(k*=256);)E+=this[s+M]*k;return k*=128,E>=k&&(E-=Math.pow(2,8*u)),E},c.prototype.readIntBE=function(s,u,f){s=s>>>0,u=u>>>0,f||vt(s,u,this.length);let E=u,k=1,M=this[s+--E];for(;E>0&&(k*=256);)M+=this[s+--E]*k;return k*=128,M>=k&&(M-=Math.pow(2,8*u)),M},c.prototype.readInt8=function(s,u){return s=s>>>0,u||vt(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},c.prototype.readInt16LE=function(s,u){s=s>>>0,u||vt(s,2,this.length);let f=this[s]|this[s+1]<<8;return f&32768?f|4294901760:f},c.prototype.readInt16BE=function(s,u){s=s>>>0,u||vt(s,2,this.length);let f=this[s+1]|this[s]<<8;return f&32768?f|4294901760:f},c.prototype.readInt32LE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},c.prototype.readInt32BE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},c.prototype.readBigInt64LE=et(function(s){s=s>>>0,A(s,"offset");let u=this[s],f=this[s+7];(u===void 0||f===void 0)&&O(s,this.length-8);let E=this[s+4]+this[s+5]*2**8+this[s+6]*2**16+(f<<24);return(BigInt(E)<<BigInt(32))+BigInt(u+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24)}),c.prototype.readBigInt64BE=et(function(s){s=s>>>0,A(s,"offset");let u=this[s],f=this[s+7];(u===void 0||f===void 0)&&O(s,this.length-8);let E=(u<<24)+this[++s]*2**16+this[++s]*2**8+this[++s];return(BigInt(E)<<BigInt(32))+BigInt(this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+f)}),c.prototype.readFloatLE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),e.read(this,s,!0,23,4)},c.prototype.readFloatBE=function(s,u){return s=s>>>0,u||vt(s,4,this.length),e.read(this,s,!1,23,4)},c.prototype.readDoubleLE=function(s,u){return s=s>>>0,u||vt(s,8,this.length),e.read(this,s,!0,52,8)},c.prototype.readDoubleBE=function(s,u){return s=s>>>0,u||vt(s,8,this.length),e.read(this,s,!1,52,8)};function At(s,u,f,E,k,M){if(!c.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(u>k||u<M)throw new RangeError('"value" argument is out of bounds');if(f+E>s.length)throw new RangeError("Index out of range")}c.prototype.writeUintLE=c.prototype.writeUIntLE=function(s,u,f,E){if(s=+s,u=u>>>0,f=f>>>0,!E){let Y=Math.pow(2,8*f)-1;At(this,s,u,f,Y,0)}let k=1,M=0;for(this[u]=s&255;++M<f&&(k*=256);)this[u+M]=s/k&255;return u+f},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(s,u,f,E){if(s=+s,u=u>>>0,f=f>>>0,!E){let Y=Math.pow(2,8*f)-1;At(this,s,u,f,Y,0)}let k=f-1,M=1;for(this[u+k]=s&255;--k>=0&&(M*=256);)this[u+k]=s/M&255;return u+f},c.prototype.writeUint8=c.prototype.writeUInt8=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,1,255,0),this[u]=s&255,u+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,2,65535,0),this[u]=s&255,this[u+1]=s>>>8,u+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,2,65535,0),this[u]=s>>>8,this[u+1]=s&255,u+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,4,4294967295,0),this[u+3]=s>>>24,this[u+2]=s>>>16,this[u+1]=s>>>8,this[u]=s&255,u+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,4,4294967295,0),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4};function X(s,u,f,E,k){U(u,E,k,s,f,7);let M=Number(u&BigInt(4294967295));s[f++]=M,M=M>>8,s[f++]=M,M=M>>8,s[f++]=M,M=M>>8,s[f++]=M;let Y=Number(u>>BigInt(32)&BigInt(4294967295));return s[f++]=Y,Y=Y>>8,s[f++]=Y,Y=Y>>8,s[f++]=Y,Y=Y>>8,s[f++]=Y,f}function sr(s,u,f,E,k){U(u,E,k,s,f,7);let M=Number(u&BigInt(4294967295));s[f+7]=M,M=M>>8,s[f+6]=M,M=M>>8,s[f+5]=M,M=M>>8,s[f+4]=M;let Y=Number(u>>BigInt(32)&BigInt(4294967295));return s[f+3]=Y,Y=Y>>8,s[f+2]=Y,Y=Y>>8,s[f+1]=Y,Y=Y>>8,s[f]=Y,f+8}c.prototype.writeBigUInt64LE=et(function(s,u=0){return X(this,s,u,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeBigUInt64BE=et(function(s,u=0){return sr(this,s,u,BigInt(0),BigInt("0xffffffffffffffff"))}),c.prototype.writeIntLE=function(s,u,f,E){if(s=+s,u=u>>>0,!E){let dt=Math.pow(2,8*f-1);At(this,s,u,f,dt-1,-dt)}let k=0,M=1,Y=0;for(this[u]=s&255;++k<f&&(M*=256);)s<0&&Y===0&&this[u+k-1]!==0&&(Y=1),this[u+k]=(s/M>>0)-Y&255;return u+f},c.prototype.writeIntBE=function(s,u,f,E){if(s=+s,u=u>>>0,!E){let dt=Math.pow(2,8*f-1);At(this,s,u,f,dt-1,-dt)}let k=f-1,M=1,Y=0;for(this[u+k]=s&255;--k>=0&&(M*=256);)s<0&&Y===0&&this[u+k+1]!==0&&(Y=1),this[u+k]=(s/M>>0)-Y&255;return u+f},c.prototype.writeInt8=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,1,127,-128),s<0&&(s=255+s+1),this[u]=s&255,u+1},c.prototype.writeInt16LE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,2,32767,-32768),this[u]=s&255,this[u+1]=s>>>8,u+2},c.prototype.writeInt16BE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,2,32767,-32768),this[u]=s>>>8,this[u+1]=s&255,u+2},c.prototype.writeInt32LE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,4,2147483647,-2147483648),this[u]=s&255,this[u+1]=s>>>8,this[u+2]=s>>>16,this[u+3]=s>>>24,u+4},c.prototype.writeInt32BE=function(s,u,f){return s=+s,u=u>>>0,f||At(this,s,u,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[u]=s>>>24,this[u+1]=s>>>16,this[u+2]=s>>>8,this[u+3]=s&255,u+4},c.prototype.writeBigInt64LE=et(function(s,u=0){return X(this,s,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),c.prototype.writeBigInt64BE=et(function(s,u=0){return sr(this,s,u,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Ir(s,u,f,E,k,M){if(f+E>s.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function cr(s,u,f,E,k){return u=+u,f=f>>>0,k||Ir(s,u,f,4,34028234663852886e22,-34028234663852886e22),e.write(s,u,f,E,23,4),f+4}c.prototype.writeFloatLE=function(s,u,f){return cr(this,s,u,!0,f)},c.prototype.writeFloatBE=function(s,u,f){return cr(this,s,u,!1,f)};function Vt(s,u,f,E,k){return u=+u,f=f>>>0,k||Ir(s,u,f,8,17976931348623157e292,-17976931348623157e292),e.write(s,u,f,E,52,8),f+8}c.prototype.writeDoubleLE=function(s,u,f){return Vt(this,s,u,!0,f)},c.prototype.writeDoubleBE=function(s,u,f){return Vt(this,s,u,!1,f)},c.prototype.copy=function(s,u,f,E){if(!c.isBuffer(s))throw new TypeError("argument should be a Buffer");if(f||(f=0),!E&&E!==0&&(E=this.length),u>=s.length&&(u=s.length),u||(u=0),E>0&&E<f&&(E=f),E===f||s.length===0||this.length===0)return 0;if(u<0)throw new RangeError("targetStart out of bounds");if(f<0||f>=this.length)throw new RangeError("Index out of range");if(E<0)throw new RangeError("sourceEnd out of bounds");E>this.length&&(E=this.length),s.length-u<E-f&&(E=s.length-u+f);let k=E-f;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(u,f,E):Uint8Array.prototype.set.call(s,this.subarray(f,E),u),k},c.prototype.fill=function(s,u,f,E){if(typeof s=="string"){if(typeof u=="string"?(E=u,u=0,f=this.length):typeof f=="string"&&(E=f,f=this.length),E!==void 0&&typeof E!="string")throw new TypeError("encoding must be a string");if(typeof E=="string"&&!c.isEncoding(E))throw new TypeError("Unknown encoding: "+E);if(s.length===1){let M=s.charCodeAt(0);(E==="utf8"&&M<128||E==="latin1")&&(s=M)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(u<0||this.length<u||this.length<f)throw new RangeError("Out of range index");if(f<=u)return this;u=u>>>0,f=f===void 0?this.length:f>>>0,s||(s=0);let k;if(typeof s=="number")for(k=u;k<f;++k)this[k]=s;else{let M=c.isBuffer(s)?s:c.from(s,E),Y=M.length;if(Y===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(k=0;k<f-u;++k)this[k+u]=M[k%Y]}return this};var Mt={};function p(s,u,f){Mt[s]=class extends f{constructor(){super(),Object.defineProperty(this,"message",{value:u.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${s}]`,this.stack,delete this.name}get code(){return s}set code(E){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:E,writable:!0})}toString(){return`${this.name} [${s}]: ${this.message}`}}}p("ERR_BUFFER_OUT_OF_BOUNDS",function(s){return s?`${s} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),p("ERR_INVALID_ARG_TYPE",function(s,u){return`The "${s}" argument must be of type number. Received type ${typeof u}`},TypeError),p("ERR_OUT_OF_RANGE",function(s,u,f){let E=`The value of "${s}" is out of range.`,k=f;return Number.isInteger(f)&&Math.abs(f)>2**32?k=b(String(f)):typeof f=="bigint"&&(k=String(f),(f>BigInt(2)**BigInt(32)||f<-(BigInt(2)**BigInt(32)))&&(k=b(k)),k+="n"),E+=` It must be ${u}. Received ${k}`,E},RangeError);function b(s){let u="",f=s.length,E=s[0]==="-"?1:0;for(;f>=E+4;f-=3)u=`_${s.slice(f-3,f)}${u}`;return`${s.slice(0,f)}${u}`}function S(s,u,f){A(u,"offset"),(s[u]===void 0||s[u+f]===void 0)&&O(u,s.length-(f+1))}function U(s,u,f,E,k,M){if(s>f||s<u){let Y=typeof u=="bigint"?"n":"",dt;throw M>3?u===0||u===BigInt(0)?dt=`>= 0${Y} and < 2${Y} ** ${(M+1)*8}${Y}`:dt=`>= -(2${Y} ** ${(M+1)*8-1}${Y}) and < 2 ** ${(M+1)*8-1}${Y}`:dt=`>= ${u}${Y} and <= ${f}${Y}`,new Mt.ERR_OUT_OF_RANGE("value",dt,s)}S(E,k,M)}function A(s,u){if(typeof s!="number")throw new Mt.ERR_INVALID_ARG_TYPE(u,"number",s)}function O(s,u,f){throw Math.floor(s)!==s?(A(s,f),new Mt.ERR_OUT_OF_RANGE(f||"offset","an integer",s)):u<0?new Mt.ERR_BUFFER_OUT_OF_BOUNDS:new Mt.ERR_OUT_OF_RANGE(f||"offset",`>= ${f?1:0} and <= ${u}`,s)}var D=/[^+/0-9A-Za-z-_]/g;function I(s){if(s=s.split("=")[0],s=s.trim().replace(D,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function L(s,u){u=u||1/0;let f,E=s.length,k=null,M=[];for(let Y=0;Y<E;++Y){if(f=s.charCodeAt(Y),f>55295&&f<57344){if(!k){if(f>56319){(u-=3)>-1&&M.push(239,191,189);continue}else if(Y+1===E){(u-=3)>-1&&M.push(239,191,189);continue}k=f;continue}if(f<56320){(u-=3)>-1&&M.push(239,191,189),k=f;continue}f=(k-55296<<10|f-56320)+65536}else k&&(u-=3)>-1&&M.push(239,191,189);if(k=null,f<128){if((u-=1)<0)break;M.push(f)}else if(f<2048){if((u-=2)<0)break;M.push(f>>6|192,f&63|128)}else if(f<65536){if((u-=3)<0)break;M.push(f>>12|224,f>>6&63|128,f&63|128)}else if(f<1114112){if((u-=4)<0)break;M.push(f>>18|240,f>>12&63|128,f>>6&63|128,f&63|128)}else throw new Error("Invalid code point")}return M}function B(s){let u=[];for(let f=0;f<s.length;++f)u.push(s.charCodeAt(f)&255);return u}function P(s,u){let f,E,k,M=[];for(let Y=0;Y<s.length&&!((u-=2)<0);++Y)f=s.charCodeAt(Y),E=f>>8,k=f%256,M.push(k),M.push(E);return M}function Q(s){return t.toByteArray(I(s))}function g(s,u,f,E){let k;for(k=0;k<E&&!(k+f>=u.length||k>=s.length);++k)u[k+f]=s[k];return k}function m(s,u){return s instanceof u||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===u.name}function C(s){return s!==s}var H=function(){let s="0123456789abcdef",u=new Array(256);for(let f=0;f<16;++f){let E=f*16;for(let k=0;k<16;++k)u[E+k]=s[f]+s[k]}return u}();function et(s){return typeof BigInt>"u"?at:s}function at(){throw new Error("BigInt not supported")}}),ty=ar((n,t)=>{typeof window<"u"?(window.global=window,K.fetch=window.fetch,t.exports={Buffer:Mc().Buffer,Crypto:window.crypto}):t.exports={Buffer:Mc().Buffer,Crypto:crypto}}),vh={};Qm(vh,{AVSCTap:()=>ua,ArweaveSigner:()=>ca,DataItem:()=>sa,MAX_TAG_BYTES:()=>qc,MIN_BINARY_SIZE:()=>Th,SIG_CONFIG:()=>Fi,SignatureConfig:()=>Ae,Signer:()=>ey,createData:()=>jc,deserializeTags:()=>$c,indexToType:()=>Sh,serializeTags:()=>Eh,tagsExceedLimit:()=>Gc});var ey=class{signer;publicKey;signatureType;signatureLength;ownerLength;pem;static verify(n,t,e,r){throw new Error("You must implement verify method on child")}},ry=nn(Vc(),1),Ie=nn(wh(),1);async function bh(n){if(Array.isArray(n)){let i=(0,Ie.concatBuffers)([(0,Ie.stringToBuffer)("list"),(0,Ie.stringToBuffer)(n.length.toString())]);return await _h(n,await or().hash(i,"SHA-384"))}let t=n,e=(0,Ie.concatBuffers)([(0,Ie.stringToBuffer)("blob"),(0,Ie.stringToBuffer)(t.byteLength.toString())]),r=(0,Ie.concatBuffers)([await or().hash(e,"SHA-384"),await or().hash(t,"SHA-384")]);return await or().hash(r,"SHA-384")}async function _h(n,t){if(n.length<1)return t;let e=(0,Ie.concatBuffers)([t,await bh(n[0])]),r=await or().hash(e,"SHA-384");return await _h(n.slice(1),r)}var Dc=nn(Xm(),1),ny=Dc.default.default?Dc.default.default:Dc.default,iy=class extends ny{getPublicKey(n){throw new Error("Unimplemented")}},oy;function or(){return oy??=new iy}var Ae;(function(n){n[n.ARWEAVE=1]="ARWEAVE",n[n.ED25519=2]="ED25519",n[n.ETHEREUM=3]="ETHEREUM",n[n.SOLANA=4]="SOLANA",n[n.INJECTEDAPTOS=5]="INJECTEDAPTOS",n[n.MULTIAPTOS=6]="MULTIAPTOS",n[n.TYPEDETHEREUM=7]="TYPEDETHEREUM"})(Ae||(Ae={}));var Fi={[Ae.ARWEAVE]:{sigLength:512,pubLength:512,sigName:"arweave"},[Ae.ED25519]:{sigLength:64,pubLength:32,sigName:"ed25519"},[Ae.ETHEREUM]:{sigLength:65,pubLength:65,sigName:"ethereum"},[Ae.SOLANA]:{sigLength:64,pubLength:32,sigName:"solana"},[Ae.INJECTEDAPTOS]:{sigLength:64,pubLength:32,sigName:"injectedAptos"},[Ae.MULTIAPTOS]:{sigLength:64*32+4,pubLength:32*32+1,sigName:"multiAptos"},[Ae.TYPEDETHEREUM]:{sigLength:65,pubLength:42,sigName:"typedEthereum"}},ca=class{signatureType=1;ownerLength=Fi[1].pubLength;signatureLength=Fi[1].sigLength;jwk;pk;constructor(n){this.pk=n.n,this.jwk=n}get publicKey(){return ry.default.toBuffer(this.pk)}sign(n){return or().sign(this.jwk,n)}static async verify(n,t,e){return await or().verify(n,t,e)}},Sh={1:ca},Fe=nn(Vc(),1);async function Fc(n){return bh([(0,Ie.stringToBuffer)("dataitem"),(0,Ie.stringToBuffer)("1"),(0,Ie.stringToBuffer)(n.signatureType.toString()),n.rawOwner,n.rawTarget,n.rawAnchor,n.rawTags,n.rawData])}async function ay(n,t){let e=await Fc(n),r=await t.sign(e),i=await or().hash(r);return{signature:F.Buffer.from(r),id:F.Buffer.from(i)}}async function sy(n,t){let{signature:e,id:r}=await ay(n,t);return n.getRaw().set(e,2),r}var ua=class{buf;pos;constructor(n=F.Buffer.alloc(qc),t=0){this.buf=n,this.pos=t}writeTags(n){if(!Array.isArray(n))throw new Error("input must be array");let t=n.length,e;if(t)for(this.writeLong(t),e=0;e<t;e++){let r=n[e];if(r?.name===void 0||r?.value===void 0)throw new Error(`Invalid tag format for ${r}, expected {name:string, value: string}`);this.writeString(r.name),this.writeString(r.value)}this.writeLong(0)}toBuffer(){let n=F.Buffer.alloc(this.pos);if(this.pos>this.buf.length)throw new Error(`Too many tag bytes (${this.pos} > ${this.buf.length})`);return this.buf.copy(n,0,0,this.pos),n}tagsExceedLimit(){return this.pos>this.buf.length}writeLong(n){let t=this.buf,e,r;if(n>=-1073741824&&n<1073741824){r=n>=0?n<<1:~n<<1|1;do t[this.pos]=r&127,r>>=7;while(r&&(t[this.pos++]|=128))}else{e=n>=0?n*2:-n*2-1;do t[this.pos]=e&127,e/=128;while(e>=1&&(t[this.pos++]|=128))}this.pos++,this.buf=t}writeString(n){let t=F.Buffer.byteLength(n),e=this.buf;this.writeLong(t);let r=this.pos;if(this.pos+=t,!(this.pos>e.length)){if(t>64)this.buf.write(n,this.pos-t,t,"utf8");else{let i,o,a,c;for(i=0,o=t;i<o;i++)a=n.charCodeAt(i),a<128?e[r++]=a:a<2048?(e[r++]=a>>6|192,e[r++]=a&63|128):(a&64512)===55296&&((c=n.charCodeAt(i+1))&64512)===56320?(a=65536+((a&1023)<<10)+(c&1023),i++,e[r++]=a>>18|240,e[r++]=a>>12&63|128,e[r++]=a>>6&63|128,e[r++]=a&63|128):(e[r++]=a>>12|224,e[r++]=a>>6&63|128,e[r++]=a&63|128)}this.buf=e}}readLong(){let n=0,t=0,e=this.buf,r,i,o,a;do r=e[this.pos++],i=r&128,n|=(r&127)<<t,t+=7;while(i&&t<28);if(i){o=n,a=268435456;do r=e[this.pos++],o+=(r&127)*a,a*=128;while(r&128);return(o%2?-(o+1):o)/2}return n>>1^-(n&1)}skipLong(){let n=this.buf;for(;n[this.pos++]&128;);}readTags(){let n=[],t;for(;t=this.readLong();)for(t<0&&(t=-t,this.skipLong());t--;){let e=this.readString(),r=this.readString();n.push({name:e,value:r})}return n}readString(){let n=this.readLong(),t=this.pos,e=this.buf;if(this.pos+=n,!(this.pos>e.length))return this.buf.slice(t,t+n).toString()}};function Eh(n){let t=new ua;return t.writeTags(n),t.toBuffer()}function Gc(n){let t=new ua;return t.writeTags(n),t.tagsExceedLimit()}function $c(n){return new ua(n).readTags()}function Cr(n){let t=0;for(let e=n.length-1;e>=0;e--)t=t*256+n[e];return t}function cy(n){if(n>(2^32-1))throw new Error("Short too long");let t=[0,0];for(let e=0;e<t.length;e++){let r=n&255;t[e]=r,n=(n-r)/256}return Uint8Array.from(t)}function mh(n){let t=[0,0,0,0,0,0,0,0];for(let e=0;e<t.length;e++){let r=n&255;t[e]=r,n=(n-r)/256}return Uint8Array.from(t)}var uy=nn(ty(),1),Pn=nn(Mc(),1),qc=4096,Th=80,sa=class{binary;_id;constructor(n){this.binary=n}static isDataItem(n){return n.binary!==void 0}get signatureType(){let n=Cr(this.binary.subarray(0,2));if(Ae?.[n]!==void 0)return n;throw new Error("Unknown signature type: "+n)}async isValid(){return sa.verify(this.binary)}get id(){return(async()=>Fe.default.encode(await this.rawId))()}set id(n){this._id=Fe.default.toBuffer(n)}get rawId(){return(async()=>Pn.Buffer.from(await uy.Crypto.subtle.digest("SHA-256",this.rawSignature)))()}set rawId(n){this._id=n}get rawSignature(){return this.binary.subarray(2,2+this.signatureLength)}get signature(){return Fe.default.encode(this.rawSignature)}set rawOwner(n){if(n.byteLength!=this.ownerLength)throw new Error(`Expected raw owner (pubkey) to be ${this.ownerLength} bytes, got ${n.byteLength} bytes.`);this.binary.set(n,2+this.signatureLength)}get rawOwner(){return this.binary.subarray(2+this.signatureLength,2+this.signatureLength+this.ownerLength)}get signatureLength(){return Fi[this.signatureType].sigLength}get owner(){return Fe.default.encode(this.rawOwner)}get ownerLength(){return Fi[this.signatureType].pubLength}get rawTarget(){let n=this.getTargetStart();return this.binary[n]==1?this.binary.subarray(n+1,n+33):Pn.Buffer.alloc(0)}get target(){return Fe.default.encode(this.rawTarget)}get rawAnchor(){let n=this.getAnchorStart();return this.binary[n]==1?this.binary.subarray(n+1,n+33):Pn.Buffer.alloc(0)}get anchor(){return this.rawAnchor.toString()}get rawTags(){let n=this.getTagsStart(),t=Cr(this.binary.subarray(n+8,n+16));return this.binary.subarray(n+16,n+16+t)}get tags(){let n=this.getTagsStart();if(Cr(this.binary.subarray(n,n+8))==0)return[];let t=Cr(this.binary.subarray(n+8,n+16));return $c(Pn.Buffer.from(this.binary.subarray(n+16,n+16+t)))}get tagsB64Url(){return this.tags.map(n=>({name:Fe.default.encode(n.name),value:Fe.default.encode(n.value)}))}getStartOfData(){let n=this.getTagsStart(),t=this.binary.subarray(n+8,n+16),e=Cr(t);return n+16+e}get rawData(){let n=this.getTagsStart(),t=this.binary.subarray(n+8,n+16),e=Cr(t),r=n+16+e;return this.binary.subarray(r,this.binary.length)}get data(){return Fe.default.encode(this.rawData)}getRaw(){return this.binary}async sign(n){return this._id=await sy(this,n),this.rawId}async setSignature(n){this.binary.set(n,2),this._id=Pn.Buffer.from(await or().hash(n))}isSigned(){return(this._id?.length??0)>0}toJSON(){return{signature:this.signature,owner:this.owner,target:this.target,tags:this.tags.map(n=>({name:Fe.default.encode(n.name),value:Fe.default.encode(n.value)})),data:this.data}}static async verify(n){if(n.byteLength<Th)return!1;let t=new sa(n),e=t.signatureType,r=t.getTagsStart(),i=Cr(n.subarray(r,r+8)),o=n.subarray(r+8,r+16),a=Cr(o);if(a>qc)return!1;if(i>0)try{if($c(Pn.Buffer.from(n.subarray(r+16,r+16+a))).length!==i)return!1}catch{return!1}let c=Sh[e],l=await Fc(t);return await c.verify(t.rawOwner,l,t.rawSignature)}async getSignatureData(){return Fc(this)}getTagsStart(){let n=this.getTargetStart(),t=this.binary[n]==1,e=n+(t?33:1),r=this.binary[e]==1;return e+=r?33:1,e}getTargetStart(){return 2+this.signatureLength+this.ownerLength}getAnchorStart(){let n=this.getTargetStart()+1,t=this.binary[this.getTargetStart()]==1;return n+=t?32:0,n}},ly=nn(Vc(),1);function jc(n,t,e){let r=t.publicKey,i=e?.target?ly.default.toBuffer(e.target):null,o=1+(i?.byteLength??0),a=e?.anchor?F.Buffer.from(e.anchor):null,c=1+(a?.byteLength??0),l=(e?.tags?.length??0)>0?Eh(e.tags):null,h=16+(l?l.byteLength:0),w=F.Buffer.from(n),v=w.byteLength,T=2+t.signatureLength+t.ownerLength+o+c+h+v,d=F.Buffer.alloc(T);if(d.set(cy(t.signatureType),0),d.set(new Uint8Array(t.signatureLength).fill(0),2),r.byteLength!==t.ownerLength)throw new Error(`Owner must be ${t.ownerLength} bytes, but was incorrectly ${r.byteLength}`);d.set(r,2+t.signatureLength);let y=2+t.signatureLength+t.ownerLength;if(d[y]=i?1:0,i){if(i.byteLength!==32)throw new Error(`Target must be 32 bytes but was incorrectly ${i.byteLength}`);d.set(i,y+1)}let x=y+o,R=x+1;if(d[x]=a?1:0,a){if(R+=a.byteLength,a.byteLength!==32)throw new Error("Anchor must be 32 bytes");d.set(a,x+1)}d.set(mh(e?.tags?.length??0),R);let N=mh(l?.byteLength??0);d.set(N,R+8),l&&d.set(l,R+16);let j=R+h;return d.set(w,j),new sa(d)}var fy={...vh};globalThis.arbundles??=fy;var $i=class{signer;bundlerSigner;type;warp;signatureProviderType;wallet;cachedAddress;constructor(t,e){this.warp=t,this.isCustomSignature(e)?(this.assertEnvForCustomSigner(e.type),this.signer=e.signer,this.type=e.type,this.signatureProviderType="CustomSignature"):this.isValidBundlerSignature(e)?(this.signatureProviderType="BundlerSigner",this.type=hy(e.signatureType),this.bundlerSigner=e):(this.assignArweaveSigner(e),this.bundlerSigner=typeof e=="string"?null:new ca(e),this.signatureProviderType="ArWallet",this.type="arweave"),this.wallet=e}async getAddress(){if(this.cachedAddress)return this.cachedAddress;switch(this.signatureProviderType){case"CustomSignature":return this.wallet.getAddress?this.cachedAddress=await this.wallet.getAddress():this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"ArWallet":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;case"BundlerSigner":return this.cachedAddress=await this.deduceSignerBySigning(),this.cachedAddress;default:throw Error("Unknown Signature::signatureProvider : "+this.signatureProviderType)}}async deduceSignerBySigning(){let{arweave:t}=this.warp;if(this.signatureProviderType=="BundlerSigner")try{return await this.bundlerSigner.getAddress()}catch{throw new Error("Could not get address from the signer. Is the 'getAddress' implementation correct?'")}else if(this.signatureProviderType=="ArWallet"||this.signatureProviderType=="CustomSignature"){let e=await t.createTransaction({data:Math.random().toString().slice(-4),reward:"72600854",last_tx:"p7vc1iSP6bvH_fCeUFa9LqoV5qiyW-jdEKouAT0XMoSwrNraB9mgpi29Q10waEpO"});return await this.signer(e),t.wallets.ownerToAddress(e.owner)}else throw Error("Unknown Signature::type")}checkNonArweaveSigningAvailability(t){if(this.type!=="arweave"&&!t)throw new Error(`Unable to use signing function of type: ${this.type} when bundling is disabled.`)}checkBundlerSignerAvailability(t){if((!t||this.warp.environment=="local")&&this.signatureProviderType=="BundlerSigner")throw new Error("Only wallet of type 'ArWallet' or 'CustomSignature' is allowed when bundling is disabled or in local environment.")}assignArweaveSigner(t){this.signer=async e=>{await this.warp.arweave.transactions.sign(e,t)}}assertEnvForCustomSigner(t){if(this.warp.interactionsLoader.type()==="warp")throw new Error("Unable to use signing function when bundling is enabled.");if(t=="ethereum")throw new Error(`Unable to use signing function with signature of type: ${t}.`)}isCustomSignature(t){return t.signer!==void 0&&t.type!==void 0}isValidBundlerSignature(t){let e=t,r=!!e.signatureType&&!!e.ownerLength&&!!e.signatureLength;if(r&&!e.publicKey)throw new Error("It seems that you are using BundlerSigner, but publicKey is not set! Maybe try calling await bundlerSigner.setPublicKey() before using it.");return r}};function hy(n){if(n===3)return"ethereum";if(n===1)return"arweave";throw Error(`Not supported arbundle SignatureType : ${n}`)}_();var Ki=class{rootOptions;saferEvaluationOptions={internalWrites:t=>{if(t.internalWrites===void 0||this.rootOptions.internalWrites==t.internalWrites)return this.rootOptions.internalWrites;if(this.rootOptions.internalWrites&&!t.internalWrites||!this.rootOptions.internalWrites&&t.internalWrites)return t.internalWrites;throw new Error('Could not determine "internalWrites" value ')},throwOnInternalWriteError:t=>t.throwOnInternalWriteError===void 0?this.rootOptions.throwOnInternalWriteError:t.throwOnInternalWriteError,unsafeClient:t=>{if(t.unsafeClient===void 0||this.rootOptions.unsafeClient==t.unsafeClient)return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="throw"||this.rootOptions.unsafeClient==="skip")return this.rootOptions.unsafeClient;if(this.rootOptions.unsafeClient==="allow")return t.unsafeClient==="throw"?"skip":t.unsafeClient;throw new Error('Could not determine "unsafeClient" value')},ignoreExceptions:t=>{if(t.ignoreExceptions===void 0||this.rootOptions.ignoreExceptions==t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(this.rootOptions.ignoreExceptions&&!t.ignoreExceptions)return this.rootOptions.ignoreExceptions;if(!this.rootOptions.ignoreExceptions&&t.ignoreExceptions)return this.rootOptions.ignoreExceptions;throw new Error('Could not determine "ignoreExceptions" value')},waitForConfirmation:()=>this.rootOptions.waitForConfirmation,updateCacheForEachInteraction:()=>this.rootOptions.updateCacheForEachInteraction,maxCallDepth:()=>this.rootOptions.maxCallDepth,maxInteractionEvaluationTimeSeconds:()=>this.rootOptions.maxInteractionEvaluationTimeSeconds,stackTrace:()=>this.rootOptions.stackTrace,sourceType:()=>this.rootOptions.sourceType,sequencerUrl:()=>this.rootOptions.sequencerUrl,gasLimit:()=>this.rootOptions.gasLimit,allowBigInt:()=>this.rootOptions.allowBigInt,walletBalanceUrl:()=>this.rootOptions.walletBalanceUrl,mineArLocalBlocks:()=>this.rootOptions.mineArLocalBlocks,cacheEveryNInteractions:()=>this.rootOptions.cacheEveryNInteractions,remoteStateSyncEnabled:()=>this.rootOptions.remoteStateSyncEnabled,remoteStateSyncSource:()=>this.rootOptions.remoteStateSyncSource,useKVStorage:t=>t.useKVStorage,useConstructor:t=>t.useConstructor,whitelistSources:()=>this.rootOptions.whitelistSources,transactionsPagesPerBatch:()=>this.rootOptions.transactionsPagesPerBatch,strictSortKey:()=>this.rootOptions.strictSortKey,strictEvolve:()=>this.rootOptions.strictEvolve};notConflictingEvaluationOptions=["useKVStorage","sourceType","useConstructor","transactionsPagesPerBatch","strictSortKey"];constructor(t,e){if(e){let r=[];for(let i in e){if(!t.hasOwnProperty(i))throw new Error("Unknown option set in contract's manifest. You probably need to update the Warp SDK version.");let o=i,a=e[i],c=t[i];if(!this.notConflictingEvaluationOptions.includes(o))if(o==="internalWrites"){if(c===!1&&a===!0)throw new Error("Cannot proceed with contract evaluation. User is blocking internal writes, while contract requires them.")}else if(o==="unsafeClient"){if(c==="throw"&&a!=="throw"||c==="skip"&&a==="allow")throw new Error(`Cannot proceed with contract evaluation. User requires to ${c} on any unsafeClient usage, while contract uses ${a} option.`)}else t[i]!==e[i]&&r.push(`Option {${i}} differs. EvaluationOptions: [${t[i]}], manifest: [${e[i]}]. Use contract.setEvaluationOptions({${i}: ${e[i]}}) to evaluate contract state.`)}if(r.length)throw new Error(r.join(`
`))}this.rootOptions=Object.freeze(Object.assign({},t,e||{}))}forForeignContract(t){let e=_r(this.rootOptions);if(t)for(let r in t)e[r]=this.saferEvaluationOptions[r](t);return Object.freeze(e)}};_();var Vi=class{constructor(t){this.warp=t;this.warp=t}name="WarpFetchWrapper";logger=ct.INST.create(this.name);fetch(t,e){let r;if(this.warp.hasPlugin("fetch-options")){let i=this.warp.loadPlugin("fetch-options");try{let o=i.process({input:t,init:e||{}});r={...e,...o}}catch(o){throw o.message&&this.logger.error(o.message),new Error(`Unable to process fetch options: ${o.message}`)}}else r=e;return fetch(t,r)}};_();var DS=new Error("timeout while waiting for mutex to become available"),MS=new Error("mutex already locked"),gy=new Error("request for lock canceled"),dy=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function c(w){try{h(r.next(w))}catch(v){a(v)}}function l(w){try{h(r.throw(w))}catch(v){a(v)}}function h(w){w.done?o(w.value):i(w.value).then(c,l)}h((r=r.apply(n,t||[])).next())})},Hc=class{constructor(t,e=gy){this._value=t,this._cancelError=e,this._weightedQueues=[],this._weightedWaiters=[]}acquire(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((e,r)=>{this._weightedQueues[t-1]||(this._weightedQueues[t-1]=[]),this._weightedQueues[t-1].push({resolve:e,reject:r}),this._dispatch()})}runExclusive(t,e=1){return dy(this,void 0,void 0,function*(){let[r,i]=yield this.acquire(e);try{return yield t(r)}finally{i()}})}waitForUnlock(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise(e=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),this._weightedWaiters[t-1].push(e),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatch()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatch()}cancel(){this._weightedQueues.forEach(t=>t.forEach(e=>e.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var t;for(let e=this._value;e>0;e--){let r=(t=this._weightedQueues[e-1])===null||t===void 0?void 0:t.shift();if(!r)continue;let i=this._value,o=e;this._value-=e,e=this._value+1,r.resolve([i,this._newReleaser(o)])}this._drainUnlockWaiters()}_newReleaser(t){let e=!1;return()=>{e||(e=!0,this.release(t))}}_drainUnlockWaiters(){for(let t=this._value;t>0;t--)this._weightedWaiters[t-1]&&(this._weightedWaiters[t-1].forEach(e=>e()),this._weightedWaiters[t-1]=[])}},py=function(n,t,e,r){function i(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function c(w){try{h(r.next(w))}catch(v){a(v)}}function l(w){try{h(r.throw(w))}catch(v){a(v)}}function h(w){w.done?o(w.value):i(w.value).then(c,l)}h((r=r.apply(n,t||[])).next())})},la=class{constructor(t){this._semaphore=new Hc(1,t)}acquire(){return py(this,void 0,void 0,function*(){let[,t]=yield this._semaphore.acquire();return t})}runExclusive(t){return this._semaphore.runExclusive(()=>t())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};_();_();var fa=class{cache;capacity;constructor(t){this.cache=new Map,this.capacity=t||10}has(t){return this.cache.has(t)}size(){return this.cache.size}get(t){if(!this.cache.has(t))return null;let e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){this.cache.delete(t),this.cache.size===this.capacity?(this.cache.delete(this.cache.keys().next().value),this.cache.set(t,e)):this.cache.set(t,e)}keys(){return Array.from(this.cache.keys())}};var Gi=class{constructor(t){this._warp=t}_json=new Map;_initialJson=new Map;_kv=new Map;has(t,e){return this._json.get(t)?.has(e)||!1}get(t,e){return this._json.get(t)?.get(e)||null}getLessOrEqual(t,e){let r=this._json.get(t);if(r!=null&&r.size()>0){let i=r.keys();e&&(i=i.filter(a=>a.localeCompare(e)<=0)),i=i.sort((a,c)=>a.localeCompare(c));let o=i[i.length-1];if(r.get(o))return new Pt(o,r.get(o))}return null}async getKV(t,e){return this._kv.has(t)&&(await this._kv.get(t).get(e))?.cachedValue||null}async delKV(t,e){this._kv.has(t)&&await this._kv.get(t).del(e)}getKvKeys(t,e,r){return this._warp.kvStorageFactory(t).keys(e,r)}getKvRange(t,e,r){return this._warp.kvStorageFactory(t).kvMap(e,r)}async commit(t,e=!1){if(t.dry)return await this.rollbackKVs(),this.reset();try{let r=new Map;this._json.forEach((i,o)=>{let a=this.getLessOrEqual(o,t.sortKey);a!=null&&r.set(o,a.cachedValue)}),await this.doStoreJson(r,t,e),await this.commitKVs()}finally{this.reset()}}async commitKV(){await this.commitKVs(),this._kv.clear()}async rollback(t,e){try{await this.doStoreJson(this._initialJson,t,e),await this.rollbackKVs()}finally{this.reset()}}setInitial(t,e,r){this._initialJson.set(t,e),this.update(t,e,r)}update(t,e,r){if(!this._json.has(t)){let i=new fa(10);this._json.set(t,i)}this._json.get(t).set(r,e)}async updateKV(t,e,r){await(await this.getOrInitKvStorage(t)).put(e,r)}async getOrInitKvStorage(t){if(this._kv.has(t))return this._kv.get(t);let e=this._warp.kvStorageFactory(t);return this._kv.set(t,e),await e.open(),e}reset(){this._json.clear(),this._initialJson.clear(),this._kv.clear()}async doStoreJson(t,e,r=!1){if(t.size>1||r)for(let[i,o]of t)await this._warp.stateEvaluator.putInCache(i,e,o)}async rollbackKVs(){for(let t of this._kv.values())try{await t.rollback()}finally{await t.close()}}async commitKVs(){for(let t of this._kv.values())try{await t.commit()}finally{await t.close()}}};var qi=Gt(Ze());var on=class{constructor(t,e,r=null,i=null){this._contractTxId=t;this.warp=e;this._parentContract=r;this._innerCallData=i;if(this.waitForConfirmation=this.waitForConfirmation.bind(this),this._arweaveWrapper=new Zt(e),this._sorter=new tr(e.arweave),r!=null){this._evaluationOptions=this.getRoot().evaluationOptions(),this._callDepth=r.callDepth()+1;let o=r.getCallStack().getInteraction(i.callingInteraction.id);if(this._callDepth>this._evaluationOptions.maxCallDepth)throw new Error(`Max call depth of ${this._evaluationOptions.maxCallDepth} has been exceeded for interaction ${JSON.stringify(o.interactionInput)}`);if(this.logger.debug("Calling interaction",{id:i.callingInteraction.id,sortKey:i.callingInteraction.sortKey,type:i.callType}),o.interactionInput?.foreignContractCalls[t]?.innerCallType==="write"&&i.callType==="read")throw new Error("Calling a readContractState after performing an inner write is wrong - instead use a state from the result of an internal write.");let a=new tn(t,this._callDepth,i?.callType);o.interactionInput.foreignContractCalls[t]=a,this._callStack=a,this._rootSortKey=r.rootSortKey,r._children.push(this)}else this._callDepth=0,this._callStack=new tn(t,0),this._rootSortKey=null,this._evaluationOptions=new hi,this._children=[],this._interactionState=new Gi(e);this.getCallStack=this.getCallStack.bind(this),this._warpFetchWrapper=new Vi(this.warp)}logger=ct.INST.create("HandlerBasedContract");ecLogger=ct.INST.create("ExecutionContext");_innerWritesEvaluator=new Mi;_callDepth;_arweaveWrapper;_mutex=new la;_callStack;_evaluationOptions;_eoEvaluator;_benchmarkStats=null;_sorter;_rootSortKey;_signature;_warpFetchWrapper;_children=[];_interactionState;_dreStates=new Map;maxInteractionDataItemSizeBytes;async readState(t,e,r,i){if(this.logger.info("Read state for",{contractTxId:this._contractTxId,sortKeyOrBlockHeight:t}),!this.isRoot()&&t==null)throw new Error("SortKey MUST be always set for non-root contract calls");let{stateEvaluator:o}=this.warp,a=typeof t=="number"?this._sorter.generateLastSortKey(t):t;if(a&&!this.isRoot()&&this.interactionState().has(this.txId(),a)){let l=this.interactionState().get(this.txId(),a);return new Pt(a,l)}let c=await this._mutex.acquire();try{let l=bt.measure();this.maybeResetRootContract();let h=await this.createExecutionContext(this._contractTxId,a,!1,e,r,i);this.logger.info("Execution Context",{srcTxId:h.contractDefinition?.srcTxId,missingInteractions:h.sortedInteractions?.length,cachedSortKey:h.cachedState?.sortKey}),l.stop();let w=bt.measure(),v=await o.eval(h);w.stop();let T=l.elapsed(!0)+w.elapsed(!0);return this._benchmarkStats={gatewayCommunication:l.elapsed(!0),stateEvaluation:w.elapsed(!0),total:T},this.logger.info("Benchmark",{"Gateway communication  ":l.elapsed(),"Contract evaluation    ":w.elapsed(),"Total:                 ":`${T.toFixed(0)}ms`}),a&&!this.isRoot()&&this.interactionState().update(this.txId(),v.cachedValue,a),v}finally{c()}}async readStateFor(t,e,r,i){return this.readState(t,e,r,i)}async readStateBatch(t=1,e,r){if(!this.isRoot())throw new Error("readStateBatch is only allowed for root contract calls");if(t<1)throw new Error("At least one page per batch is required");if(r?.aborted)throw new oe("readStateBatch aborted");let i=this._contractTxId,{interactionsLoader:o,stateEvaluator:a}=this.warp,c=await a.latestAvailableState(i),l={...this._evaluationOptions,transactionsPagesPerBatch:t},h,w=0;do{let v=bt.measure();if(this.logger.debug(`Loading ${w+1} batch`,l),h=await o.load(i,c?.sortKey,e,l),r?.aborted)throw new oe("readStateBatch aborted");if(h.length==0&&w>0)break;if(this.logger.debug(`Evaluating ${h.length} in ${w+1} batch`),c=await this.readStateFor(c?.sortKey||er,h,r),r?.aborted)throw new oe("readStateBatch aborted");this.logger.debug(`Batch ${w+1} evaluated in ${v.elapsed()} at sortKey ${c.sortKey}`),w++}while(h.length>0);return c}async viewState(t,e=[],r=xr,i,o,a){return this.logger.info("View state for",this._contractTxId),await this.callContract(t,"view",i,a,e,r,!1,!1,!0,o)}async viewStateForTx(t,e,r){return this.logger.info(`View state for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"view",r)}async dryWrite(t,e,r,i,o,a){return this.logger.info("Dry-write for",this._contractTxId),await this.callContract(t,"write",e,a,r,i,void 0,o)}async applyInput(t,e,r){return this.logger.info(`Apply-input from transaction ${e.id} for ${this._contractTxId}`),await this.doApplyInputOnTx(t,e,"write",r)}async writeInteraction(t,e){if(this.logger.info("Write interaction",{input:t,options:e}),!this._signature)throw new Error("Wallet not connected. Use 'connect' method first.");let{arweave:r,interactionsLoader:i,environment:o}=this.warp;await this.warp.definitionLoader.load(this._contractTxId);let a=e?.tags||[],c=e?.transfer||xr,l=e?.strict===!0,h=e?.vrf===!0,w=e?.disableBundling===!0,v=e?.reward,T=e?.manifestData,d=i.type()=="warp"&&!w;if(this._signature.checkNonArweaveSigningAvailability(d),this._signature.checkBundlerSignerAvailability(d),d&&c.target!=xr.target&&c.winstonQty!=xr.winstonQty)throw new Error("Ar Transfers are not allowed for bundled interactions");if(h&&!d&&o==="mainnet")throw new Error("Vrf generation is only available for bundle interaction");if(!t)throw new Error(`Input should be a truthy value: ${JSON.stringify(t)}`);if(d)return await this.bundleInteraction(t,{tags:a,strict:l,vrf:h,manifestData:T});{let y=await this.createInteraction(t,a,c,l,!1,h&&o!=="mainnet",v),x=await r.transactions.post(y);if(x.status!==200)return this.logger.error("Error while posting transaction",x),null;if(this._evaluationOptions.waitForConfirmation){this.logger.info("Waiting for confirmation of",y.id);let R=bt.measure();await this.waitForConfirmation(y.id),this.logger.info("Transaction confirmed after",R.elapsed())}return this.warp.environment=="local"&&this._evaluationOptions.mineArLocalBlocks&&await this.warp.testing.mineBlock(),{originalTxId:y.id,interactionTx:y}}}async bundleInteraction(t,e){if(this.logger.info("Bundle interaction input",t),!this.maxInteractionDataItemSizeBytes){let a=fetch(`${Te(this.warp.gwUrl())}`);this.maxInteractionDataItemSizeBytes=(await he(a)).maxInteractionDataItemSizeBytes}let r=await this.createInteractionDataItem(t,e.tags,xr,e.strict,e.vrf,e.manifestData),i=this._warpFetchWrapper.fetch(`${Te(this._evaluationOptions.sequencerUrl)}/gateway/v2/sequencer/register`,{method:"POST",headers:{"Content-Type":"application/octet-stream",Accept:"application/json"},body:r.getRaw()}),o=await r.id;return{bundlrResponse:await he(i),originalTxId:o,interactionTx:r}}async createInteractionDataItem(t,e,r,i,o=!1,a){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,o),o&&e.push(new Dt(st.REQUEST_VRF,"true"));let c=aa(this._contractTxId,t,this.warp.environment==="testnet",e),l;Gc(c)&&(c=[...c.filter(v=>v.name!=Tt.INPUT&&v.name!=st.INPUT_FORMAT),new Dt(st.INPUT_FORMAT,"data")],l={input:t}),a&&(l={...l,manifest:this.createManifest(a)}),l=l?JSON.stringify(l):Math.random().toString().slice(-4);let h=this._signature.bundlerSigner;if(!h)throw new Error("Signer not set correctly. If you connect wallet through 'use_wallet', please remember that it only works when bundling is disabled.");let w;if(Qr()&&h.signer?.signDataItem?w=await h.signDataItem(l,c):(w=jc(l,h,{tags:c}),await w.sign(h)),w.getRaw().length>this.maxInteractionDataItemSizeBytes)throw new Error(`Interaction data item size: ${w.getRaw().length} exceeds maximum interactions size limit: ${this.maxInteractionDataItemSizeBytes}.`);return!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(w.owner,t,e,r,i,o),w}async createInteraction(t,e,r,i,o=!1,a=!1,c){this._evaluationOptions.internalWrites&&await this.discoverInternalWrites(t,e,r,i,a),a&&e.push(new Dt(st.REQUEST_VRF,"true"));let l=await oa(this.warp.arweave,this._signature.signer,this._contractTxId,t,e,r.target,r.winstonQty,o,this.warp.environment==="testnet",c);return!this._evaluationOptions.internalWrites&&i&&await this.checkInteractionInStrictMode(l.owner,t,e,r,i,a),l}async checkInteractionInStrictMode(t,e,r,i,o,a){let{arweave:c}=this.warp,l=this._signature.type=="arweave"?await c.wallets.ownerToAddress(t):await this._signature.getAddress(),h=await this.callContract(e,"write",l,void 0,r,i,o,a);if(h.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(h.error||h.errorMessage))}txId(){return this._contractTxId}getCallStack(){return this._callStack}connect(t){return this._signature=new $i(this.warp,t),this}setEvaluationOptions(t){if(!this.isRoot())throw new Error("Evaluation options can be set only for the root contract");return this._evaluationOptions={...this._evaluationOptions,...t},this}async waitForConfirmation(t){let{arweave:e}=this.warp,r=await e.transactions.getStatus(t);return r.confirmed===null?(this.logger.info(`Transaction ${t} not yet confirmed. Waiting another 20 seconds before next check.`),await li(2e4),this.waitForConfirmation(t)):(this.logger.info(`Transaction ${t} confirmed`,r),r)}async createExecutionContext(t,e,r=!1,i,o,a){let{definitionLoader:c,interactionsLoader:l,stateEvaluator:h}=this.warp,w,v=bt.measure();if(this.isRoot()||(w=this.interactionState().getLessOrEqual(this.txId(),e)),w=a||w||await h.latestAvailableState(t,e),e&&this.evaluationOptions().strictSortKey&&w?.sortKey!=e)throw new Error(`State not cached at the exact required ${e} sortKey`);this.logger.debug("cache lookup",v.elapsed()),v.reset();let T=ir.evolvedSrcTxId(w?.cachedValue?.state),d,y,x,R,N=i||[];if(this.logger.debug("Cached state",w,e),w&&w.sortKey==e||e==er&&i?.length)this.logger.debug("State fully cached, not loading interactions."),(r||T||i?.length)&&(y=await c.load(t,T),x=this.resolveEvaluationOptions(y.manifest?.evaluationOptions),this.warp.executorFactory.checkWhiteListContractSources(y,x),i?.length&&(N=await this.getSortedInteractions(i)));else{if(i?.length)throw new Error(`Cannot apply requested interactions at ${e}`);if(y=await c.load(t,T),x=this.resolveEvaluationOptions(y.manifest?.evaluationOptions),x.remoteStateSyncEnabled&&!x.useKVStorage){R=await this.getRemoteContractState(t),w=await this.maybeSyncStateWithRemoteSource(R,e,w);let j=ir.evolvedSrcTxId(w?.cachedValue?.state);j&&j!==y.srcTxId&&(y=await c.load(t,j))}this.warp.executorFactory.checkWhiteListContractSources(y,x),!R&&N.length==0&&(N=await l.load(t,w?.sortKey,this.getToSortKey(e),x)),w?.sortKey&&(N=N.filter(j=>j.sortKey.localeCompare(w?.sortKey)>0)),e&&(N=N.filter(j=>j.sortKey.localeCompare(e)<=0)),this.logger.debug("contract and interactions load",v.elapsed()),this.isRoot()&&N.length&&(this._rootSortKey=N[N.length-1].sortKey)}return y&&(x||(x=this.resolveEvaluationOptions(y.manifest?.evaluationOptions)),this.ecLogger.debug(`Evaluation options ${t}:`,x),d=await this.warp.executorFactory.create(y,x,this.warp,this.interactionState())),{warp:this.warp,contract:this,contractDefinition:y,sortedInteractions:N,evaluationOptions:x||this.evaluationOptions(),handler:d,cachedState:w,requestedSortKey:e,signal:o}}async getSortedInteractions(t){return(await this._sorter.sort(t.map(e=>({node:e,cursor:null})))).map(e=>e.node)}resolveEvaluationOptions(t){return this.isRoot()?(this._eoEvaluator=new Ki(this.evaluationOptions(),t),this._eoEvaluator.rootOptions):this.getRootEoEvaluator().forForeignContract(t)}async getRemoteContractState(t){if(this.hasDreState(t))return this.getDreState(t);{let e=await this.fetchRemoteContractState(t);return e!=null?this.setDREState(t,e):null}}async fetchRemoteContractState(t){return he(this._warpFetchWrapper.fetch(`${this._evaluationOptions.remoteStateSyncSource}?id=${t}&events=false`))}getToSortKey(t){return this._parentContract?.rootSortKey?t?this._parentContract.rootSortKey.localeCompare(t)>0?this._parentContract.rootSortKey:t:this._parentContract.rootSortKey:t}async createExecutionContextFromTx(t,e,r){let i=e.owner.address,o=e.sortKey;return{...await this.createExecutionContext(t,o,!0,void 0,r),caller:i}}maybeResetRootContract(){this.isRoot()&&(this.logger.debug("Clearing call stack for the root contract"),this._callStack=new tn(this.txId(),0),this._rootSortKey=null,this.warp.interactionsLoader.clearCache(),this._children=[],this._interactionState=new Gi(this.warp),this._dreStates=new Map)}async callContract(t,e,r,i,o=[],a=xr,c=!1,l=!1,h=!0,w){this.logger.info("Call contract input",t),this.maybeResetRootContract(),this._signature||this.logger.warn("Wallet not set.");let{arweave:v,stateEvaluator:T}=this.warp,d=await this.createExecutionContext(this._contractTxId,i,!0,void 0,w),y=i?await this._sorter.extractBlockHeight(i):void 0,x;this.warp.environment=="mainnet"&&this.warp.interactionsLoader.type()!=="arweave"?x=await this._arweaveWrapper.warpGwBlock():y?x=await v.blocks.getByHeight(y):x=await v.blocks.getCurrent();let R;r?R=r:this._signature?R=await this._signature.getAddress():R="",this.logger.info("effectiveCaller",R),d={...d,caller:R};let N=await T.eval(d);this.logger.info("Current state",N.cachedValue.state);let j={input:t,caller:d.caller,interactionType:e};this.logger.debug("interaction",j);let z=await oa(v,h?this._signature?.signer:void 0,this._contractTxId,t,o,a.target,a.winstonQty,!0,this.warp.environment==="testnet"),Z=Wc(z,d.caller,x);if(this.logger.debug("Creating sortKey for",{blockId:Z.block.id,id:Z.id,height:Z.block.height}),Z.sortKey=await this._sorter.createSortKey(Z.block.id,Z.id,Z.block.height,!0),Z.strict=c,l){let V=this.warp.maybeLoadPlugin("vrf");V?Z.vrf=V.process().generateMockVrf(Z.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')}let W=await this.evalInteraction({interaction:j,interactionTx:Z},d,N.cachedValue);return W.type!=="ok"&&this.logger.fatal("Error while interacting with contract",{type:W.type,error:W.errorMessage}),W}async doApplyInputOnTx(t,e,r,i){this.maybeResetRootContract();let o,a=await this.createExecutionContextFromTx(this._contractTxId,e,i);!this.isRoot()&&this.interactionState().has(this.txId(),e.sortKey)?o=new Pt(e.sortKey,this.interactionState().get(this.txId(),e.sortKey)):(o=await this.warp.stateEvaluator.eval(a),this.interactionState().update(this.txId(),o.cachedValue,e.sortKey)),this.logger.debug("callContractForTx - evalStateResult",{result:o.cachedValue.state,txId:this._contractTxId});let l={interaction:{input:t,caller:this._parentContract.txId(),interactionType:r},interactionTx:e},h=await this.evalInteraction(l,a,o.cachedValue);return h.originalValidity=o.cachedValue.validity,h.originalErrorMessages=o.cachedValue.errorMessages,h}async evalInteraction(t,e,r){let i=this.getCallStack().addInteractionData(t),o=bt.measure();await e.handler.initState(r.state);let a=await e.handler.handle(e,r,t);return i.update({cacheHit:!1,outputState:this._evaluationOptions.stackTrace.saveState?a.state:void 0,executionTime:o.elapsed(!0),valid:a.type==="ok",errorMessage:a.errorMessage,gasUsed:a.gasUsed}),a}parent(){return this._parentContract}callDepth(){return this._callDepth}evaluationOptions(){return this._evaluationOptions}lastReadStateStats(){return this._benchmarkStats}async stateHash(t){let e=ph(t),r=await qi.Crypto.subtle.digest("SHA-256",qi.Buffer.from(e,"utf-8"));return qi.Buffer.from(r).toString("hex")}async syncState(t,e){let{stateEvaluator:r}=this.warp,i=await this._warpFetchWrapper.fetch(`${t}?${new URLSearchParams({id:this._contractTxId,...e})}`).then(o=>o.ok?o.json():Promise.reject(o)).catch(o=>{throw o.body?.message&&this.logger.error(o.body.message),new Error(`Unable to retrieve state. ${o.status}: ${o.body?.message}`)});return await r.syncState(this._contractTxId,i.sortKey,i.state,i.validity),this}async evolve(t,e){return await this.writeInteraction({function:"evolve",value:t},e)}get rootSortKey(){return this._rootSortKey}getRootEoEvaluator(){return this.getRoot()._eoEvaluator}isRoot(){return this._parentContract==null}async getStorageValues(t){let e=await this.warp.stateEvaluator.getCache().getLast(this.txId());if(e==null)return new Pt(null,new Map);let r=this.warp.kvStorageFactory(this.txId()),i=new Map;try{await r.open();for(let o of t){let a=await r.getLessOrEqual(o,e.sortKey);i.set(o,a==null?null:a.cachedValue)}return new Pt(e.sortKey,i)}finally{await r.close()}}interactionState(){return this.getRoot()._interactionState}getRoot(){let t=this;for(;!t.isRoot();)t=t.parent();return t}async maybeSyncStateWithRemoteSource(t,e,r){let{stateEvaluator:i}=this.warp;return this.isStateHigherThanAndUpTo(t,r?.sortKey,e)?await i.syncState(this._contractTxId,t.sortKey,t.cachedValue.state,t.cachedValue.validity):r}isStateHigherThanAndUpTo(t,e,r){return t&&(!r||r>=t.sortKey)&&(!e||t.sortKey>e)}setDREState(t,e){let r=new Pt(e.sortKey,new Ut(e.state,{},e.errorMessages));return this.getRoot()._dreStates.set(t,r),r}getDreState(t){return this.getRoot()._dreStates.get(t)}hasDreState(t){return this.getRoot()._dreStates.has(t)}async discoverInternalWrites(t,e,r,i,o){let a=await this.callContract(t,"write",void 0,void 0,e,r,i,o,!1);if(i&&a.type!=="ok")throw Error("Cannot create interaction: "+JSON.stringify(a.error||a.errorMessage));let c=this.getCallStack(),l=this._innerWritesEvaluator.eval(c);this.logger.debug("Input",t),this.logger.debug("Callstack",c.print()),l.forEach(h=>{e.push(new Dt(st.INTERACT_WRITE,h))}),this.logger.debug("Tags with inner calls",e)}clearChildren(){for(let t of this._children)t.clearChildren();this._children=[]}createManifest(t){let e={};return Object.keys(t).forEach(r=>{let i=t[r];if(typeof r!="string")throw new Error("Incorrect manifest data. Manifest key should be of type 'string'");if(typeof i!="string")throw new Error("Incorrect manifest data. Manifest value should be of type 'string'");if(!Ms(i))throw new Error(`Incorrect manifest data. Transaction id: ${i} is not valid.`);e[r]=t[r]}),e}};_();var ji=class extends on{async currentBalance(t){let e=await this.viewState({function:"balance",target:t});if(e.type!=="ok")throw Error(e.errorMessage);return e.result}async currentState(){return(await super.readState()).cachedValue.state}async transfer(t,e){return await this.writeInteraction({function:"transfer",...t},e)}};_();var ha=class{constructor(t){this.arweave=t}async mineBlock(){this.validateEnv(),await this.arweave.api.get("mine")}async addFunds(t){let e=await this.arweave.wallets.getAddress(t);await this.arweave.api.get(`/mint/${e}/1000000000000000`)}async isArlocal(){return(await fetch(`${this.arweave.api.config.protocol}://${this.arweave.api.config.host}:${this.arweave.api.config.port}/info`).then(e=>e.ok?e.json():Promise.reject()).catch(e=>{throw new Error(`Unable to get network info: ${e.message}`)})).network.includes("arlocal")}async validateEnv(){if(!await this.isArlocal())throw new Error("Testing features are not available in a non testing environment")}};_();_();var ga=class{constructor(t,e){this.baseImplementation=t;this.sourceCode=e}async create(t,e,r,i){return Object.prototype.hasOwnProperty.call(this.sourceCode,t.txId)&&(t={...t,src:this.sourceCode[t.txId]}),await this.baseImplementation.create(t,e,r,i)}checkWhiteListContractSources(t,e){return this.baseImplementation.checkWhiteListContractSources(t,e)}};_();var xh=Gt(Ze());var Hi=class{constructor(t,e,r){this.contractDefinitionLoader=t;this.env=e;this.definitionCache=new De({...r,dbLocation:`${r.dbLocation}/contracts`}),this.srcCache=new De({...r,dbLocation:`${r.dbLocation}/source`})}rLogger=ct.INST.create("CacheableContractDefinitionLoader");definitionCache;srcCache;async load(t,e){let r=await this.getFromCache(t,e);if(r)return this.rLogger.debug("Hit from cache!",t,e),r.contractType=="wasm"&&r.srcBinary.data&&(r.srcBinary=xh.Buffer.from(r.srcBinary.data)),this.verifyEnv(r),r;let i=bt.measure(),o=await this.contractDefinitionLoader.load(t,e);return this.rLogger.info(`Contract definition loaded in: ${i.elapsed()}`),this.verifyEnv(o),await this.putToCache(t,o,e),o}async loadContractSource(t){return await this.contractDefinitionLoader.loadContractSource(t)}type(){return this.contractDefinitionLoader.type()}setCache(t){this.definitionCache=t}setSrcCache(t){this.srcCache=t}getCache(){return this.definitionCache}getSrcCache(){return this.srcCache}verifyEnv(t){if(t.testnet&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!t.testnet&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.")}async getFromCache(t,e){let r=await this.definitionCache.get(new Qt(t,"cd"));if(!r)return null;let i=e||r.cachedValue.srcTxId,o=await this.srcCache.get(new Qt(i,"src"));return o?{...r.cachedValue,...o.cachedValue,srcTxId:i}:null}async putToCache(t,e,r){let i=new di(e),o=new pi(e);await this.definitionCache.put({key:t,sortKey:"cd"},o),await this.srcCache.put({key:r||o.srcTxId,sortKey:"src"},i)}set warp(t){this.contractDefinitionLoader.warp=t}};var Qi=class{constructor(t,e,r="custom"){this._arweave=t;this._stateCache=e;this._environment=r}_definitionLoader;_interactionsLoader;_executorFactory;_stateEvaluator;setDefinitionLoader(t){return this._definitionLoader=t,this}setInteractionsLoader(t){return this._interactionsLoader=t,this}setExecutorFactory(t){return this._executorFactory=t,this}setStateEvaluator(t){return this._stateEvaluator=t,this}overwriteSource(t){if(this._executorFactory==null)throw new Error("Set base ExecutorFactory first");return this._executorFactory=new ga(this._executorFactory,t),this.build()}useWarpGateway(t,e){return this._interactionsLoader=new On(new zr(t.confirmationStatus,t.source)),this._definitionLoader=new Hi(new Ni(this._arweave,this._environment),this._environment,e),this}useArweaveGateway(t){return this._interactionsLoader=new On(new Ui(this._arweave,this._environment)),this._definitionLoader=new Hi(new Xr(this._arweave,this._environment),this._environment,t),this}build(){let t=new an(this._arweave,this._definitionLoader,this._interactionsLoader,this._executorFactory,this._stateEvaluator,this._environment);return this._definitionLoader.warp=t,this._interactionsLoader.warp=t,t}};_();var Qc=["^smartweave-extension-"],zc=["evm-signature-verification","subscription","ivm-handler-api","evaluation-progress","fetch-options","deploy","contract-blacklist","vm2","vrf"];var an=class{constructor(t,e,r,i,o,a="custom"){this.arweave=t;this.definitionLoader=e;this.interactionsLoader=r;this.executorFactory=i;this.stateEvaluator=o;this.environment=a;this.testing=new ha(t),this.kvStorageFactory=c=>new De({inMemory:!1,dbLocation:`${da}/kv/ldb/${c}`}),this.eventTarget=new EventTarget}_createContract;_gwUrl=Yc;get createContract(){if(!this._createContract)if(this.plugins.has("deploy")){let t=this.loadPlugin("deploy");this._createContract=t.process(this)}else throw new Error("In order to use CreateContract methods please attach DeployPlugin.");return this._createContract}testing;kvStorageFactory;whoAmI;eventTarget;plugins=new Map;static builder(t,e,r){return new Qi(t,e,r)}contract(t,e,r){return new on(t,this,e,r)}async deploy(t,e){return await this.createContract.deploy(t,e)}async deployFromSourceTx(t,e){return await this.createContract.deployFromSourceTx(t,e)}async deployBundled(t){return await this.createContract.deployBundled(t)}async register(t,e){return await this.createContract.register(t,e)}async createSource(t,e,r=!1){return await this.createContract.createSource(t,e,r)}async saveSource(t,e){return await this.createContract.saveSource(t,e)}pst(t){return new ji(t,this)}useStateCache(t){return this.stateEvaluator.setCache(t),this}useContractCache(t,e){return this.definitionLoader.setSrcCache(e),this.definitionLoader.setCache(t),this}use(t){let e=t.type();if(!this.isPluginType(e))throw new Error(`Unknown plugin type ${e}.`);return this.plugins.set(e,t),this}hasPlugin(t){return this.plugins.has(t)}matchPlugins(t){return[...this.plugins.keys()].filter(r=>r.match(t))}loadPlugin(t){if(!this.hasPlugin(t))throw new Error(`Plugin ${t} not registered.`);return this.plugins.get(t)}maybeLoadPlugin(t){return this.hasPlugin(t)?this.plugins.get(t):null}async close(){return Promise.all([this.definitionLoader.getSrcCache().close(),this.definitionLoader.getCache().close(),this.stateEvaluator.getCache().close()]).then()}async generateWallet(){let t=await this.arweave.wallets.generate();return await this.testing.isArlocal()&&await this.testing.addFunds(t),{jwk:t,address:await this.arweave.wallets.jwkToAddress(t)}}isPluginType(t){return zc.includes(t)||Qc.some(e=>t.match(e))}useKVStorageFactory(t){return this.kvStorageFactory=t,this}useGwUrl(t){return this._gwUrl=t,this}gwUrl(){return this._gwUrl}};var ma={confirmationStatus:{notCorrupted:!0},source:"both"},Yc="https://gw.warp.cc",da="./cache/warp",Nn={inMemory:!1,dbLocation:da},Jc=class{static forLocal(t=1984,e=pa.default.init({host:"localhost",port:t,protocol:"http"}),r={...Nn,inMemory:!0}){return this.customArweaveGw(e,r,"local")}static forTestnet(t=Nn,e=!1,r=pa.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"testnet"):this.customWarpGw(r,ma,t,"testnet")}static forMainnet(t=Nn,e=!1,r=pa.default.init({host:"arweave.net",port:443,protocol:"https"})){return e?this.customArweaveGw(r,t,"mainnet"):this.customWarpGw(r,ma,t,"mainnet")}static custom(t,e,r){let i=new De({...e,dbLocation:`${e.dbLocation}/state`}),o=new si(t),a=new Wi(t,i,[new ir]);return an.builder(t,i,r).setExecutorFactory(o).setStateEvaluator(a)}static customArweaveGw(t,e=Nn,r){return this.custom(t,e,r).useArweaveGateway(e).build()}static customWarpGw(t,e=ma,r=Nn,i){return this.custom(t,r,i).useWarpGateway(e,r).build()}};_();function my(n){let t=/(const|var) ret = makeMutClosure\(arg0, arg1, (\d+?), __wbg_adapter/;return n.match(t)[2]}_();var Ch=Gt(Xo());function de(n,t,e=void 0){let r=n.find(({name:i})=>i===t);return r?r.value:e}var zi=class{constructor(t){this.env=t}arweaveWrapper;arweaveTransactions;logger=ct.INST.create(zi.name);async load(t,e){let r=bt.measure(),i=await this.fetchContractTx(t);this.logger.debug("Contract tx fetch time",r.elapsed());let o=i.owner.address,a=e||de(i.tags,Tt.CONTRACT_SRC_TX_ID),c=de(i.tags,st.WARP_TESTNET)||null;if(c&&this.env!=="testnet")throw new Error('Trying to use testnet contract in a non-testnet env. Use the "forTestnet" factory method.');if(!c&&this.env==="testnet")throw new Error("Trying to use non-testnet contract in a testnet env.");let l=de(i.tags,Tt.MIN_FEE),h=de(i.tags,st.MANIFEST)?JSON.parse(de(i.tags,st.MANIFEST)):null;this.logger.debug("Tags decoding",r.elapsed());let w=await this.evalInitialState(i);this.logger.debug("init state",w);let v=JSON.parse(w);this.logger.debug("Parsing src and init state",r.elapsed());let{src:T,srcBinary:d,srcWasmLang:y,contractType:x,metadata:R,srcTx:N}=await this.loadContractSource(a),j={txId:t,srcTxId:a,src:T,srcBinary:d,srcWasmLang:y,initState:v,minFee:l,owner:o,contractType:x,metadata:R,manifest:h,contractTx:await this.convertToWarpCompatibleContractTx(i),srcTx:await this.convertToWarpCompatibleContractTx(N),testnet:c};return this.logger.info(`Contract definition loaded in: ${r.elapsed()}`),j}async fetchContractTx(t){let e=await this.arweaveTransactions.transaction(t);return e??await this.arweaveTransactions.transactionUsingUploaderTag(t)}async convertToWarpCompatibleContractTx(t){return{tags:t.tags.map(({name:r,value:i})=>({name:F.Buffer.from(r).toString("base64url"),value:F.Buffer.from(i).toString("base64url")})),owner:t.owner.key,target:t.recipient,signature:t.signature,data:(await this.arweaveWrapper.txData(t.id)).toString("base64url")}}async loadContractSource(t){let e=bt.measure(),r=await this.fetchContractTx(t),i=de(r.tags,Tt.CONTENT_TYPE);if(!mi.includes(i))throw new Error(`Contract source content type ${i} not supported`);let o=i==="application/javascript"?"js":"wasm",a=await this.contractSource(r,o),c,l,h;if(o=="wasm"){if(l=new nr(a),c=de(r.tags,st.WASM_LANG),!c)throw new Error(`Wasm lang not set for wasm contract src ${r.id}`);h=JSON.parse(de(r.tags,st.WASM_META))}return this.logger.debug("Contract src tx load",e.elapsed()),e.reset(),{src:o=="js"?a:null,srcBinary:o=="wasm"?l.wasmBinary():null,srcWasmLang:c,contractType:o,metadata:h,srcTx:r}}async contractSource(t,e){if(de(t.tags,st.UPLOADER_TX_ID)!=null){let i=await this.arweaveWrapper.txDataString(t.id);if(e==="wasm")throw new Error("WASM contracts in legacy format are not supported using AR GW");return Ch.default.utils.b64UrlToString(JSON.parse(i).data)}return e==="js"?await this.arweaveWrapper.txDataString(t.id):await this.arweaveWrapper.txData(t.id)}async evalInitialState(t){if(de(t.tags,st.INIT_STATE))return de(t.tags,st.INIT_STATE);if(de(t.tags,st.INIT_STATE_TX)){let e=de(t.tags,st.INIT_STATE_TX);return this.arweaveWrapper.txDataString(e)}else return this.arweaveWrapper.txDataString(t.id)}setCache(){throw new Error("Method not implemented.")}setSrcCache(){throw new Error("Method not implemented.")}getCache(){throw new Error("Method not implemented.")}getSrcCache(){throw new Error("Method not implemented.")}type(){return"arweave"}set warp(t){this.arweaveWrapper=new Zt(t),this.arweaveTransactions=new _e(t)}};_();var Ih=100,yy=100,Ah=1057409,sn=class{constructor(t,e){this.arweave=t;this.environment=e;this.sorter=new tr(t)}logger=ct.INST.create(sn.name);arweaveFetcher;arweaveWrapper;_warp;sorter;tagsParser=new jt;async load(t,e,r,i,o){if(this.logger.debug("Loading interactions for",{contractId:t,fromSortKey:e,toSortKey:r}),i?.transactionsPagesPerBatch)throw new Error(`Loading in batches not yet implemented for ${sn.name}`);let a=this.sorter.extractBlockHeight(e)||0,c=this.sorter.extractBlockHeight(r)||await this.currentBlockHeight(),l={tags:[{name:Tt.APP_NAME,values:["SmartWeaveAction"]},{name:Tt.CONTRACT_TX_ID,values:[t]},{name:st.SEQUENCER,values:["RedStone"]}],blockFilter:{min:a,max:c+yy},first:Ih},h=bt.measure(),w=await this.arweaveFetcher.transactions(l,Number.MAX_SAFE_INTEGER,o);i.internalWrites&&(w=await this.appendInternalWriteInteractions(t,a,c,w,o)),h.stop(),this.logger.debug("All loaded interactions:",{from:e,to:r,loaded:w.length,time:h.elapsed()}),w.forEach(y=>{y.node.sortKey=y.node.sortKey??y.node?.tags?.find(x=>x.name===st.SEQUENCER_SORT_KEY)?.value});let v=await this.sorter.sort(w),T=this.environment==="local"||this.environment==="testnet",d=this._warp.maybeLoadPlugin("vrf");return v.filter(y=>this.isNewerThenSortKeyBlockHeight(y)).filter(y=>this.isSortKeyInBounds(e,r,y)).map(y=>this.attachSequencerDataToInteraction(y)).map(y=>this.maybeAddMockVrf(T,y,d)).map((y,x,R)=>this.verifySortKeyIntegrity(y,x,R)).map(({node:y})=>y)}verifySortKeyIntegrity(t,e,r){if(e!==0){let i=r[e-1],o=r[e];if(this.logger.debug(`prev: ${i.node.id} | current: ${o.node.id}`),o.node.block.height<=Ah||o.node.lastSortKey?.split(",")[1]===Ko)return t;i.node.source==="redstone-sequencer"&&i.node.sortKey!==o.node.lastSortKey&&this.logger.warn(`Interaction loading error: interaction ${o.node.id} lastSortKey is not pointing on prev interaction ${i.node.id}`)}return t}isSortKeyInBounds(t,e,r){return t&&e?r.node.sortKey.localeCompare(t)>0&&r.node.sortKey.localeCompare(e)<=0:t&&!e?r.node.sortKey.localeCompare(t)>0:!t&&e?r.node.sortKey.localeCompare(e)<=0:!0}attachSequencerDataToInteraction(t){let e=v=>t.node.tags.find(T=>T.name===v)?.value,r=e(st.SEQUENCER_TX_ID),i=e(st.SEQUENCER_OWNER),o=e(st.SEQUENCER_BLOCK_ID),a=e(st.SEQUENCER_BLOCK_HEIGHT),c=e(st.SEQUENCER_PREV_SORT_KEY)||e(st.SEQUENCER_LAST_SORT_KEY),l=e(st.SEQUENCER_SORT_KEY),h=e(st.SEQUENCER_BLOCK_TIMESTAMP),w=fi(a);if(!i||!o||!a||!c&&w>Ah||!r||!l)throw Error(`Interaction ${t.node.id} is not sequenced by sequencer aborting. Only Sequenced transactions are supported by loader ${sn.name}`);return{...t,node:{...t.node,owner:{address:i,key:null},block:{...t.node.block,height:fi(a),id:o,timestamp:h?fi(h):t.node.block.timestamp},sortKey:l,lastSortKey:c,id:r,source:"redstone-sequencer"}}}async appendInternalWriteInteractions(t,e,r,i,o){let a={tags:[{name:st.INTERACT_WRITE,values:[t]}],blockFilter:{min:e,max:r},first:Ih},c=await this.arweaveFetcher.transactions(a,Number.MAX_SAFE_INTEGER,o);return this.logger.debug("Inner writes interactions length:",c.length),i=i.concat(c),i}maybeAddMockVrf(t,e,r){return t&&this.tagsParser.hasVrfTag(e.node)&&(r?e.node.vrf=r.process().generateMockVrf(e.node.sortKey):this.logger.warn('Cannot generate mock vrf for interaction - no "warp-contracts-plugin-vrf" attached!')),e}isNewerThenSortKeyBlockHeight(t){if(t.node.sortKey){let e=t.node.sortKey.split(",")[0],r=Number.parseInt(e);return Number(t.node.block.height)-r>=0}return!0}async currentBlockHeight(){return(await this.arweaveWrapper.info()).height}type(){return"arweave"}clearCache(){}set warp(t){this.arweaveWrapper=new Zt(t),this.arweaveFetcher=new _e(t),this._warp=t}};return Wh(wy);})();
/*! Bundled license information:

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

buffer/index.js:
  (*!
   * The buffer module from node.js, for the browser.
   *
   * @author   Feross Aboukhadijeh <https://feross.org>
   * @license  MIT
   *)

queue-microtask/index.js:
  (*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

run-parallel-limit/index.js:
  (*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> *)

warp-arbundles/build/web/esm/bundle.js:
  (*! Bundled license information:
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  buffer/index.js:
    (*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     *)
  *)
*/
